(window.$WP=window.$WP||[]).push({id:"@ta/social.social-reference",d:["vendor-babel","vendor-react-libs","@ta/list.navigable-list","ta-common","@ta/common.typeahead","@ta/events.keyboard-event-listener","ta-platform","@ta/input.text-area"],e:["./packages/social/social-reference/social-reference.jsx"],x:{"./packages/social/social-reference/social-reference.jsx":["UserProfileResult","ReferenceSelectorController"]},m:{"./packages/social/social-reference/social-reference.jsx":function(e,t,n){"use strict";n.r(t);var r=n("@babel/runtime/helpers/esm/classCallCheck"),a=n.n(r),o=n("@babel/runtime/helpers/esm/createClass"),s=n.n(o),l=n("@babel/runtime/helpers/esm/possibleConstructorReturn"),u=n.n(l),c=n("@babel/runtime/helpers/esm/getPrototypeOf"),i=n.n(c),p=n("@babel/runtime/helpers/esm/inherits"),h=n.n(p),f=n("@babel/runtime/helpers/esm/assertThisInitialized"),d=n.n(f),m=n("@babel/runtime/helpers/esm/defineProperty"),v=n.n(m),y=n("react"),x=n("@ta/list.navigable-list"),g=n("@ta/styleguide.avatar"),S=n("@ta/common.typeahead"),I=function(e){function t(){var e,n;a()(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return n=u()(this,(e=i()(t)).call.apply(e,[this].concat(o))),v()(d()(d()(n)),"onSelection",function(e){n.props.onSelection&&"function"==typeof n.props.onSelection&&n.props.onSelection(e,n.props.result)}),n}return h()(t,e),s()(t,[{key:"render",value:function e(){var t="@".concat(this.props.result.name).concat(this.props.result.following?" â€¢ ".concat(this.props.result.following):""),n={withBorder:!0,size:"small",photo:{photoSizes:[{url:this.props.result.avatar&&this.props.result.avatar.url_small,width:32,height:32}]}};return y.createElement(x.NavigableListItem,{onSelection:this.onSelection,active:!!this.props.active},y.createElement("div",{className:"".concat("social-social-reference-typeahead-result-UserProfileResult__result_container--1cgyP"," ").concat(this.props.active?"social-social-reference-typeahead-result-UserProfileResult__active--3EaMI":"")},y.createElement("div",{className:"social-social-reference-typeahead-result-UserProfileResult__avatar_container--BpPYT"},y.createElement(g.Avatar,n)),y.createElement(S.BasicResult,{title:this.props.result.details&&this.props.result.details.name,subtitle:t,verifiedIcon:this.props.result.details&&this.props.result.details.verified,paddingStyle:"narrow"})))}}]),t}(y.Component);v()(I,"defaultProps",{onSelection:void 0,active:!1});var b=I,E=n("@babel/runtime/helpers/esm/slicedToArray"),R=n.n(E),C=n("@babel/runtime/helpers/esm/toConsumableArray"),w=n.n(C),_=n("@ta/events.keyboard-event-listener"),q=n.n(_),k=n("@ta/common.classnames"),A=n.n(k),P=n("@ta/input.text-area"),V=function(e){function t(){var e,n;a()(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return n=u()(this,(e=i()(t)).call.apply(e,[this].concat(o))),v()(d()(d()(n)),"state",{textInputValue:n.props.value}),v()(d()(d()(n)),"onSelection",function(e,t){e.preventDefault(),t&&(n.props.selectionChanged&&n.props.selectionChanged(t),n.updateSearch(""),n.textInput&&n.textInput.focus())}),v()(d()(d()(n)),"tracker",new S.TypeaheadTracking("","")),v()(d()(d()(n)),"textInput",void 0),v()(d()(d()(n)),"updateSearch",void 0),n}return h()(t,e),s()(t,[{key:"render",value:function e(){var t=this;return y.createElement(S.Typeahead,{fetchers:this.props.fetchers},function(e,n){t.updateSearch=n;var r=e&&Object.keys(e).filter(function(t){return!function e(t){return!t||0===t.length}(e[t])}).length>0?e:null;return y.createElement("div",null,y.createElement("span",{className:A()("ui_icon","social-social-reference-ReferenceSelector__textInput--32Uyj")},y.createElement(S.TypeaheadTextArea,{name:t.props.name,inputComponentType:P.TextArea,inputComponentClassName:A()("ui_textarea",t.props.className),value:t.state.textInputValue,onChange:function e(n,r){t.props.textInputChanged(n,r),t.setState({textInputValue:r})},onQueryChange:function e(r){t.props.updateQuery(r,n)},onFocus:t.props.onFocus,onBlur:function e(r){setTimeout(function(){n("")},500),t.props.onBlur&&t.props.onBlur(r)},searchDelay:50,placeholder:t.props.placeholder,onRef:function e(n){t.textInput=n,t.props.onRef&&t.props.onRef(n)},cols:t.props.cols,rows:t.props.rows,maxLength:t.props.maxLength,focusOnMount:t.props.focusOnMount}),y.createElement("div",{className:"social-social-reference-ReferenceSelector__resultsContainer--fDpWm"},r&&y.createElement("div",{className:"social-social-reference-ReferenceSelector__results--1P_SP"},t.props.children(e,t.tracker,t.onSelection)))),y.createElement(q.a,{keyName:"Escape",callback:function e(){n("")}}))})}}]),t}(y.Component);v()(V,"defaultProps",{placeholder:"",className:void 0,inputType:void 0,focusOnMount:!1,onFocus:void 0,onBlur:void 0,rows:5,cols:50,value:""});var T=V,O=function(e){function t(){var e,n;a()(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return n=u()(this,(e=i()(t)).call.apply(e,[this].concat(o))),v()(d()(d()(n)),"state",{textInputValue:n.props.value||"",shouldQuery:!1,queryStartIndex:-1,queryEndIndex:-1,references:[],referenceType:"USER_PROFILE"}),v()(d()(d()(n)),"onResultSelected",function(e){var t=n.state.textInputValue,r=n.state.queryStartIndex,a=n.state.queryEndIndex,o=n.replaceCurrentValue(t,r,a,"".concat(e.name," "));if(n.setState({textInputValue:o,queryStartIndex:-1,queryEndIndex:-1,shouldQuery:!1,references:[].concat(w()(n.state.references),[{start:r,length:e.name.length}])}),n.textInput){n.textInput.setSelectionRange(r+e.name.length+2,r+e.name.length+2);var s=Object.getOwnPropertyDescriptor(HTMLTextAreaElement.prototype,"value");s&&s.set.call(n.textInput,o),n.textInput.dispatchEvent(new Event("input",{bubbles:!0}))}n.autoScrollWrapElement({block:"start",behavior:"smooth"})}),v()(d()(d()(n)),"autoScrollWrapElement",function(e){n.props.shouldAutoScroll&&n.autoScrollAnchorRef.current&&n.autoScrollAnchorRef.current.parentElement&&n.autoScrollAnchorRef.current.parentElement.scrollIntoView(e)}),v()(d()(d()(n)),"queryStartWith",["@"]),v()(d()(d()(n)),"queryStopWith",[" ","\n","\t"]),v()(d()(d()(n)),"referenceFinder",/(([\s!.,?])|^)([@][\w_-]+)/g),v()(d()(d()(n)),"textInput",void 0),v()(d()(d()(n)),"autoScrollAnchorRef",y.createRef()),v()(d()(d()(n)),"typeaheadJsonFetcher",new S.TypeaheadJsonFetcher({interleaved:!0,types:["profiles"],filter:void 0,link_type:"none",details:!0,legacy_format:!0,urlList:!1,matchUserProfiles:!0,max:n.props.numberOfResults})),v()(d()(d()(n)),"replaceCurrentValue",function(e,t,n,r){return e.substring(0,t+1).concat(r,e.substring(n+1))}),v()(d()(d()(n)),"findDifference",function(e,t){if(0===e.length)return[0,t];for(var n=e.length-1,r=t.length-1;n<r&&n>=0;)if(e.charAt(n--)!==t.charAt(r--))return[r+1,t.charAt(r+1)];return-1===n&&0===r?[0,t.charAt(0)]:[-1,void 0]}),v()(d()(d()(n)),"updateReferences",function(e){if(null!==e&&0!==e.length){var t=0,r=[],a=e.match(n.referenceFinder);a&&a.forEach(function(a){var o=-1!==n.queryStartWith.indexOf(a.charAt(0))?a:a.substring(1);t=e.substring(t).search(o)+t,r=[].concat(w()(r),[{start:t,length:o.length}])}),n.setState({references:r})}}),v()(d()(d()(n)),"editReferences",function(e,t,r){var a=n.state.references.filter(function(e){return t[0]>e.start&&t[0]<=e.start+e.length})[0];return a?(n.setState({textInputValue:e,queryStartIndex:a.start,queryEndIndex:a.start+a.length+r,shouldQuery:!0}),!0):(n.setState({textInputValue:e,queryStartIndex:-1,queryEndIndex:-1,shouldQuery:!1}),!1)}),v()(d()(d()(n)),"textInputChanged",function(e,t){if(n.props.onChange&&n.props.onChange(e,t),t.length>n.state.textInputValue.length){n.updateReferences(t);var r,a,o,s=n.findDifference(n.state.textInputValue,t);-1!==n.queryStopWith.indexOf(s[1])?n.setState({textInputValue:t,queryStartIndex:-1,queryEndIndex:-1,shouldQuery:!1}):n.editReferences(t,s,1)||(a=-1===(r=-1===n.queryStartWith.indexOf(s[1])?n.state.queryStartIndex:s[0])?-1:-1===s[0]?n.state.queryEndIndex:R()(s,1)[0],o=-1!==r&&-1!==a&&r<a,n.setState({textInputValue:t,queryStartIndex:r,queryEndIndex:a,shouldQuery:o}))}else if(t.length<n.state.textInputValue.length){n.updateReferences(t);var l=n.findDifference(t,n.state.textInputValue);-1!==l[0]?n.editReferences(t,l,-1):n.setState({textInputValue:t})}}),v()(d()(d()(n)),"updateQuery",function(e,t){n.state.shouldQuery?t(e.substring(n.state.queryStartIndex,n.state.queryEndIndex+1).trim()):t("")}),n}return h()(t,e),s()(t,[{key:"componentDidMount",value:function e(){this.setState({textInputValue:this.props.value,references:this.props.references})}},{key:"render",value:function e(){var t=this;return y.createElement("div",{ref:this.autoScrollAnchorRef},y.createElement(T,{className:this.props.className,fetchers:[this.typeaheadJsonFetcher],name:this.props.name,value:this.state.textInputValue,selectionChanged:this.onResultSelected,textInputChanged:this.textInputChanged,placeholder:this.props.placeholder,updateQuery:this.updateQuery,onRef:function e(n){n&&(t.textInput=n,t.props.onRef&&t.props.onRef(n))},onFocus:function e(n){t.autoScrollWrapElement(),t.props.onFocus&&t.props.onFocus(n)},onBlur:this.props.onBlur,cols:this.props.cols,rows:this.props.rows,maxLength:this.props.maxLength,focusOnMount:this.props.focusOnMount},function(e,n,r){return y.createElement(x.NavigableList,null,w()(e.typeaheadjson||[]).map(function(e){return function(n,a){return y.createElement(x.NavigableListItem,{onSelection:function t(n){return r(n,e)},onMouseMove:a,active:n,key:"item_".concat(e.name)},y.createElement(q.a,{keyName:"Tab",callback:function t(a){n&&r(a,e)}}),function e(n,r,a){switch(t.state.referenceType){case"USER_PROFILE":return y.createElement(b,{result:n,onSelection:r,active:a});default:return null}}(e,r,n))}}))}))}}]),t}(y.Component);v()(O,"defaultProps",{placeholder:"",value:"",references:[],onRef:void 0,onChange:void 0,onFocus:void 0,onBlur:void 0,focusOnMount:!1,numberOfResults:5,shouldAutoScroll:!1});var N=O;n.d(t,"UserProfileResult",function(){return b}),n.d(t,"ReferenceSelectorController",function(){return N})}}});
//# sourceMappingURL=social.social-reference.aab013d0e4.js.map