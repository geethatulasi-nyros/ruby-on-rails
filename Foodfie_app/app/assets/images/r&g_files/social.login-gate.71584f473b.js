(window.$WP=window.$WP||[]).push({id:"@ta/social.login-gate",d:["vendor-babel","vendor-react-libs","ta-platform","@ta/social.failover","vendor-apollo-libs","@ta/common.webview","@ta/tracking.interactions","@ta/overlays.fullscreen-overlay","@ta/overlays.managers","@ta/overlays.pieces","@ta/events.keyboard-event-listener"],e:["./packages/social/login-gate/index.jsx"],x:{"./packages/social/login-gate/AuthGated.jsx":["a"],"./packages/social/login-gate/index.jsx":["SocialLoginGate","TermsOfUseOverlay","SocialOpener","AuthGated","TermsOverlayQuery"]},m:{"./node_modules/webpack/buildin/global.js":function(e,n){var t;t=function(){return this}();try{t=t||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(t=window)}e.exports=t},"./packages/social/login-gate/AuthGated.jsx":function(e,n,t){"use strict";(function(e){var r=t("@babel/runtime/helpers/esm/defineProperty"),a=t.n(r),o=t("@babel/runtime/helpers/esm/objectSpread"),l=t.n(o),i=t("@babel/runtime/helpers/esm/classCallCheck"),s=t.n(i),c=t("@babel/runtime/helpers/esm/createClass"),u=t.n(c),m=t("@babel/runtime/helpers/esm/possibleConstructorReturn"),d=t.n(m),f=t("@babel/runtime/helpers/esm/getPrototypeOf"),v=t.n(f),p=t("@babel/runtime/helpers/esm/inherits"),g=t.n(p),y=t("react"),O=t("react-redux"),b=t("react-apollo"),h=t("@ta/common.webview"),k=t("@ta/tracking.interactions"),E=function(n){function t(){return s()(this,t),d()(this,v()(t).apply(this,arguments))}return g()(t,n),u()(t,[{key:"formatInteraction",value:function e(n){var t=this.props.tracking;return t?{variables:{interaction:a()({},t.source,a()({},n,l()({element:t.element},t.attributes||{})))}}:null}},{key:"renderInner",value:function n(t){var r=this.props,a=r.loggedInUserId,o=r.pid,l=r.flowOrigin,i=r.flow,s=r.extraQueryParams,c=r.onClose;return(0,r.children)(function n(r){return new Promise(function(n){if(a)n();else if(h.NativeBridge.isNativeWebview())h.NativeBridge.showRegistration(!1);else{var u={flow:i||"CORE_COMBINED",pid:r||o||-1,userRequestedForce:!0,extraQueryParams:s||{},locationId:window.require("page-model").GEO_ID,onSuccess:function e(r){t("modalSuccess"),n(r)},onClose:c};l&&(u.extraQueryParams.flowOrigin=l),e.require(["trjs!ta/registration/RegOverlay"],function(e){t("elementClick"),e.showRegOverlayByPageModel(null,null,window.require("page-model"),u)})}})},a)}},{key:"render",value:function e(){var n=this;return y.createElement(b.Mutation,{mutation:k.LogInteractionV4},function(e){return n.renderInner(function t(r){var a=n.formatInteraction(r);a&&e(a)})})}}]),t}(y.Component);n.a=Object(O.connect)(function(e){return{loggedInUserId:e.auth.loggedInUserId}})(E)}).call(this,t("./node_modules/webpack/buildin/global.js"))},"./packages/social/login-gate/index.jsx":function(e,n,t){"use strict";t.r(n);var r=t("@babel/runtime/helpers/esm/classCallCheck"),a=t.n(r),o=t("@babel/runtime/helpers/esm/createClass"),l=t.n(o),i=t("@babel/runtime/helpers/esm/possibleConstructorReturn"),s=t.n(i),c=t("@babel/runtime/helpers/esm/getPrototypeOf"),u=t.n(c),m=t("@babel/runtime/helpers/esm/inherits"),d=t.n(m),f=t("@babel/runtime/helpers/esm/assertThisInitialized"),v=t.n(f),p=t("@babel/runtime/helpers/esm/defineProperty"),g=t.n(p),y=t("react"),O=t("react-redux"),b=t("@ta/common.features"),h=t("@ta/social.failover"),k=t("./packages/social/login-gate/AuthGated.jsx"),E=t("react-apollo"),S=t("@ta/common.logging"),C=t.n(S),w=t("@ta/overlays.fullscreen-overlay"),T=t.n(w),U=t("@ta/overlays.managers"),I=t("@ta/overlays.pieces"),_=t("@ta/platform.import"),P={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"TermsOverlay"},variableDefinitions:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"insightProfile"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"uiCardsState"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"states"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"state"},arguments:[],directives:[]}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"getTermOfUseAcceptanceInfo"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"accepted"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:167}};P.loc.source={body:"34460b78ddd8"};var R=P,x={position:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},N=Object(_.deferredImport)("@ta/social.confirm-username","ConfirmUsername"),j=function e(n){var t=n.onComplete,r=n.children;return y.createElement(E.Query,{query:R},function(e){var n=e.loading,a=e.data,o=e.error;if(n)return null;if(a){var l=a.getTermOfUseAcceptanceInfo&&a.getTermOfUseAcceptanceInfo.accepted,i=a.insightProfile&&a.insightProfile.uiCardsState;return l&&i&&function e(n){return n.states.find(function(e){return"ONBOARDING_CONFIRM_USER"===e.id&&"COMPLETED"===e.state})}(i)?(t(),null):r}return o&&C.a.warn("Error in SkipIfCompleted query: ".concat(o)),C.a.warn("TermsOfUseOverlay was shown due to lack of sufficient information or a query error."),r})},F=function e(n){var t=function e(t){return y.createElement("div",{className:"social-login-gate-TermsOfUseOverlay__container--2SESV"},y.createElement("div",{className:"social-login-gate-TermsOfUseOverlay__bodyContent--3eGDZ"},y.createElement(N,{onComplete:n.onComplete,closerForError:t,trackingModule:"Social_onboarding_gatedaction"})))},r=function e(){return y.createElement(U.Closer,null,function(e){var r=function t(){e(),n.onClose&&n.onClose()};return n.fullscreen?y.createElement(y.Fragment,null,y.createElement(T.a,null,t(r))):y.createElement(y.Fragment,null,y.createElement(I.BlockScroll,null),y.createElement(I.Backdrop,{close:function e(){}},y.createElement(I.Overlay,x,t(r))))})};return n.forceTermsOfUse?y.createElement(r,null):y.createElement(j,{onComplete:n.onComplete},y.createElement(r,null))};F.defaultProps={fullscreen:!1,onClose:void 0,forceTermsOfUse:!1};var M=Object(O.connect)(function(e,n){return{fullscreen:n.fullscreenAlways||"MOBILE"===e.meta.device.viewportCategory}})(F),A=t("@ta/events.keyboard-event-listener"),B=t.n(A),G={position:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},q=function e(n){var t=y.createElement("div",{className:"social-login-gate-ReadonlyMessageOverlay__container--1l9mx"},y.createElement("div",{className:"social-login-gate-ReadonlyMessageOverlay__bodyContent--1bBv0"},n.children),y.createElement(I.CloseX,{close:n.closer}));return n.fullscreen?y.createElement(y.Fragment,null,y.createElement(T.a,null,t)):y.createElement(y.Fragment,null,y.createElement(I.BlockScroll,null),y.createElement(I.Backdrop,{close:n.closer},y.createElement(I.Overlay,G,t),y.createElement(B.a,{keyName:"Escape",callback:n.closer})))};q.defaultProps={fullscreen:!1};var D=Object(O.connect)(function(e,n){return{fullscreen:n.fullscreenAlways||"MOBILE"===e.meta.device.viewportCategory}})(q),L=function(e){function n(){var e,t;a()(this,n);for(var r=arguments.length,o=new Array(r),l=0;l<r;l++)o[l]=arguments[l];return t=s()(this,(e=u()(n)).call.apply(e,[this].concat(o))),g()(v()(v()(t)),"state",{openTermsOfUseOverlay:!1,onSuccess:function e(){},forceTermsOfUse:!1,openReadonlyOverlay:!1}),g()(v()(v()(t)),"closeTermsOfUseOverlay",function(){t.setState({openTermsOfUseOverlay:!1,onSuccess:function e(){}})}),g()(v()(v()(t)),"openReadonlyOverlay",function(){t.setState({openReadonlyOverlay:!0})}),g()(v()(v()(t)),"closeReadonlyOverlay",function(){t.setState({openReadonlyOverlay:!1})}),t}return d()(n,e),l()(n,[{key:"render",value:function e(){var n=this,t=this.props,r=t.pid,a=t.flowOrigin,o=t.children,l=t.onClose,i=t.onLoginSuccess,s=t.tracking,c=t.isReadonlyMode;return y.createElement(k.a,{pid:r,flowOrigin:a,extraQueryParams:{social:!0},onClose:l,tracking:s},function(e,t){var r=c?function e(){return n.openReadonlyOverlay(),Promise.reject()}:Object(b.featureIsEnabled)("social_2018_login_gate")?function t(r){return e(r).then(function(e){i&&i();var t=e&&(e.hasCreatedMember||!e.hasAcceptedTermsOfUse);return e&&!t||Object(b.featureIsEnabled)("social_2018_login_gate_skip_terms_of_service")?Promise.resolve():new Promise(function(e){n.setState({openTermsOfUseOverlay:!0,forceTermsOfUse:t,onSuccess:function t(){e(),n.setState({openTermsOfUseOverlay:!1,onSuccess:function e(){}})}})})})}:function e(){return Promise.resolve()};return y.createElement(y.Fragment,null,o(r,t),n.state.openTermsOfUseOverlay&&y.createElement(M,{onComplete:n.state.onSuccess,forceTermsOfUse:n.state.forceTermsOfUse,onClose:n.closeTermsOfUseOverlay}),n.state.openReadonlyOverlay&&y.createElement(D,{closer:n.closeReadonlyOverlay},y.createElement(h.FailoverMessage,null)))})}}]),n}(y.Component);g()(L,"defaultProps",{pid:-1,flowOrigin:void 0,tracking:void 0,onLoginSuccess:void 0});var Q=Object(O.connect)(function(e){return{isReadonlyMode:e.meta.readonlyMode}})(L),W=function e(n){var t=n.name,r=n.local,a=n.pid,o=n.children;return y.createElement(Q,{pid:a},function(e){return y.createElement(U.Opener,{name:t,local:r},function(n,t){return o(function(){e().then(n)},t)})})};W.defaultProps={local:!1,pid:void 0};var V=W;t.d(n,"SocialLoginGate",function(){return Q}),t.d(n,"TermsOfUseOverlay",function(){return M}),t.d(n,"SocialOpener",function(){return V}),t.d(n,"AuthGated",function(){return k.a}),t.d(n,"TermsOverlayQuery",function(){return R})}}});
//# sourceMappingURL=social.login-gate.71584f473b.js.map