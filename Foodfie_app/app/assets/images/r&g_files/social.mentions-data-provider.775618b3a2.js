(window.$WP=window.$WP||[]).push({id:"@ta/social.mentions-data-provider",d:["vendor-babel","vendor-react-libs","vendor-apollo-libs","ta-platform","@ta/social.mentions-tracking"],e:["./packages/social/mentions-data-provider/index.jsx"],x:{"./packages/social/mentions-data-provider/index.jsx":["SocialContentDataProvider","mapContentToSummary","userProfileToActorSummary","mapContentToActorSummary","mapContentToContentSummary"]},m:{"./packages/social/mentions-data-provider/index.jsx":function(e,i,n){"use strict";n.r(i);var a=n("@babel/runtime/helpers/esm/toConsumableArray"),t=n.n(a),d=n("@babel/runtime/helpers/esm/objectSpread"),o=n.n(d),l=n("@babel/runtime/helpers/esm/slicedToArray"),r=n.n(l),s=n("react"),m=n("react-apollo"),c=n("react-redux"),u=n("@ta/common.error-handling"),v=n("@ta/common.logging"),k=n.n(v),N=n("@ta/social.mentions-tracking"),p={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"MentionsPhotoMediaFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Photo"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"photoSizes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"width"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"height"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]}]}}],loc:{start:0,end:113}};p.loc.source={body:"6390ad13cfd4"};var f=p,S={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"MentionsMemberProfileFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MemberProfile"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"userId"},name:{kind:"Name",value:"id"},arguments:[],directives:[{kind:"Directive",name:{kind:"Name",value:"static"},arguments:[]}]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isVerified"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"route"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"avatar"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MentionsPhotoMediaFields"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"isVerified"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"followerCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"contributionCounts"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"sumAllUgc"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:297}};S.loc.source={body:"9edbd0f29cf3"};var F={};S.definitions=S.definitions.concat(function y(e){return e.filter(function(e){if("FragmentDefinition"!==e.kind)return!0;var i=e.name.value;return!F[i]&&(F[i]=!0,!0)})}(f.definitions));var b=S,g={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"MentionsSocialStatisticsFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"SocialStatistics"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"likeCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"repostCount"},arguments:[],directives:[]}]}}],loc:{start:0,end:90}};g.loc.source={body:"8e6213ab5c72"};var T=g,V={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"MentionsLinkPostFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"LinkPost"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"postId"},name:{kind:"Name",value:"id"},arguments:[],directives:[{kind:"Directive",name:{kind:"Name",value:"static"},arguments:[]}]},{kind:"Field",name:{kind:"Name",value:"userProfile"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MentionsMemberProfileFields"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"route"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"socialStatistics"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MentionsSocialStatisticsFields"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"preview"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"canonicalUrl"},arguments:[],directives:[{kind:"Directive",name:{kind:"Name",value:"encode"},arguments:[]}]},{kind:"Field",name:{kind:"Name",value:"urlDomain"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"description"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"media"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MentionsPhotoMediaFields"},directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]}]}}],loc:{start:0,end:522}};V.loc.source={body:"97c363cb8b27"};var M={};function D(e){return e.filter(function(e){if("FragmentDefinition"!==e.kind)return!0;var i=e.name.value;return!M[i]&&(M[i]=!0,!0)})}V.definitions=V.definitions.concat(D(b.definitions)),V.definitions=V.definitions.concat(D(T.definitions)),V.definitions=V.definitions.concat(D(f.definitions));var h=V,C={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"MentionsTripFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Trip"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"description"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"photo"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MentionsPhotoMediaFields"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"userProfile"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MentionsMemberProfileFields"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"route"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"socialStatistics"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MentionsSocialStatisticsFields"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]}]}}],loc:{start:0,end:436}};C.loc.source={body:"ca1824222383"};var I={};function P(e){return e.filter(function(e){if("FragmentDefinition"!==e.kind)return!0;var i=e.name.value;return!I[i]&&(I[i]=!0,!0)})}C.definitions=C.definitions.concat(P(f.definitions)),C.definitions=C.definitions.concat(P(b.definitions)),C.definitions=C.definitions.concat(P(T.definitions));var j=C,O={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"MoreMentionsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"locationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"objectTypes"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"FeedSectionItemTypeInput"}}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"limit"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"placement"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PlacementEnumInput"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"reset"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},defaultValue:{kind:"BooleanValue",value:!0},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"socialContentFromLocation"},name:{kind:"Name",value:"socialFeedV2"},arguments:[{kind:"Argument",name:{kind:"Name",value:"feedRequest"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"allowedTypes"},value:{kind:"Variable",name:{kind:"Name",value:"objectTypes"}}},{kind:"ObjectField",name:{kind:"Name",value:"limit"},value:{kind:"Variable",name:{kind:"Name",value:"limit"}}},{kind:"ObjectField",name:{kind:"Name",value:"placement"},value:{kind:"Variable",name:{kind:"Name",value:"placement"}}},{kind:"ObjectField",name:{kind:"Name",value:"feedOwnerUsername"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"ObjectField",name:{kind:"Name",value:"context"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"location"},value:{kind:"Variable",name:{kind:"Name",value:"locationId"}}}]}},{kind:"ObjectField",name:{kind:"Name",value:"reset"},value:{kind:"Variable",name:{kind:"Name",value:"reset"}}}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"hasMore"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"feedWasReset"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"sections"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"items"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"object"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MentionsLinkPostFields"},directives:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"MentionsTripFields"},directives:[]}]}}]}}]}}]}}]}}],loc:{start:0,end:721}};O.loc.source={body:"d84026c52313"};var w={};function L(e){return e.filter(function(e){if("FragmentDefinition"!==e.kind)return!0;var i=e.name.value;return!w[i]&&(w[i]=!0,!0)})}O.definitions=O.definitions.concat(L(h.definitions)),O.definitions=O.definitions.concat(L(j.definitions));var _=O,x={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"MentionsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"locationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"objectTypes"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"FeedSectionItemTypeInput"}}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"placement"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PlacementEnumInput"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"limit"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"socialContentFromLocation"},name:{kind:"Name",value:"socialFeedV2"},arguments:[{kind:"Argument",name:{kind:"Name",value:"feedRequest"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"allowedTypes"},value:{kind:"Variable",name:{kind:"Name",value:"objectTypes"}}},{kind:"ObjectField",name:{kind:"Name",value:"limit"},value:{kind:"Variable",name:{kind:"Name",value:"limit"}}},{kind:"ObjectField",name:{kind:"Name",value:"placement"},value:{kind:"Variable",name:{kind:"Name",value:"placement"}}},{kind:"ObjectField",name:{kind:"Name",value:"feedOwnerUsername"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"ObjectField",name:{kind:"Name",value:"context"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"location"},value:{kind:"Variable",name:{kind:"Name",value:"locationId"}}}]}},{kind:"ObjectField",name:{kind:"Name",value:"reset"},value:{kind:"BooleanValue",value:!0}}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"hasMore"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"impressionId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"sections"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"items"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"object"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MentionsLinkPostFields"},directives:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"MentionsTripFields"},directives:[]}]}}]}}]}}]}}]}}],loc:{start:0,end:690}};x.loc.source={body:"c25a8e851f42"};var A={};function E(e){return e.filter(function(e){if("FragmentDefinition"!==e.kind)return!0;var i=e.name.value;return!A[i]&&(A[i]=!0,!0)})}x.definitions=x.definitions.concat(E(h.definitions)),x.definitions=x.definitions.concat(E(j.definitions));var R=x,U=function e(i){return"LINK_POST"===i||"TRIP"===i},q=Object(c.connect)(function(e){return{userId:e.auth.loggedInUserId}})(function e(i){var n=i.objectTypes,a=void 0===n?["LINK_POST","TRIP"]:n,d=i.skip,l=i.locationId,c=i.placement,v=void 0===c?"DETAIL":c,p=i.limit,f=i.userId,S=i.children,F={locationId:l,objectTypes:a,placement:v,limit:p,userId:f};return a.every(U)||k.a.error("SocialContentDataProvider contains unsupported arguments: ",a),s.createElement(u.ErrorBoundary,{errorRenderer:function e(){return S({content:[],hasMore:!1,loading:!1,loader:function e(){return Promise.resolve(!1)}})}},s.createElement(N.MentionsTrackingProvider,{objectTypes:a,placement:v,namespace:"mixer"},s.createElement(m.Query,{query:R,variables:F,errorPolicy:"all",notifyOnNetworkStatusChange:!0,skip:d||!l},function(e){var i,n,d,m,c=e.error,u=e.loading,F=e.data,y=e.fetchMore;c&&k.a.error("A service exception occurred in SocialMentionsQuery:",c);var b=function e(i){return Array.isArray(i)?i.filter(function(e){return null!=e}):[]}(null==F?void 0:null===(i=F.socialContentFromLocation)||void 0===i?void 0:i.sections).map(function(e){var i,n,a=e.id,t=r()(e.items,1)[0];return t&&o()({},t.object,{context:{sectionId:a,itemId:t.id,actor:null===(i=t.object)||void 0===i?void 0:null===(n=i.userProfile)||void 0===n?void 0:n.userId}})}).filter(Boolean),g=0===b.length&&!0===(null==F?void 0:null===(n=F.socialContentFromLocation)||void 0===n?void 0:n.hasMore);g&&k.a.info("Mixer is lying! hasMore set to false");var T=!0===(null==F?void 0:null===(d=F.socialContentFromLocation)||void 0===d?void 0:d.hasMore)&&!g,V=null==F?void 0:null===(m=F.socialContentFromLocation)||void 0===m?void 0:m.impressionId;return s.createElement(N.MentionsTrackingProvider,{impressionId:V},s.createElement(N.MentionsImpressionProvider,null,s.createElement(N.MentionsInteractionProvider,null,S({content:b,hasMore:T,loading:u,loader:function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p;return y({query:_,variables:{locationId:l,objectTypes:a,limit:i,placement:v,reset:!1,userId:f},updateQuery:function e(i,n){var a=n.fetchMoreResult;return o()({},i,{socialContentFromLocation:{sections:a.socialContentFromLocation.feedWasReset?a.socialContentFromLocation.sections:[].concat(t()(i.socialContentFromLocation.sections||[]),t()(a.socialContentFromLocation.sections)),hasMore:a.socialContentFromLocation.hasMore,feedWasReset:a.socialContentFromLocation.feedWasReset,__typename:i.socialContentFromLocation.__typename}})}}).then(function(e){var i,n;return!0===(null==e?void 0:null===(i=e.data)||void 0===i?void 0:null===(n=i.socialContentFromLocation)||void 0===n?void 0:n.hasMore)})}}))))})))}),W=n("@ta/common.global"),B=function e(i){var n=i.displayName,a=i.isVerified,t=i.avatar,d=i.route,o=i.followerCount,l=i.contributionCounts;return{displayName:n||void 0,isVerified:a||void 0,avatar:(null==t?void 0:t.photoSizes)||void 0,actorUrl:(null==d?void 0:d.url)||void 0,followerCount:o||void 0,contributionCount:(null==l?void 0:l.sumAllUgc)||void 0}},Q=function e(i){return i.userProfile?B(i.userProfile):{}},z=function e(i){if("LinkPost"===i.__typename){var n=i.preview&&i.preview.title||void 0,a=i.preview&&i.preview.description||void 0,t=i.preview&&i.preview.canonicalUrl||void 0,d=i.preview&&i.preview.urlDomain||void 0,o=i.preview&&i.preview.media&&i.preview.media[0];return{icon:"link",photo:o&&"Photo"===o.__typename?o.photoSizes:void 0,title:n,urlDomain:d,description:a,urlDescriptor:t&&{encoded:!0,url:t}}}if("Trip"===i.__typename){var l=i.title||void 0,r=i.description||void 0,s=i.route&&i.route.url||void 0;return{icon:"suitcase-fill",photo:i.photo&&i.photo.photoSizes||void 0,title:l,description:r,urlDescriptor:s&&{encoded:!1,url:s}}}return{}},K=function e(i){return{actor:Q(i),content:z(i),context:i.context,key:Object(W.getCacheKey)(i)}};n.d(i,"SocialContentDataProvider",function(){return q}),n.d(i,"mapContentToSummary",function(){return K}),n.d(i,"userProfileToActorSummary",function(){return B}),n.d(i,"mapContentToActorSummary",function(){return Q}),n.d(i,"mapContentToContentSummary",function(){return z})}}});
//# sourceMappingURL=social.mentions-data-provider.775618b3a2.js.map