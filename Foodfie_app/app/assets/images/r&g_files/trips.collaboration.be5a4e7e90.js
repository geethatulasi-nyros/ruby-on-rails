(window.$WP=window.$WP||[]).push({id:"@ta/trips.collaboration",d:["vendor-react-libs","ta-common","ta-platform","vendor-babel","vendor-apollo-libs","@ta/social.common-popover","@ta/overlays.toast","@ta/trips.trip-types","@ta/trips.trip-util","@ta/public.share-cta","@ta/overlays.popover","@ta/tracking.interactions"],e:["./packages/trips/collaboration/index.jsx"],x:{"./packages/common/webview/NativeBridge.jsx":["isActionSupported","postToBridge","hideSkeleton","onNewOrUpdatedScreen","showNativeOverflowMenu","showNativeMap","showNativeCreateTrip","showNativeShareTrip","showSavesModal","showRegistration","close","startScreenTransition","onOverlayStateChange","onHeaderHeightChange","onShrinkMap","onNavigateToTripDetail","onHandleTripCollaboration","onFlushBatchTracking","isNativeWebview","getHeaderHeight","onTripsRefetch","onTripUpdate","onTripItemDelete","onRefetchTripsWithItems"],"./packages/trips/collaboration/index.jsx":["AddFriendIcon","CollaboratorPanel","ShareTripPopup","ShareTripPopupAction"]},m:{"./packages/common/webview/NativeBridge.jsx":function(e,t,n){"use strict";function r(e){var t="";if(null!=e.tapCallback){var n=e.tapCallback,r="nativeInterop"+function a(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+e()+e()+e()+e()+e()+e()}();window[r]=function(){null!=n&&n()},t=r,e.tapFunction=t,e.tapCallback=null}}function a(){return"undefined"!=typeof window&&window.taBridgeContext?(window.bridge||function e(){var e,t,n;window.bridge||(window.bridge=(e=[],t=0,n=[],document.addEventListener("PacificDidReceiveNativeCallback",function(t){if(t.detail){var n=t.detail,r=isNaN(parseInt(n.id))?-1:parseInt(n.id);-1!=r&&(e[r]&&e[r](n.parameters,n.error),delete e[r])}},!1),document.addEventListener("PacificDidReceiveNativeBroadcast",function(e){if(e.detail){var t=e.detail,r=t.name;if(void 0!==r&&n[r]){var a=n[r];if(a instanceof Array){var i=t.parameters;a.forEach(function(e){e(i)})}}}},!1),{post:function n(r,a,i,o,l){var c=t++;e[c]=o,window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.pacific?window.webkit.messageHandlers.pacific.postMessage({action:r,parameters:a,uid:i,callback:c,print:l||0}):window.pacific&&window.pacific.postMessage(JSON.stringify({action:r,parameters:a,uid:i,callback:c,print:l||0}))},on:function e(t,r){var a=n[t];return a||(n[t]=a=[]),a.push(r),function(){a[indexOf(a,r)]=null}},off:function e(t){delete n[t]}}))}(),window.taBridgeContext.uid):null}function i(e,t){if("undefined"==typeof window||!window.taBridgeContext||!window.taBridgeContext.actions)return!1;var n=window.taBridgeContext.actions[e];return!(!n||!n.v)&&t===n.v}function o(e,t,n){a()&&(e?window.bridge.on(t,n):window.bridge.off(t))}function l(e){e.items.forEach(function(e,t){r(e)})}function c(e,t,n){var r=a();return!(!r||!i(e,t)||(window.bridge.post(e,n||{},r),0))}function s(){c("hideSkeleton",1,null)}function u(e){!function t(e){null!=e.trailingMenuItems&&e.trailingMenuItems.forEach(function(e,t){var n=e;r(n),null!=n.nestedMenu&&l(n.nestedMenu)})}(e.navigation),c("onNewOrUpdatedScreen",1,e)}function d(e){l(e),c("overflowMenu",1,e)}function p(){i("map",2)?c("map",2,null):c("map",1,null)}function m(e){c("createTrip",1,{isPublic:e})}function f(e){c("shareTrip",1,e)}n.r(t),n.d(t,"isActionSupported",function(){return i}),n.d(t,"postToBridge",function(){return c}),n.d(t,"hideSkeleton",function(){return s}),n.d(t,"onNewOrUpdatedScreen",function(){return u}),n.d(t,"showNativeOverflowMenu",function(){return d}),n.d(t,"showNativeMap",function(){return p}),n.d(t,"showNativeCreateTrip",function(){return m}),n.d(t,"showNativeShareTrip",function(){return f}),n.d(t,"showSavesModal",function(){return v}),n.d(t,"showRegistration",function(){return h}),n.d(t,"close",function(){return b}),n.d(t,"startScreenTransition",function(){return g}),n.d(t,"onOverlayStateChange",function(){return w}),n.d(t,"onHeaderHeightChange",function(){return k}),n.d(t,"onShrinkMap",function(){return T}),n.d(t,"onNavigateToTripDetail",function(){return y}),n.d(t,"onHandleTripCollaboration",function(){return N}),n.d(t,"onFlushBatchTracking",function(){return _}),n.d(t,"isNativeWebview",function(){return C}),n.d(t,"getHeaderHeight",function(){return S}),n.d(t,"onTripsRefetch",function(){return E}),n.d(t,"onTripUpdate",function(){return I}),n.d(t,"onTripItemDelete",function(){return P}),n.d(t,"onRefetchTripsWithItems",function(){return O});var v=function e(t){i("presentSavesModal",2)?c("presentSavesModal",2,t):c("presentSavesModal",1,{itemId:t.id})},h=function e(t){c("showReg",1,{dismissOnCancellation:t})};function b(){c("close",1,null)}function g(){c("startScreenTransition",1,null)}function w(e){c(e?"overlayShown":"overlayHidden",1,null)}function k(e,t){o(e,"updateHeaderHeight",t)}function T(e,t){o(e,"shrinkMap",t)}function y(e,t){o(e,"navigateToTripDetail",t)}function N(e,t){o(e,"handleTripCollaboration",t)}function _(e,t){o(e,"flushBatchTracking",t)}function C(){return null!=a()}function S(){if("undefined"!=typeof window&&void 0!==window.localStorage&&void 0!==window.localStorage.headerHeight){var e=window.localStorage.headerHeight;return"string"==typeof e&&(e=parseInt(e,10)),e}return 0}function E(e,t){o(e,"refetchTrips",t)}function I(e){c("tripUpdate",1,e)}function P(e){c("tripItemDelete",1,e)}function O(e,t){o(e,"refetchTripsWithItems",t)}},"./packages/trips/collaboration/index.jsx":function(e,t,n){"use strict";n.r(t);var r=n("react"),a=n("@ta/styleguide.icon"),i=n("@ta/common.classnames"),o=n.n(i),l=function e(t){var n=t.size||"default",i=t.tabletSize?"".concat(t.tabletSize||"default","-tablet"):null;return r.createElement("span",{onClick:t.onClick,ref:t.targetRef,className:o()("trips-collaboration-AddFriendIcon__addFriendsIcon--3DU5v","ui_social_avatar",n,i)},r.createElement(a.Icon,{name:"plus"}))};l.defaultProps={size:"default",tabletSize:void 0,onClick:void 0,targetRef:void 0};var c=l,s=n("@babel/runtime/helpers/esm/classCallCheck"),u=n.n(s),d=n("@babel/runtime/helpers/esm/createClass"),p=n.n(d),m=n("@babel/runtime/helpers/esm/possibleConstructorReturn"),f=n.n(m),v=n("@babel/runtime/helpers/esm/getPrototypeOf"),h=n.n(v),b=n("@babel/runtime/helpers/esm/inherits"),g=n.n(b),w=n("@babel/runtime/helpers/esm/assertThisInitialized"),k=n.n(w),T=n("@babel/runtime/helpers/esm/defineProperty"),y=n.n(T),N=n("react-redux"),_=n("react-apollo"),C=n("@ta/common.logging"),S=n.n(C),E=n("@ta/styleguide.avatar"),I=n("@ta/social.common-popover"),P=n("@ta/common.i18n"),O=n("@ta/overlays.toast"),M=n("./packages/common/webview/NativeBridge.jsx"),j=n("@ta/common.routing"),z=n("@ta/common.features"),U=(n("@ta/trips.trip-types"),n("@ta/trips.trip-util")),R=n("@ta/public.share-cta"),A=n("@ta/overlays.popover"),x=n.n(A),B=n("@ta/styleguide.loading"),D=n("@ta/events.window-scroll"),W=n.n(D),H=n("@ta/tracking.interactions"),L={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"CreateTripToken"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"tripId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"type"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"TripTokenTypeInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"createTripToken"},arguments:[{kind:"Argument",name:{kind:"Name",value:"tripId"},value:{kind:"Variable",name:{kind:"Name",value:"tripId"}}},{kind:"Argument",name:{kind:"Name",value:"type"},value:{kind:"Variable",name:{kind:"Name",value:"type"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"route"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:154}};L.loc.source={body:"a83754ae8236"};var F=L,V={READ:function e(){return Object(P.unescaped)(Object(P.localize)("trips_share_read_only",{className:"trips-collaboration-ShareTripPopup__strong--1W5pM"}))},WRITE:function e(){return Object(P.unescaped)(Object(P.localize)("trips_share_read_write",{className:"trips-collaboration-ShareTripPopup__strong--1W5pM"}))},PUBLIC:function e(){return Object(P.unescaped)(Object(P.localize)("trips_share_read_only",{className:"trips-collaboration-ShareTripPopup__strong--1W5pM"}))}},Q=function(e){function t(e){var n;u()(this,t),n=f()(this,h()(t).call(this,e));var r=e.trip.route&&e.trip.route.url||Object(U.buildPublicTripShareUrl)(e.trip.id),a="PUBLIC"===e.shareType?r:"";return n.state={shareUrl:a,shareUrlType:e.shareType},n}return g()(t,e),p()(t,[{key:"onTargetClick",value:function e(t,n){this.state.shareUrl&&this.state.shareUrlType===this.props.shareType||this.updateShareUrl(t),n()}},{key:"updateShareUrl",value:function e(t){var n=this;"PUBLIC"===this.props.shareType&&this.props.trip.route&&this.props.trip.route.url?this.setState({shareUrl:Object(U.buildPublicTripShareUrl)(this.props.trip.id),shareUrlType:"PUBLIC"}):t({variables:{tripId:this.props.trip.id,type:this.props.shareType}}).then(function(e){n.setState({shareUrl:e.data.createTripToken.route.url,shareUrlType:n.props.shareType})})}},{key:"renderContent",value:function e(){var t=this.state.shareUrl,n=this.props.trip,a=V[this.props.shareType](),i="WRITE"===this.props.shareType?"WriteTrip":"ReadTrip";return Object(U.isOwner)(n)||n&&n.actionPermissions&&n.actionPermissions.canEdit||(a=null,i="NotMyTrip"),t?r.createElement(r.Fragment,null,a&&r.createElement("div",{className:"trips-collaboration-ShareTripPopup__header--2IYWs"},a),r.createElement(R.ShareDropdownMenu,{url:t,itemType:i,itemId:"".concat(n.id)})):r.createElement(B.LoadingSpinner,{size:"small"})}},{key:"render",value:function e(){var t=this,n=this.props.closeOnScroll;return r.createElement(x.a,{local:!0,closeButton:!1,below:!0,alignEdge:this.props.alignEdge,arrowType:"small",shiftArrow:this.props.shiftArrow,contents:function e(){return t.renderContent()}},function(e,a,i){return r.createElement(r.Fragment,null,n&&r.createElement(W.a,{callback:i,throttle:500}),r.createElement(_.Mutation,{mutation:F},function(n){return t.props.children(e,function(){return t.onTargetClick(n,a)},t.state.shareUrl,i)}))})}}]),t}(r.Component);y()(Q,"defaultProps",{alignEdge:"left",shiftArrow:0,closeOnScroll:!1});var Y=function e(t){var n=t.trip,a=t.shareType,i=t.alignEdge,o=t.onClick;return r.createElement(Q,{trip:n,shareType:a,alignEdge:i},function(e,t,a){return r.createElement(R.ShareTracker,{itemType:"Trip",itemId:"".concat(n.id),url:a,action:"share_button_click"},function(){return r.createElement(H.InteractionLogger,null,function(n){return r.createElement(R.ShareTarget,{onClick:function e(r){o&&o(),n(r,"share"),t()},target:e,styleAsSocialAction:!0})})})})};Y.defaultProps={onClick:void 0};var X={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"RemoveCollaborator"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"collaboratorId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteTripCollaborator"},arguments:[{kind:"Argument",name:{kind:"Name",value:"collaboratorId"},value:{kind:"Variable",name:{kind:"Name",value:"collaboratorId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:126}};X.loc.source={body:"7b72702e26c2"};var Z=X,$=function e(t){var n=t.user,a=t.contextNode,i=t.avatarNotLazy,l="/Profile/".concat(n.username),c=r.createElement(E.Avatar,{notLazy:i,size:"default",href:l,withBorder:!0,photo:n.avatar,mobileTarget:"_self"});return r.createElement("div",{className:"trips-collaboration-CollaboratorPanel__collabItem--7CobX"},c,r.createElement("a",{href:l,className:o()("trips-collaboration-CollaboratorPanel__displayName--15F6v","ui_link")},n.displayName),a&&r.createElement("div",{className:"trips-collaboration-CollaboratorPanel__context--q5ah3"},a))},q=function e(t){var n=t.trip;return r.createElement(Q,{shiftArrow:7,trip:n,shareType:"WRITE"},function(e,t){return r.createElement("div",{className:o()("trips-collaboration-CollaboratorPanel__collabItem--7CobX","trips-collaboration-CollaboratorPanel__collabHeader--1NWZG")},r.createElement(c,{onClick:t,targetRef:e}),r.createElement("div",{onClick:t,className:o()("trips-collaboration-CollaboratorPanel__addFriendsText--2Y-_Z","ui_link")},Object(P.localize)("trips_add_CTA")))})},G=function(e){function t(){var e,n;u()(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return n=f()(this,(e=h()(t)).call.apply(e,[this].concat(i))),y()(k()(k()(n)),"getContextNode",function(e,t,r){return Object(U.getCollabPermissions)(t,!1).canRemove?n.renderConfirmationAndContent(t,r):null}),y()(k()(k()(n)),"renderConfirmationAndContent",function(e,t){var a,i,o,l=e.user;(void 0===l?{}:l).isMe?(a=Object(P.localize)("trips_leave_trip_modal_header"),i=Object(P.localize)("trips_leave_trip_modal_body"),o=Object(P.localize)("trips_leave_CTA")):(a=Object(P.localize)("trips_remove_collaborator_modal_header"),i=Object(P.localize)("trips_remove_collaborator_modal_body"),o=Object(P.localize)("trips_remove_CTA"));var c=o,s=Object(P.localize)("stat_modal_cancel"),u=function n(){return t(e)},d=null;return n.props.isNativeWebview&&(d=function e(){return M.showNativeOverflowMenu({treatment:"alert",title:a,subtitle:i,items:[{title:s,tapCallback:function e(){}},{preferred:!0,title:c,destructive:!0,tapCallback:u}]})}),r.createElement(I.ConfirmationPopover,{header:a,description:i,cancel:s,confirm:c,above:!0,alignEdge:"right",shiftY:30,onConfirm:u,onCancel:null},function(t,a){return r.createElement("div",{ref:t,onClick:function t(){(d||a)(),n.props.onRemoveShow&&n.props.onRemoveShow(e)},className:"ui_link"},o)})}),n}return g()(t,e),p()(t,[{key:"renderPanel",value:function e(t){var n=this,a=this.props,i=a.trip.collaborators,o=r.createElement("div",{className:"trips-collaboration-CollaboratorPanel__owner--3B41y"},Object(P.localize)("trips_owner")),l=Object(U.getTripPermissions)(a.trip,!1);return r.createElement("div",{className:"trips-collaboration-CollaboratorPanel__collabWrap--YsDEu"},l.canAddCollaborators&&!a.readOnly&&r.createElement(q,{trip:a.trip}),r.createElement("div",{className:"trips-collaboration-CollaboratorPanel__collabList--lebL5"},a.trip.owner&&r.createElement($,{user:a.trip.owner,contextNode:o,avatarNotLazy:a.avatarNotLazy}),i&&i.map(function(e){return e.user&&r.createElement($,{key:e.userId,user:e.user,avatarNotLazy:a.avatarNotLazy,contextNode:!a.readOnly&&n.getContextNode(a.trip,e,t)})})))}},{key:"render",value:function e(){var t=this;return Object(z.featureIsEnabled)("trips_2018_collab")?r.createElement(j.RouteConsumer,null,function(e){var n=e.navigate;return r.createElement(O.Toaster,null,function(e){return r.createElement(_.Mutation,{mutation:Z,refetchQueries:t.props.refetchQueries,awaitRefetchQueries:!0,onError:function e(t){return S.a.error(t)}},function(a){return t.renderPanel(function i(o){t.props.onRemove&&t.props.onRemove(o),a({variables:{collaboratorId:o.id}}).then(function(){var a=o.user&&o.user.isMe;if("PUBLIC"!==t.props.trip.status&&a)n({page:"Trips"});else{var i=o.user&&o.user.displayName||Object(P.localize)("trips_unknown_user");e({node:r.createElement("div",null,Object(P.localize)("trips_collaborator_removed_confirm",{UserName:i}))})}})})})})}):null}}]),t}(r.PureComponent);y()(G,"defaultProps",{isNativeWebview:!1,refetchQueries:[],readOnly:!1,onRemoveShow:void 0,onRemove:void 0,avatarNotLazy:!1});var J=Object(N.connect)(function(e){return{loggedInUserId:e.auth.loggedInUserId,isNativeWebview:e.meta.isNativeWebview}})(G);n.d(t,"AddFriendIcon",function(){return c}),n.d(t,"CollaboratorPanel",function(){return J}),n.d(t,"ShareTripPopup",function(){return Q}),n.d(t,"ShareTripPopupAction",function(){return Y})}}});
//# sourceMappingURL=trips.collaboration.be5a4e7e90.js.map