(window.$WP=window.$WP||[]).push({id:"@ta/memx.google-onetap",d:["vendor-react-libs","@ta/social.onboarding-utils","@ta/social.onboarding-state","ta-platform","@ta/common.sessionstorage","vendor-babel"],e:["./packages/memx/google-onetap/GoogleOneTapController.jsx"],x:{"./packages/memx/google-onetap/GoogleOneTapController.jsx":["default"]},m:{"./packages/memx/google-onetap/GoogleOneTapController.jsx":function(e,o,t){"use strict";t.r(o);var n=t("react"),a=t("@ta/social.onboarding-utils"),r=t("@ta/social.onboarding-state"),s=t("@ta/common.api"),i=t("@babel/runtime/helpers/esm/classCallCheck"),l=t.n(i),u=t("@babel/runtime/helpers/esm/possibleConstructorReturn"),c=t.n(u),d=t("@babel/runtime/helpers/esm/getPrototypeOf"),g=t.n(d),p=t("@babel/runtime/helpers/esm/createClass"),m=t.n(p),v=t("@babel/runtime/helpers/esm/inherits"),h=t.n(v),_=t("@babel/runtime/helpers/esm/assertThisInitialized"),f=t.n(_),b=t("@babel/runtime/helpers/esm/defineProperty"),w=t.n(b),y=t("react-redux"),O=t("@ta/common.radio"),T=t.n(O),k=t("@ta/common.features"),E=t("@ta/common.logging"),C=t.n(E),G=t("@ta/common.sessionstorage"),S=t.n(G),I=t("@ta/common.tracking"),L=t.n(I),j=40185,x=55978451,M="googleOneTapTime",A="googleOneTapDismissed",D="50px",q="0px",P="-16px",R="-3px",F=["Hotel_Review","Hotels","SmartDeals","HotelHighlight","HotelsNear","HotelsList"],H=["Home","Tourism","MobileTourism","ShowTopic","MobileShowTopic"];function N(e,o){L()({module:"google_onetap",action:e,context:"".concat(e.replace(/^google_onetap_/,""),"_").concat(o||"unknown"),value:j})}function B(e){C.a.warn("Unknown error processing Google onetap hint request - type, message: ".concat(e.type,", ").concat(e.message))}function Y(){S.a.set(A,(new Date).getTime())}function J(){S.a.set(M,(new Date).getTime())}function Q(){S.a.set(M,0)}function z(e){var o=document.getElementsByClassName("close_ad");o&&0!==o.length&&(o[0].style.top=e?P:R)}function U(e){var o=document.getElementsByClassName("google-inserted-onetap-frame");o&&0!==o.length&&(o[0].style.bottom=e?q:D)}var W={supportedAuthMethods:["https://accounts.google.com"],supportedIdTokenProviders:[{uri:"https://accounts.google.com",clientId:"1070328450902.apps.googleusercontent.com"}]},$=function(e){function o(e){var t;return l()(this,o),t=c()(this,g()(o).call(this,e)),w()(f()(f()(t)),"onGoogleYoloLoad",function(e){return t.googleyolo=e,(t.state.shouldMoveOneTap||function o(){var e=document.querySelector("#FIXED_AD .gptAd");if(!e)return!1;var o=e.getAttribute("data-advertiser-id");return o&&o!==x.toString()}())&&(N("google_onetap_adhesion_detected",t.props.servlet),t.setupGoogleYoloIframeObserver(),T()("cpm_mw_adhesion").on("ad_closed",function(){U(!0)})),Object(k.featureIsEnabled)("google_onetap_web_component_autologin")?t.retrieve():t.hint()}),w()(f()(f()(t)),"googleyolo",void 0),w()(f()(f()(t)),"handleAutoLoginSuccess",function(e){e.idToken&&(N("google_onetap_autologin_selected",t.props.servlet),z(!0),t.showRegOverlay(e))}),w()(f()(f()(t)),"handleOneTapSuccess",function(e){e.idToken&&(N("google_onetap_hint_selected",t.props.servlet),z(!0),t.showRegOverlay(e))}),w()(f()(f()(t)),"handleAutoLoginError",function(e){switch(z(!0),e.type){case"userCanceled":Y(),N("google_onetap_autologin_closed",t.props.servlet);break;case"noCredentialsAvailable":N("google_onetap_autologin_no_credentials",t.props.servlet),t.hint();break;case"requestFailed":N("google_onetap_autologin_request_failed",t.props.servlet),Q();break;case"unsupportedBrowser":N("google_onetap_autologin_unsupported_browser",t.props.servlet);break;case"operationCanceled":case"illegalConcurrentRequest":case"initializationError":case"configurationError":default:N("google_onetap_autologin_unknown_error",t.props.servlet),B(e)}}),w()(f()(f()(t)),"handleOneTapError",function(e){switch(z(!0),e.type){case"userCanceled":Y(),N("google_onetap_hint_closed",t.props.servlet);break;case"noCredentialsAvailable":N("google_onetap_hint_no_credentials",t.props.servlet);break;case"requestFailed":N("google_onetap_hint_request_failed",t.props.servlet),Q();break;case"unsupportedBrowser":N("google_onetap_hint_unsupported_browser",t.props.servlet);break;case"operationCanceled":case"illegalConcurrentRequest":case"initializationError":case"configurationError":default:N("google_onetap_hint_unknown_error",t.props.servlet),B(e)}}),t.state={hasOneTapAlreadyLoaded:!1,shouldMoveOneTap:!1},t}return h()(o,e),m()(o,null,[{key:"isQualtricsEnabled",value:function e(){return new Promise(function(e){Object(k.featureIsEnabled)("qualtrics_surveys_any")&&window.require(["ta/support/Qualtrics"],function(o){e(o.seenThisPageView()||o.canDisplaySmart()||o.canDisplay())}),e(!1)})}}]),m()(o,[{key:"componentDidMount",value:function e(){var t=this;(function n(){return function e(){var e=S.a.get(A);return void 0!==e&&e+864e5>(new Date).getTime()}()||function o(){var e=S.a.get("lastSignOutTime");return void 0!==e&&e+864e5>(new Date).getTime()}()||function t(){var e=S.a.get(M);return void 0!==e&&e+18e4>(new Date).getTime()}()&&!Object(k.featureIsEnabled)("google_onetap_persistent")})()||o.isQualtricsEnabled().then(function(e){e||t.setupGoogleOneTap()})}},{key:"componentDidUpdate",value:function e(o){!o.isMember&&this.props.isMember&&this.dismissGoogleOneTap()}},{key:"setupGoogleOneTap",value:function e(){var o=this;if(N("google_onetap_requested",this.props.servlet),H.includes(this.props.servlet)||Object(k.featureIsEnabled)("google_onetap_web_component"))if(F.includes(this.props.servlet)&&(T()("DatePicker").on("clicked",function(){o.dismissGoogleOneTap()}),T()("responsiveStayDates").on("calendarInteracted",function(){o.dismissGoogleOneTap()})),function t(){return!function e(){return Object(k.featureIsEnabled)("mobile_fixed_ad")}()||function o(){var e=S.a.get("ads.fixed.close");return void 0!==e&&"true"===e}()}())this.loadGoogleJavascript();else{var n=window.googletag||{cmd:[]};n.cmd.push(function(){n.pubads().addEventListener("slotRenderEnded",function(e){(null==e?void 0:e.advertiserId)!==x&&(o.state.shouldMoveOneTap=!0),o.loadGoogleJavascript()})}),setTimeout(function(){o.loadGoogleJavascript()},4e3)}}},{key:"setupGoogleYoloIframeObserver",value:function e(){var o=this,t=new MutationObserver(function(e){e.forEach(function(e){e.addedNodes.forEach(function(e){"IFRAME"===e.nodeName&&e.src.includes("smartlock.google.com/iframe/")&&(t.disconnect(),e.classList.add("google-inserted-onetap-frame"),setTimeout(function(){U(!1),z(!1),N("google_onetap_modal_moved_above_adhesion",o.props.servlet)},1e3))})})});t.observe(window.document.body,{childList:!0})}},{key:"loadGoogleJavascript",value:function e(){if(!this.state.hasOneTapAlreadyLoaded&&(this.state.hasOneTapAlreadyLoaded=!0,window.onGoogleYoloLoad=this.onGoogleYoloLoad,null===document.getElementById("google-smartlock-api-js"))){var o=document.createElement("script");o.id="google-smartlock-api-js",o.src="https://smartlock.google.com/client",o.async=!0,null!=document.body&&document.body.appendChild(o)}}},{key:"dismissGoogleOneTap",value:function e(){window.onGoogleYoloLoad=void 0,this.googleyolo&&this.googleyolo.cancelLastOperation()}},{key:"retrieve",value:function e(){return J(),N("google_onetap_autologin_requested",this.props.servlet),window.googleyolo.retrieve(W).then(this.handleAutoLoginSuccess,this.handleAutoLoginError)}},{key:"hint",value:function e(){return J(),N("google_onetap_hint_requested",this.props.servlet),window.googleyolo.hint(W).then(this.handleOneTapSuccess,this.handleOneTapError)}},{key:"showRegOverlay",value:function e(o){var t=this;window.require(["ta/registration/RegOverlay"],function(e){var n="MOBILE"===t.props.viewportCategory;e.showRegOverlay(null,null,n,{flow:"GOOGLE_ONETAP",pid:j,userRequestedForce:"true",extraQueryParams:{google_id_token:o.idToken},displayOnShowOverlay:!0,onSuccess:function e(o){o&&o.user_id&&"Home"===t.props.servlet&&t.props.setShouldFire(!1,"GOOGLE_ONETAP")}})})}},{key:"render",value:function e(){return null}}]),o}(n.Component),V=Object(y.connect)(function(e){return{isMember:e.auth.isMember,servlet:e.meta.initialServletName,viewportCategory:e.meta.device.viewportCategory}},{setShouldFire:r.ACTIONS.setShouldFire})($);o.default=Object(s.bind)(function(e,o){var t=o("/data/1.0/onboarding/shown");return function(){var o=t.get().data;return{isMember:e.auth.isMember,servlet:e.meta.initialServletName,viewportCategory:e.meta.device.viewportCategory,entryPoint:Object(r.getState)(e).entryPoint,cachedCookieFound:o?o.seen:null}}})(function e(o){return o.isMember?null:"Home"!==o.servlet||function t(e,o,n,r){return Object(a.isOnboardingDisabledThroughFeature)(e,o,n)||null!==r&&r}(o.entryPoint,o.viewportCategory,o.servlet,o.cachedCookieFound)?"Home"===o.servlet&&Object(a.isHomePageMemberGateEnabled)()?null:function r(){return!Object(k.featureIsEnabled)("google_onetap_web_component_mobile_adhesion")&&Object(k.featureIsEnabled)("mobile_fixed_ad")}()?null:function s(e){return!Object(k.featureIsEnabled)("google_onetap_web_component_hotel_servlets")&&F.includes(e)}(o.servlet)?null:n.createElement(V,null):null})}}});
//# sourceMappingURL=memx.google-onetap.3458fb11e0.js.map