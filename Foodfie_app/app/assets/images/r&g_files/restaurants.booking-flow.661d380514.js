(window.$WP=window.$WP||[]).push({id:"@ta/restaurants.booking-flow",d:["vendor-babel","vendor-react-libs","ta-platform","ta-common"],e:["./packages/restaurants/booking-flow/BookingFlow.jsx"],x:{"./packages/restaurants/booking-flow/BookingFlow.jsx":["default"]},m:{"./packages/restaurants/booking-flow/BookingFlow.jsx":function(e,t,r){"use strict";r.r(t);var a=r("@babel/runtime/helpers/esm/classCallCheck"),n=r.n(a),o=r("@babel/runtime/helpers/esm/createClass"),s=r.n(o),i=r("@babel/runtime/helpers/esm/possibleConstructorReturn"),l=r.n(i),c=r("@babel/runtime/helpers/esm/getPrototypeOf"),u=r.n(c),m=r("@babel/runtime/helpers/esm/inherits"),d=r.n(m),p=r("@babel/runtime/helpers/esm/assertThisInitialized"),_=r.n(p),h=r("@babel/runtime/helpers/esm/defineProperty"),f=r.n(h),g=r("react"),v=r("@ta/common.state"),E=r("@ta/common.tracking"),b=r.n(E),N={LOADING_SCREEN:"LOADING_SCREEN",USER_INPUT_SCREEN:"USER_INPUT_SCREEN",RESERVING_SCREEN:"RESERVING_SCREEN",CONFIRMATION_SCREEN:"CONFIRMATION_SCREEN",ERROR_SCREEN:"ERROR_SCREEN"},k=r("@babel/runtime/helpers/esm/typeof"),C=r.n(k),S=r("@ta/common.i18n"),y=r("@ta/styleguide.loading"),I=function e(t){return g.createElement("div",{className:"restaurants-booking-flow-screens-LoadingScreen__loadingScreen--wC_mw"},g.createElement("div",{className:"restaurants-booking-flow-screens-LoadingScreen__loading--1_Cef"},Object(S.localize)("nsp.locationSelect.loading")),g.createElement("div",{className:"restaurants-booking-flow-screens-LoadingScreen__attribution--3sxkV"},t.providerLogoUrl?g.createElement("img",{className:"restaurants-booking-flow-screens-LoadingScreen__logo--15_TV",src:t.providerLogoUrl}):g.createElement("span",null,t.providerName)),g.createElement("div",{className:"restaurants-booking-flow-screens-LoadingScreen__bubbles--1X5QT"},g.createElement(y.LoadingBubbles,{size:"large",color:"light"})))},w=r("@babel/runtime/helpers/esm/objectWithoutProperties"),O=r.n(w),R=r("@babel/runtime/helpers/esm/slicedToArray"),U=r.n(R),F=r("@babel/runtime/helpers/esm/objectSpread"),P=r.n(F),T=r("@ta/common.cdn"),V=r("@ta/styleguide.button"),D=r.n(V),L="restaurants-booking-flow-components-InputFields__inputFieldContainer--i1Hz-",j="restaurants-booking-flow-components-InputFields__boldLabel--3c3yN",z="restaurants-booking-flow-components-InputFields__inputField--KNrNK",x="restaurants-booking-flow-components-InputFields__errorInput--119lh",M="restaurants-booking-flow-components-InputFields__validationErrorMessage--3WeVc",B=function e(t){return g.createElement("div",{className:L},g.createElement("label",{htmlFor:t.fieldName,className:j},t.fieldLabel),g.createElement("input",{id:t.fieldName,type:"text",value:t.value,onChange:t.onChange,name:t.fieldName,className:"".concat(z," ").concat("restaurants-booking-flow-components-InputFields__textInput--37EOn"," ").concat(t.hasValidationError?x:"")}),t.hasValidationError&&g.createElement("div",{className:M},t.validationErrorMessage))},H=function e(t){return g.createElement("div",{className:L},g.createElement("label",{htmlFor:t.fieldName,className:j},t.fieldLabel),g.createElement("textarea",{id:t.fieldName,value:t.value,onChange:t.onChange,className:"".concat(z," ").concat("restaurants-booking-flow-components-InputFields__textAreaInput--1b51-"," ").concat(t.hasValidationError?x:"")}),t.hasValidationError&&g.createElement("div",{className:M},t.validationErrorMessage))},A=function e(t){return g.createElement("div",{className:L},g.createElement("div",{className:"ui_checkbox"},g.createElement("input",{id:t.fieldName,type:"checkbox",value:t.value,onChange:t.onChange,className:"".concat(z," ").concat("restaurants-booking-flow-components-InputFields__checkboxInput--2hJOg"," ").concat(t.hasValidationError?x:"")}),g.createElement("label",{htmlFor:t.fieldName,className:"restaurants-booking-flow-components-InputFields__checkboxText--7jz9i"},t.fieldLabel)),t.hasValidationError&&g.createElement("div",{className:M},t.validationErrorMessage))},q=function e(t){return g.createElement("div",{className:L},g.createElement("label",{htmlFor:"phone_number",className:j},Object(S.localize)("restaurant_booking_phone_number")," "),g.createElement("div",{className:"".concat("restaurants-booking-flow-components-InputFields__countryPhoneCodeInput--2A5o1"," ").concat(z," ").concat(t.countryPhoneCodeHasValidationError?x:"")},g.createElement("div",{className:"restaurants-booking-flow-components-InputFields__countryPhoneCodeDropDown--8_-kE"},g.createElement("span",{className:"restaurants-booking-flow-components-InputFields__countryPhoneCodeDisplay--Fl1Tb"},t.countryPhoneCodeValue?"+".concat(t.countryPhoneCodeValue):g.createElement("span",{className:"ui_icon single-chevron-down"})),g.createElement("select",{value:t.countryPhoneCodeValue,onChange:function e(r){t.countryPhoneCodeOnChange(r)}},g.createElement("option",{key:"NONE",value:""},Object(S.localize)("booking_form_select_a_country_code")),Object.values(t.allCountryCodeData).map(function(e){var t=e.countryCode,r=e.countryPhoneCode,a=e.countryPhoneCodeDisplay;return g.createElement("option",{key:t,value:r},a)})))),g.createElement("input",{id:"phone_number",type:"text",placeholder:t.phoneNumberHint,value:t.phoneNumberValue,onChange:t.phoneNumberOnChange,name:"phone_number",className:"".concat(z," ").concat("restaurants-booking-flow-components-InputFields__phoneInput--3PyqE"," ").concat(t.phoneNumberHasValidationError?x:""," ").concat(t.countryPhoneCodeHasValidationError?"restaurants-booking-flow-components-InputFields__leftSideError--3CHmF":"")}),(t.phoneNumberHasValidationError||t.countryPhoneCodeHasValidationError)&&g.createElement("div",{className:"".concat(M)},t.phoneNumberValidationErrorMessage||t.countryPhoneCodeValidationErrorMessage))},G=function e(t){return{value:t,hasValidationError:!1,validationErrorMessage:""}},W=function e(t){return{value:t,hasValidationError:!1,validationErrorMessage:""}},J=function(e){function t(){var e,r;n()(this,t);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return r=l()(this,(e=u()(t)).call.apply(e,[this].concat(o))),f()(_()(_()(r)),"state",{first_name:G(r.props.memberInfo&&r.props.memberInfo.firstName?r.props.memberInfo.firstName:""),last_name:G(r.props.memberInfo&&r.props.memberInfo.lastName?r.props.memberInfo.lastName:""),email_address:G(r.props.memberInfo&&r.props.memberInfo.email?r.props.memberInfo.email:""),country_code:G(r.getCountryPhoneCode(r.props.countryCodeForCurrentLocale)),phone_number:G(""),special_requests:G(""),provider_newsletter_opt_in:W(!1),restaurant_newsletter_opt_in:W(!1)}),r}return d()(t,e),s()(t,[{key:"getCountryPhoneCode",value:function e(t){return this.props.allCountryCodeData&&t in this.props.allCountryCodeData?this.props.allCountryCodeData[t].countryPhoneCode:""}},{key:"getUserInput",value:function e(){return{firstName:this.state.first_name.value,lastName:this.state.last_name.value,email:this.state.email_address.value,countryPhoneCode:this.state.country_code.value,phoneNum:this.state.phone_number.value,specialInstructions:this.state.special_requests.value,optionalEmail:this.state.provider_newsletter_opt_in.value,newsletter:this.state.restaurant_newsletter_opt_in.value}}},{key:"fieldChangeHandler",value:function e(t){var r=this;return function(e){r.setState(f()({},t,P()({},r.state[t],{value:e.target.value})))}}},{key:"validateForm",value:function e(){var t=this,r=!0;Object.entries(this.props.bookingFields.fields).forEach(function(e){var a=U()(e,2),n=a[0];"REQUIRED"!==a[1]||t.state[n].value?t.setState(f()({},n,P()({},t.state[n],{hasValidationError:!1,validationErrorMessage:""}))):(t.setState(f()({},n,P()({},t.state[n],{hasValidationError:!0,validationErrorMessage:Object(S.localize)("native_login_required")}))),r=!1)});var a=this.state.email_address.value;return a&&!/\S+@\S+\.\S+/.test(a)?(this.setState({email_address:P()({},this.state.email_address,{hasValidationError:!0,validationErrorMessage:Object(S.localize)("mobile_sherpa_invalid_email")})}),r=!1):a&&this.setState({email_address:P()({},this.state.email_address,{hasValidationError:!1,validationErrorMessage:""})}),r}},{key:"render",value:function e(){var t=this,r=this.props.bookingFields.fields,a=this.props.bookingFields,n=(a.fields,O()(a,["fields"]));return g.createElement("div",{className:"restaurants-booking-flow-screens-UserInputScreen__userInputScreen--3ZI34"},g.createElement("div",{className:"restaurants-booking-flow-screens-UserInputScreen__header--2Z9L8"},g.createElement("div",{className:"restaurants-booking-flow-screens-UserInputScreen__topInfo--bIHQU"},g.createElement("div",{className:"restaurants-booking-flow-screens-UserInputScreen__headerComponent--qIW_8"},this.props.restaurantPhotoUrl?g.createElement("img",{src:this.props.restaurantPhotoUrl,alt:this.props.restaurantName,className:"restaurants-booking-flow-screens-UserInputScreen__restaurantImage--Def6R"}):g.createElement(T.CdnImage,{src:"/img2/social/no_photo_restaurant.gif",alt:this.props.restaurantName,className:"restaurants-booking-flow-screens-UserInputScreen__restaurantImage--Def6R"})),g.createElement("div",{className:"".concat("restaurants-booking-flow-screens-UserInputScreen__headerComponent--qIW_8"," ").concat("restaurants-booking-flow-screens-UserInputScreen__restaurantHeader--25vgk")},g.createElement("div",{className:"restaurants-booking-flow-screens-UserInputScreen__restaurantName--27tof"},this.props.restaurantName),g.createElement("div",null,Object(S.localize)("restaurant_booking_date_at",{date:S.globalize.formatDate("week_long_date_medium_month",new Date(this.props.reservationDatetime)),time:S.globalize.formatDate("time_12_24",new Date(this.props.reservationDatetime))})),g.createElement("div",{className:"restaurants-booking-flow-screens-UserInputScreen__tableSize--3ErrL"},Object(S.localize)("restaurant_booking_table_for",{nCount:this.props.reservationPartySize})))),g.createElement("div",{className:"restaurants-booking-flow-screens-UserInputScreen__providerSection--2-i8N"},g.createElement("div",{className:"".concat("restaurants-booking-flow-screens-UserInputScreen__headerComponent--qIW_8")},this.props.providerLogoUrl?g.createElement("img",{src:this.props.providerLogoUrl,className:"restaurants-booking-flow-screens-UserInputScreen__logo--2PWnG"}):g.createElement("span",{className:"restaurants-booking-flow-screens-UserInputScreen__logo--2PWnG"},this.props.providerName))),this.props.specialOfferInfo&&g.createElement(g.Fragment,null,g.createElement("div",{className:"restaurants-booking-flow-screens-UserInputScreen__specialOfferTitle--Qv-PN"},this.props.specialOfferInfo.title),g.createElement("div",{className:"restaurants-booking-flow-screens-UserInputScreen__specialOfferDescription--31xVL"},this.props.specialOfferInfo.description," ",this.props.specialOfferInfo.exclusions))),g.createElement("div",null,"NONE"!==r.first_name&&g.createElement(B,{fieldName:"first_name",fieldLabel:Object(S.localize)("restaurant_booking_first_name"),value:this.state.first_name.value,onChange:this.fieldChangeHandler("first_name"),hasValidationError:this.state.first_name.hasValidationError,validationErrorMessage:this.state.first_name.validationErrorMessage}),"NONE"!==r.last_name&&g.createElement(B,{fieldName:"last_name",fieldLabel:Object(S.localize)("restaurant_booking_last_name"),value:this.state.last_name.value,onChange:this.fieldChangeHandler("last_name"),hasValidationError:this.state.last_name.hasValidationError,validationErrorMessage:this.state.last_name.validationErrorMessage}),"NONE"!==r.email_address&&g.createElement(B,{fieldName:"email_address",fieldLabel:Object(S.localize)("restaurant_booking_email"),value:this.state.email_address.value,onChange:this.fieldChangeHandler("email_address"),hasValidationError:this.state.email_address.hasValidationError,validationErrorMessage:this.state.email_address.validationErrorMessage}),"NONE"!==r.phone_number&&g.createElement(q,{allCountryCodeData:this.props.allCountryCodeData,countryPhoneCodeValue:this.state.country_code.value,countryPhoneCodeOnChange:this.fieldChangeHandler("country_code"),countryPhoneCodeHasValidationError:this.state.country_code.hasValidationError,countryPhoneCodeValidationErrorMessage:this.state.country_code.validationErrorMessage,phoneNumberValue:this.state.phone_number.value,phoneNumberHint:n.phone_hint,phoneNumberOnChange:this.fieldChangeHandler("phone_number"),phoneNumberHasValidationError:this.state.phone_number.hasValidationError,phoneNumberValidationErrorMessage:this.state.phone_number.validationErrorMessage}),"NONE"!==r.special_requests&&g.createElement(H,{fieldName:"special_requests",fieldLabel:Object(S.localize)("restaurant_booking_special_requests"),value:this.state.special_requests.value,onChange:this.fieldChangeHandler("special_requests"),hasValidationError:this.state.special_requests.hasValidationError,validationErrorMessage:this.state.special_requests.validationErrorMessage}),g.createElement(A,{fieldName:"provider_newsletter_opt_in",fieldLabel:n.provider_newsletter_opt_in,value:this.state.provider_newsletter_opt_in.value,onChange:this.fieldChangeHandler("provider_newsletter_opt_in"),hasValidationError:this.state.provider_newsletter_opt_in.hasValidationError,validationErrorMessage:this.state.provider_newsletter_opt_in.validationErrorMessage}),"NONE"!==r.newsletter&&g.createElement(A,{fieldName:"restaurant_newsletter_opt_in",fieldLabel:n.restaurant_newsletter_opt_in,value:this.state.restaurant_newsletter_opt_in.value,onChange:this.fieldChangeHandler("restaurant_newsletter_opt_in"),hasValidationError:this.state.restaurant_newsletter_opt_in.hasValidationError,validationErrorMessage:this.state.restaurant_newsletter_opt_in.validationErrorMessage}),g.createElement("div",{className:"restaurants-booking-flow-screens-UserInputScreen__confirmVisaContainer--3fXwm"},g.createElement("div",{className:"restaurants-booking-flow-screens-UserInputScreen__confirm--fETxm"},g.createElement(D.a,{size:"fullwidth",onClick:function e(){var r=t.validateForm();b()({module:"Restaurant_bookingform",action:"make_reservation_click|".concat(r?"valid":"invalid"),context:t.props.providerName}),!0===r&&t.props.onValidationSuccess(t.getUserInput())}},Object(S.localize)("opentable_complete_reservation"))),n.visa_text&&g.createElement("div",{className:"restaurants-booking-flow-screens-UserInputScreen__visaSponsor--3k5oP"},n.visa_logo_url&&g.createElement("img",{src:n.visa_logo_url,className:"restaurants-booking-flow-screens-UserInputScreen__visaLogo--3au1B"}),n.visa_text)),g.createElement("div",{className:"restaurants-booking-flow-screens-UserInputScreen__termsText--AHvRb"},Object(S.unescaped)(n.terms_text))))}}]),t}(g.Component),X=function e(t){return g.createElement("div",{className:"restaurants-booking-flow-screens-ReservingScreen__reservingScreen--1HV_O"},g.createElement("div",{className:"restaurants-booking-flow-screens-ReservingScreen__reserving--2XKC2"},Object(S.localize)("restaurants_finding_your_table")," "),g.createElement("div",{className:"restaurants-booking-flow-screens-ReservingScreen__attribution--BOlVl"},t.providerLogoUrl?g.createElement("img",{className:"restaurants-booking-flow-screens-ReservingScreen__logo--28188",src:t.providerLogoUrl}):g.createElement("span",null,t.providerName)),g.createElement("div",{className:"restaurants-booking-flow-screens-ReservingScreen__bubbles--3uWQs"},g.createElement(y.LoadingBubbles,{size:"large",color:"light"})))},Q=function e(t){return g.createElement("div",{className:"restaurants-booking-flow-screens-ConfirmationScreen__confirmationScreen--2CMdm"},g.createElement("div",{className:"restaurants-booking-flow-screens-ConfirmationScreen__header--2Pa1k"},g.createElement("div",{className:"restaurants-booking-flow-screens-ConfirmationScreen__topInfo--3J27Y"},g.createElement("div",{className:"restaurants-booking-flow-screens-ConfirmationScreen__headerComponent--266NC"},t.restaurantPhotoUrl?g.createElement("img",{src:t.restaurantPhotoUrl,alt:t.restaurantName,className:"restaurants-booking-flow-screens-ConfirmationScreen__restaurantImage--2vlwJ"}):g.createElement(T.CdnImage,{src:"/img2/social/no_photo_restaurant.gif",alt:t.restaurantName,className:"restaurants-booking-flow-screens-ConfirmationScreen__restaurantImage--2vlwJ"})),g.createElement("div",{className:"".concat("restaurants-booking-flow-screens-ConfirmationScreen__headerComponent--266NC"," ").concat("restaurants-booking-flow-screens-ConfirmationScreen__restaurantHeader--3GAxN")},g.createElement("div",{className:"restaurants-booking-flow-screens-ConfirmationScreen__restaurantName--3zigZ"},t.restaurantName),g.createElement("div",null,Object(S.localize)("restaurant_booking_date_at",{date:S.globalize.formatDate("week_long_date_medium_month",new Date(t.reservationDatetime)),time:S.globalize.formatDate("time_12_24",new Date(t.reservationDatetime))})),g.createElement("div",{className:"restaurants-booking-flow-screens-ConfirmationScreen__tableSize--38o-x"},Object(S.localize)("restaurant_booking_table_for",{nCount:t.reservationPartySize})))),g.createElement("div",{className:"restaurants-booking-flow-screens-ConfirmationScreen__providerSection--2tS9G"},g.createElement("div",{className:"".concat("restaurants-booking-flow-screens-ConfirmationScreen__headerComponent--266NC")},t.providerLogoUrl?g.createElement("img",{src:t.providerLogoUrl,className:"restaurants-booking-flow-screens-ConfirmationScreen__logo--8lJ3z"}):g.createElement("span",{className:"restaurants-booking-flow-screens-ConfirmationScreen__logo--8lJ3z"},t.providerName))),t.specialOfferInfo&&g.createElement(g.Fragment,null,g.createElement("div",{className:"restaurants-booking-flow-screens-ConfirmationScreen__specialOfferTitle--2EQpD"},t.specialOfferInfo.title),g.createElement("div",{className:"restaurants-booking-flow-screens-ConfirmationScreen__specialOfferDescription--3CrCY"},t.specialOfferInfo.description," ",t.specialOfferInfo.exclusions))),g.createElement("div",null,g.createElement("div",{className:"restaurants-booking-flow-screens-ConfirmationScreen__thankYou--27X-s"},Object(S.localize)("restaurant_thank_you_reservation_c2b")),g.createElement("div",{className:"restaurants-booking-flow-screens-ConfirmationScreen__confirmationMessage--1Ty0Z"},Object(S.unescaped)(Object(S.localize)("corrected_lf_confirmation_copy_ffffdd28",{0:t.providerLogoUrl?'<img src="'.concat(t.providerLogoUrl,'" />'):"<span>".concat(t.providerName,"</span>")})))),g.createElement("div",{className:"restaurants-booking-flow-screens-ConfirmationScreen__seeAllRestaurantsSection--2FN6n"},g.createElement("a",{href:t.seeAllRestaurantsUrl,className:"restaurants-booking-flow-screens-ConfirmationScreen__seeAllRestaurants--3oi__"},g.createElement(D.a,{type:"secondary"},Object(S.localize)("see_all_restaurants_confirmation")))),g.createElement("img",{className:"hidden",src:t.trackingPixelUrl}))},Z=r("@ta/styleguide.icon"),K=r("@ta/common.routing"),Y=function e(t){return g.createElement(g.Fragment,null,g.createElement("div",{className:"restaurants-booking-flow-screens-ErrorScreen__errorMessage--3H9gg"},g.createElement(Z.Icon,{name:"exclamation-circle-fill",className:"restaurants-booking-flow-screens-ErrorScreen__icon--3FUVL"}),t.errorDetails?g.createElement("div",null,t.errorDetails):g.createElement("div",null,Object(S.localize)("restaurants_booking_flow_error",{provider:t.providerName}))),g.createElement(K.ObfuscatedLink,{encodedUrl:t.providerUrl,target:"_blank",className:"restaurants-booking-flow-screens-ErrorScreen__reserveButton--2nPxo"},g.createElement(D.a,{type:"primary"},Object(S.localize)("restaurants_reserve_with",{provider:t.providerName}))))},$=function(e){function t(){var e,r;n()(this,t);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return r=l()(this,(e=u()(t)).call.apply(e,[this].concat(o))),f()(_()(_()(r)),"state",{currentScreen:N.LOADING_SCREEN,reservationToken:"",bookingFields:null,errorDetails:"",specialOfferInfo:null,allCountryCodeData:null,countryCodeForCurrentLocale:"",memberInfo:null,trackingPixelUrl:""}),r}return d()(t,e),s()(t,[{key:"componentDidMount",value:function e(){var t=this,r=this.getBookingFieldsForThisBooking(),a=this.getCountryCodesForThisBooking(),n=this.getOfferDetailsForThisBooking(),o=this.getMemberInfoForThisBooking(),s=this.props.canLockTimeslot?this.lockTimeslotForThisBooking():Promise.resolve(!0);Promise.all([r,s,a,n,o]).then(function(e){e.every(Boolean)?t.setState({currentScreen:N.USER_INPUT_SCREEN}):t.setState({currentScreen:N.ERROR_SCREEN})}).catch(function(){return t.setState({currentScreen:N.ERROR_SCREEN})})}},{key:"getBookingFieldsForThisBooking",value:function e(){var t=this;return function e(t,r,a,n){return fetch("/data/1.0/restaurants/".concat(t,"/commerce/providers/").concat(r,"/bookingFields"),{method:"GET",credentials:"same-origin",headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(e){return e.json()}).then(function(e){return e.error&&e.error.message?(n(""),!1):!!function e(t){if(!("fields"in t)||"object"!==C()(t.fields))return!1;var r=t.fields;return"title"in r&&"first_name"in r&&"last_name"in r&&"email_address"in r&&"country_code"in r&&"phone_number"in r&&"special_requests"in r&&"newsletter"in r&&"phone_hint"in t&&"provider_newsletter_opt_in"in t&&"restaurant_newsletter_opt_in"in t&&"terms_text"in t&&"visa_text"in t&&"visa_logo_url"in t}(e)&&(a(e),!0)}).catch(function(){return!1})}(this.props.detailId,this.props.providerId,function(e){return t.setState({bookingFields:e})},function(e){return t.setState({errorDetails:e})})}},{key:"getCountryCodesForThisBooking",value:function e(){var t=this;return function e(t,r){return fetch("/data/1.0/restaurant/countryCodes",{method:"GET",credentials:"same-origin",headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(e){return e.json()}).then(function(e){return e.error&&e.error.message?(r(""),!1):!(!e.allCountryCodeData||!e.countryCodeForCurrentLocale||(t(e),0))}).catch(function(){return!1})}(function(e){return t.setState({allCountryCodeData:e.allCountryCodeData,countryCodeForCurrentLocale:e.countryCodeForCurrentLocale})},function(e){return t.setState({errorDetails:e})})}},{key:"getOfferDetailsForThisBooking",value:function e(){var t=this;return this.props.hasSpecialOffer?function e(t,r,a,n,o,s){return fetch("/data/1.0/restaurants/".concat(t,"/commerce/providers/").concat(r,"/offerDetails"),{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json; charset=utf-8","X-Requested-By":Object(v.getStore)().getState().auth.csrfToken},body:JSON.stringify({datetime:a,partySize:n,offerId:o})}).then(function(e){return e.json()}).then(function(e){if("title"in e&&"description"in e&&"exclusions"in e){var t=e.title,r=e.description,a=e.exclusions;return s({title:t,description:r,exclusions:a}),!0}return!0}).catch(function(){return!0})}(this.props.detailId,this.props.providerId,this.props.datetime,this.props.partySize,this.props.offerId,function(e){return t.setState({specialOfferInfo:e})}):Promise.resolve(!0)}},{key:"getMemberInfoForThisBooking",value:function e(){var t=this;return Object(v.getStore)().getState().auth.isMember?function e(t){return fetch("/data/1.0/member/self",{method:"GET",credentials:"same-origin",headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(e){return e.json()}).then(function(e){return t(e),!0}).catch(function(){return!0})}(function(e){return t.setState({memberInfo:e})}):Promise.resolve(!0)}},{key:"lockTimeslotForThisBooking",value:function e(){var t=this;return function e(t,r,a,n,o,s){return fetch("/data/1.0/restaurants/".concat(t,"/commerce/providers/").concat(r,"/lockTimeslot"),{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json; charset=utf-8","X-Requested-By":Object(v.getStore)().getState().auth.csrfToken},body:JSON.stringify({datetime:a,partySize:n})}).then(function(e){return e.json()}).then(function(e){return e.error&&e.error.message?(s(""),!1):!!e.reservationToken&&(o(e.reservationToken),!0)}).catch(function(){return!1})}(this.props.detailId,this.props.providerId,this.props.datetime,this.props.partySize,function(e){return t.setState({reservationToken:e})},function(e){return t.setState({errorDetails:e})})}},{key:"makeReservationForThisBooking",value:function e(t){var r=this;this.setState({currentScreen:N.RESERVING_SCREEN}),function e(t,r,a,n,o,s,i,l,c,u){var m=l.firstName,d=l.lastName,p=l.email,_=l.countryPhoneCode,h=l.phoneNum,f=l.specialInstructions,g=l.optionalEmail,E=l.newsletter;fetch("/data/1.0/restaurants/".concat(t,"/commerce/providers/").concat(r,"/makeReservation"),{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json; charset=utf-8","X-Requested-By":Object(v.getStore)().getState().auth.csrfToken},body:JSON.stringify({datetime:a,partySize:n,offerId:s,securityToken:i,firstName:m,lastName:d,email:p,countryPhoneCode:_,phoneNum:h,specialInstructions:f,optionalEmail:g,newsletter:E,lockToken:o})}).then(function(e){return e.json()}).then(function(e){e.errorMessage?u(e.errorMessage):e.reservationToken&&e.trackingPixelUrl?c(e.trackingPixelUrl):u("")},u)}(this.props.detailId,this.props.providerId,this.props.datetime,this.props.partySize,this.state.reservationToken,this.props.offerId,this.props.securityToken,t,function(e){return r.setState({currentScreen:N.CONFIRMATION_SCREEN,trackingPixelUrl:e})},function(e){return r.setState({currentScreen:N.ERROR_SCREEN,errorDetails:e})})}},{key:"render",value:function e(){var t=this;switch(this.state.currentScreen){case N.LOADING_SCREEN:return g.createElement(I,{providerName:this.props.providerName,providerLogoUrl:this.props.providerLogoUrl});case N.USER_INPUT_SCREEN:return this.state.bookingFields&&this.state.allCountryCodeData?g.createElement(J,{reservationToken:this.state.reservationToken,restaurantName:this.props.restaurantName,restaurantPhotoUrl:this.props.restaurantPhotoUrl,reservationDatetime:this.props.datetime,reservationPartySize:this.props.partySize,providerName:this.props.providerName,providerLogoUrl:this.props.providerLogoUrl,bookingFields:this.state.bookingFields,specialOfferInfo:this.state.specialOfferInfo,allCountryCodeData:this.state.allCountryCodeData,countryCodeForCurrentLocale:this.state.countryCodeForCurrentLocale,memberInfo:this.state.memberInfo,onValidationSuccess:function e(r){return t.makeReservationForThisBooking(r)}}):(this.setState({currentScreen:N.ERROR_SCREEN}),null);case N.RESERVING_SCREEN:return g.createElement(X,{providerName:this.props.providerName,providerLogoUrl:this.props.providerLogoUrl});case N.CONFIRMATION_SCREEN:return g.createElement(E.Track,{mount:{module:"Restaurant_bookingform",action:"reservation_confirmation_impression",context:this.props.providerName,once:!1}},g.createElement(Q,{restaurantName:this.props.restaurantName,restaurantPhotoUrl:this.props.restaurantPhotoUrl,reservationDatetime:this.props.datetime,reservationPartySize:this.props.partySize,providerName:this.props.providerName,providerLogoUrl:this.props.providerLogoUrl,seeAllRestaurantsUrl:this.props.seeAllRestaurantsUrl,specialOfferInfo:this.state.specialOfferInfo,trackingPixelUrl:this.state.trackingPixelUrl}));case N.ERROR_SCREEN:return g.createElement(E.Track,{mount:{module:"Restaurant_bookingform",action:"error_page_impression",context:this.props.providerName,once:!1}},g.createElement(Y,{errorDetails:this.state.errorDetails,providerUrl:this.props.providerUrl,providerName:this.props.providerName}));default:return null}}}]),t}(g.Component);t.default=$}}});
//# sourceMappingURL=restaurants.booking-flow.661d380514.js.map