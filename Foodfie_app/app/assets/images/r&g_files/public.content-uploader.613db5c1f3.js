(window.$WP=window.$WP||[]).push({id:"@ta/public.content-uploader",d:["vendor-babel","vendor-react-libs","ta-platform","@ta/events.lifecycle","@ta/overlays.modal","ta-common","@ta/social.link-preview","@ta/overlays.toast","vendor-apollo-libs","@ta/social.common-popover","@ta/common.typeahead","@ta/input.text-area","@ta/social.social-reference","@ta/overlays.headers"],e:["./packages/public/content-uploader/index.jsx"],x:{"./packages/public/content-uploader/index.jsx":["LinkPostUploader","EditLinkPostModal"],"./packages/social/feed/feedFragments/LocationFields.fragment.gql":["a"],"./packages/social/feed/feedFragments/PhotoSizes.fragment.gql":["a"]},m:{"./packages/public/content-uploader/index.jsx":function(e,t,i){"use strict";i.r(t);var n=i("@babel/runtime/helpers/esm/extends"),a=i.n(n),l=i("@babel/runtime/helpers/esm/objectSpread"),o=i.n(l),r=i("@babel/runtime/helpers/esm/classCallCheck"),s=i.n(r),d=i("@babel/runtime/helpers/esm/createClass"),c=i.n(d),u=i("@babel/runtime/helpers/esm/possibleConstructorReturn"),m=i.n(u),p=i("@babel/runtime/helpers/esm/getPrototypeOf"),k=i.n(p),v=i("@babel/runtime/helpers/esm/inherits"),b=i.n(v),g=i("@babel/runtime/helpers/esm/assertThisInitialized"),h=i.n(g),f=i("@babel/runtime/helpers/esm/defineProperty"),_=i.n(f),N=i("react"),S=i("react-redux"),P=i("@ta/common.classnames"),C=i.n(P),F=i("@ta/events.lifecycle"),E=i("@ta/common.i18n"),y=i("@ta/overlays.modal"),L=i("@ta/common.state"),w=i("@ta/styleguide.loading"),O=i("@ta/common.tracking"),I=i.n(O),D=i("@ta/social.link-preview"),j=i("@ta/styleguide.button"),M=i.n(j),z=i("@ta/overlays.toast"),V=i("@ta/common.routing"),x=i("@ta/common.typeahead"),T=i("@ta/input.text-area"),U=i("@ta/social.social-reference"),R=i("@ta/common.features"),G={formWrapper:"public-content-uploader-link-uploader-LinkPostForm__formWrapper--1_-B6",commentsContainer:"public-content-uploader-link-uploader-LinkPostForm__commentsContainer--1sZa3",tagsContainer:"public-content-uploader-link-uploader-LinkPostForm__tagsContainer--1xXZ5",inputLabelTitle:"public-content-uploader-link-uploader-LinkPostForm__inputLabelTitle--89OhP",inputSubLabel:"public-content-uploader-link-uploader-LinkPostForm__inputSubLabel--GQCxU",commentInput:"public-content-uploader-link-uploader-LinkPostForm__commentInput--NUXng",commentError:"public-content-uploader-link-uploader-LinkPostForm__commentError--bX4ru",characterCountContainer:"public-content-uploader-link-uploader-LinkPostForm__characterCountContainer--Hcm7z",characterCount:"public-content-uploader-link-uploader-LinkPostForm__characterCount--GGWF4",error:"public-content-uploader-link-uploader-LinkPostForm__error--2mGij",multiSelectInput:"public-content-uploader-link-uploader-LinkPostForm__multiSelectInput--1pGGj"},A=500,B=function(e){function t(e){var i;return s()(this,t),i=m()(this,k()(t).call(this,e)),_()(h()(h()(i)),"selectorNode",void 0),_()(h()(h()(i)),"handleCommentChange",function(e){var t=e.currentTarget;i.props.handleCommentChange(t.value),i.setState({characterCount:t.value.length})}),_()(h()(h()(i)),"handleHasResultsChanged",function(e){e&&i.selectorNode.current&&!i.props.isMobile&&i.selectorNode.current.scrollIntoView()}),_()(h()(h()(i)),"locationSelectionChanged",function(e){i.props.handleLocationSelectionChange(e),i.setState({selectedLocations:e})}),_()(h()(h()(i)),"render",function(){return N.createElement("div",{className:G.formWrapper},N.createElement("div",{className:"ui_label_group ".concat(G.commentsContainer)},N.createElement("div",{className:G.inputLabelTitle},Object(E.localize)("link_uploader_commentlabel")),N.createElement("div",{className:G.inputSubLabel},Object(E.localize)("link_uploader_commentdescription")),Object(R.featureIsEnabled)("social_at_reference_ugc_editor")?N.createElement(U.ReferenceSelectorController,{name:"comment",onChange:i.handleCommentChange,maxLength:A,className:"ui_textarea ".concat(G.commentInput," ").concat(i.props.commentError&&i.props.commentError.length?G.commentError:""),value:i.props.originalFormData?i.props.originalFormData.comment:"",shouldAutoScroll:i.props.isMobile}):N.createElement(T.TextArea,{name:"comment",onChange:i.handleCommentChange,maxLength:A,className:"ui_textarea ".concat(G.commentInput," ").concat(i.props.commentError&&i.props.commentError.length?G.commentError:""),value:i.props.originalFormData?i.props.originalFormData.comment:""}),N.createElement("div",{className:G.characterCountContainer},i.props.commentError&&N.createElement("div",{className:G.error},i.props.commentError),N.createElement("div",{className:G.characterCount},0===i.state.characterCount?Object(E.localize)("post_video_500_max_characters"):Object(E.localize)("post_video_character_count",{nCharacterCount:i.state.characterCount})))),N.createElement("div",{className:G.tagsContainer,ref:i.selectorNode},N.createElement("div",{className:G.inputLabelTitle},Object(E.localize)("link_uploader_locationlabel")),N.createElement("div",{className:G.inputSubLabel},Object(E.localize)("link_uploader_locationdescription")),N.createElement("div",{className:G.multiSelectInput},N.createElement(x.MultiLocationSelector,{selectedLocations:i.state.selectedLocations,selectionChanged:i.locationSelectionChanged,hasResultsChanged:i.handleHasResultsChanged}))))}),i.selectorNode=N.createRef(),i.state={characterCount:0,selectedLocations:e.originalFormData?e.originalFormData.selectedLocations:new Map},i}return b()(t,e),t}(N.Component),q=Object(S.connect)(function(e,t){return o()({isMobile:"MOBILE"===e.meta.device.viewportCategory},t)})(B),H=i("react-apollo"),K={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"LinkPreviewApi"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"url"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"linkPostPreview"},arguments:[{kind:"Argument",name:{kind:"Name",value:"url"},value:{kind:"Variable",name:{kind:"Name",value:"url"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"preview"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"description"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"urlDomain"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"canonicalUrl"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"updated"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mediaKeys"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"media"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Photo"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"photoSizes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"width"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"height"},arguments:[],directives:[]}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"LinkPreviewMedia"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"linkPreviewId"},name:{kind:"Name",value:"id"},arguments:[],directives:[{kind:"Directive",name:{kind:"Name",value:"static"},arguments:[]}]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"width"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"height"},arguments:[],directives:[]}]}}]}}]}}]}}]}}],loc:{start:0,end:515}};K.loc.source={body:"5654479646d7"};var W=K,Q=function e(t){var i=t.url,n=t.handleSuccess,a=t.handleError,l=0;return N.createElement(H.Query,{query:W,variables:{url:i},notifyOnNetworkStatusChange:!0},function(e){var t=e.loading,i=e.data,o=e.stopPolling,r=e.startPolling,s=e.networkStatus;if(o(),t||7!==s)return null;if(void 0===i){var d=function e(t){return[500,2e3][t]||-1}(l);return d>0?(r(d),l+=1):a(""),null}var c=i.linkPostPreview,u=c.status,m=c.preview;switch(u){case"PROCESSING":var p=function e(t){return[200,300,700,1500,2500][t]||-1}(l);p>0?(r(p),l+=1):a(u);break;case"SUCCESS":var k;if(m.media&&m.media[0])switch(m.media[0].__typename){case"Photo":k=m.media[0].photoSizes;break;case"LinkPreviewMedia":k=[{url:m.media[0].url,height:m.media[0].height,width:m.media[0].width}];break;default:k=void 0}var v={id:m.id,title:m.title,description:m.description,url:m.canonicalUrl,urlDomain:m.urlDomain,mediaKeyId:m.mediaKeys.length?m.mediaKeys[0].id:void 0,imgSource:k};n(v);break;default:a(u)}return null})},X=function e(){return N.createElement("div",{className:"public-content-uploader-link-uploader-LinkPostHeader__guidelinesContainer--2A9-m"},N.createElement("span",{className:"public-content-uploader-link-uploader-LinkPostHeader__postLinkHeader--3vhov"},Object(E.localize)("link_uploader_header")),N.createElement("span",{className:"public-content-uploader-link-uploader-LinkPostHeader__divider--1kkEu"},"|"),N.createElement(V.Link,{target:"_blank",href:"".concat(Object(E.localize)("mobile_help_center_url"),"/categories/200056887-Guidelines"),className:"ui_link ".concat("public-content-uploader-link-uploader-LinkPostHeader__guidelinesLink--3CBca")},Object(E.localize)("link_uploader_guidelines")))},Y=i("@ta/overlays.headers"),Z=i("@ta/styleguide.icon"),J=function e(){return N.createElement(Y.TitleBar,{displayType:"LEFT_ALIGN_GRAY"},N.createElement(Z.Icon,{name:"link",className:"public-content-uploader-link-uploader-LinkPostModalHeader__icon--1mCU8"}),N.createElement("span",{className:"ui_header h3 ".concat("public-content-uploader-link-uploader-LinkPostModalHeader__headerText--2V6jF")}," ",Object(E.localize)("link_uploader_header")))},$=function e(t){return t.showMask?N.createElement("div",{className:"public-content-uploader-link-uploader-LinkPostPreviewPanel__markOverlay--2xA4I",onClick:t.maskOnClick},N.createElement("div",{className:"public-content-uploader-link-uploader-LinkPostPreviewPanel__content--1qnco"},t.children),N.createElement("div",{className:"public-content-uploader-link-uploader-LinkPostPreviewPanel__refresh--3HQE6"},N.createElement(Z.Icon,{name:"refresh"}),N.createElement("span",{className:"public-content-uploader-link-uploader-LinkPostPreviewPanel__refreshText--3qGa-"},Object(E.localize)("link_uploader_refresh")))):t.children},ee=i("@babel/runtime/helpers/esm/toConsumableArray"),te=i.n(ee),ie=i("@ta/social.common-popover"),ne={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PostLink"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mediaKeyId"}},type:{kind:"NamedType",name:{kind:"Name",value:"Long"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"comment"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"previewId"}},type:{kind:"NamedType",name:{kind:"Name",value:"Long"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"locationIds"}},type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"post"},arguments:[{kind:"Argument",name:{kind:"Name",value:"request"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"locationIds"},value:{kind:"Variable",name:{kind:"Name",value:"locationIds"}}},{kind:"ObjectField",name:{kind:"Name",value:"postRequest"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"ObjectField",name:{kind:"Name",value:"mediaKeyId"},value:{kind:"Variable",name:{kind:"Name",value:"mediaKeyId"}}},{kind:"ObjectField",name:{kind:"Name",value:"comment"},value:{kind:"Variable",name:{kind:"Name",value:"comment"}}},{kind:"ObjectField",name:{kind:"Name",value:"previewId"},value:{kind:"Variable",name:{kind:"Name",value:"previewId"}}}]}}]}}],directives:[]}]}}],loc:{start:0,end:332}};ne.loc.source={body:"65b5fe17417f"};var ae=ne,le=function(e){function t(){var e,i;s()(this,t);for(var n=arguments.length,a=new Array(n),l=0;l<n;l++)a[l]=arguments[l];return i=m()(this,(e=k()(t)).call.apply(e,[this].concat(a))),_()(h()(h()(i)),"track",function(e,t,n){var a;switch(i.props.page){case"Home":a="home_content_uploaders";break;case"Profile":a="profile_content_uploaders";break;default:a="undefined"}var l={module:a,action:e,context:t,value:n};Object.keys(l).forEach(function(e){return void 0===l[e]&&delete l[e]}),I()(l)}),_()(h()(h()(i)),"postOnClick",function(e){return function(){if(!i.props.isDisabled){if(i.track("post_click"),!i.props.postFormData.selectedLocations.size)return e(),void i.track("add_location_warning");i.doPost()}}}),_()(h()(h()(i)),"doPost",function(){var e={previewId:i.props.linkPreview.id,userId:i.props.userId,mediaKeyId:i.props.linkPreview.mediaKeyId,comment:i.props.postFormData.comment,locationIds:te()(i.props.postFormData.selectedLocations.keys())};i.props.postSubmissionCallback("uploading"),i.props.postApi(e,i.props.refetchQueries).then(function(e){i.props.postSubmissionCallback("success"),i.track("post_succeeded",e.data.post)}).catch(function(){i.props.postSubmissionCallback("error")})}),i}return b()(t,e),c()(t,[{key:"render",value:function e(){var t=this;return N.createElement("div",{className:C()("public-content-uploader-link-uploader-LinkPostSubmit__postButton--2sWid",_()({},"public-content-uploader-link-uploader-LinkPostSubmit__paddingForReference--2lSeG",Object(R.featureIsEnabled)("social_at_reference_ugc_editor")))},N.createElement(ie.ConfirmationPopover,{header:Object(E.localize)("post_video_didnt_tag_location"),description:Object(E.localize)("post_video_tag_location_push_2"),cancel:Object(E.localize)("link_uploader_locationwarning_addtagbutton"),confirm:Object(E.localize)("link_uploader_postbutton_label"),onConfirm:this.doPost,onCancel:null,above:!0,alignEdge:"right",shiftX:this.props.isMobile?0:24,shiftY:this.props.isMobile?48:72,fixed:!1},function(e,i){return N.createElement("span",{ref:e},N.createElement(M.a,{type:"primary",size:t.props.isMobile?"fullwidth":"default",disabled:t.props.isDisabled,onClick:t.postOnClick(i)},Object(E.localize)("link_uploader_postbutton_label")))}))}}]),t}(N.Component),oe=Object(H.graphql)(ae,{props:function e(t){var i=t.mutate;return{postApi:function e(t,n){return i({variables:t,refetchQueries:n})}}}})(le),re=Object(S.connect)(function(e){return{page:e.route.page,isMobile:"MOBILE"===e.meta.device.viewportCategory}})(oe),se=function e(t){return N.createElement("div",{className:"public-content-uploader-link-uploader-LinkPostSuccess__finishedPosting--2Ir10"},N.createElement("div",{className:"public-content-uploader-link-uploader-LinkPostSuccess__congrats--2p5VN"},Object(E.localize)("link_uploader_congrats_header")),N.createElement("div",{className:"public-content-uploader-link-uploader-LinkPostSuccess__linkPosted--1kOwG"},Object(E.localize)("link_uploader_congrats_description")),N.createElement("div",{className:"public-content-uploader-link-uploader-LinkPostSuccess__postAnother--3cbJn"},N.createElement(M.a,{type:"primary",size:"fullwidth",onClick:t.postAgainCallback},Object(E.localize)("link_uploader_congrats_postagainbutton"))),N.createElement("div",null,N.createElement("a",{href:"/Profile"},N.createElement(M.a,{type:"secondary",size:"fullwidth"},Object(E.localize)("link_uploader_congrats_gotopost")))))},de=function(e){function t(e){var i;return s()(this,t),i=m()(this,k()(t).call(this,e)),_()(h()(h()(i)),"locationSelectionChanged",function(e){i.setState(function(t){return{postFormData:o()({},t.postFormData,{selectedLocations:e})}})}),_()(h()(h()(i)),"handleNextClicked",function(){i.isNextButtonDisabled()||(i.setState({errorMessage:void 0,shouldGeneratePreview:!0,isPreviewLoading:!0}),i.track("next_click"))}),_()(h()(h()(i)),"handleRefreshClicked",function(){i.setState({errorMessage:void 0,shouldGeneratePreview:!0,isPreviewLoading:!0,showRefreshOverlay:!1})}),_()(h()(h()(i)),"handleUrlChange",function(e){i.setState({inputUrl:e.target.value,showRefreshOverlay:!0})}),_()(h()(h()(i)),"linkPreviewSuccess",function(e){i.setState({linkPreviewState:e,initialPreviewDone:!0,shouldGeneratePreview:!1,isPreviewLoading:!1,showRefreshOverlay:!1,errorMessage:void 0})}),_()(h()(h()(i)),"linkPreviewError",function(e){var t;switch(e){case"BLACKLISTED":t=Object(E.localize)("link_inputfield_error_blacklist");break;case"ERROR":case"UNKNOWN":case"MALFORMED":default:t=Object(E.localize)("link_inputfield_error")}i.setState({errorMessage:t,shouldGeneratePreview:!1,isPreviewLoading:!1,initialPreviewDone:!0}),"BLACKLISTED"===e&&i.track("failed_moderation_error",i.state.inputUrl),"ERROR"!==e&&"MALFORMED"!==e||i.track("invalid_url_error",i.state.inputUrl),"PROCESSING"===e&&i.track("crawl_timeout_error",i.state.inputUrl)}),_()(h()(h()(i)),"commentChanged",function(e){i.setState(function(t){return{postFormData:o()({},t.postFormData,{comment:e})}})}),_()(h()(h()(i)),"emptyState",function(){var e=new Map;if(i.props.locationId){var t={type:"location_id",value:"".concat(i.props.locationId)};e.set("".concat(i.props.locationId),t)}return{inputUrl:"",isPreviewLoading:!1,shouldGeneratePreview:!1,initialPreviewDone:!1,showRefreshOverlay:!1,showLocationWarning:!1,postStatus:null,postFormData:{comment:"",selectedLocations:e},linkPreviewState:void 0}}),_()(h()(h()(i)),"track",function(e,t,n){var a;switch(i.props.page){case"Home":a="home_content_uploaders";break;case"Profile":a="profile_content_uploaders";break;default:a="undefined"}var l={module:a,action:e,context:t,value:n};Object.keys(l).forEach(function(e){return void 0===l[e]&&delete l[e]}),I()(l)}),_()(h()(h()(i)),"handleComponentOpened",function(){i.setState({postStatus:"ready"}),i.track("post_link_click")}),_()(h()(h()(i)),"handleComponentClosed",function(){"success"!==i.state.postStatus&&i.track("exit_click")}),_()(h()(h()(i)),"postSubmissionCallback",function(e){if("success"===e){var t=i.props.displaySuccessModal?{postStatus:e}:i.emptyState();i.setState(t,function(){if(!i.props.displaySuccessModal){i.props.hideOverlay(),i.props.onSubmit&&i.props.onSubmit();var e="Profile"===i.props.route.page,t={node:Object(E.localize)("success_repost_link")},n=o()({},t,{cta:N.createElement(V.Link,{to:{page:"Profile"},href:"/Profile"},Object(E.localize)("view_post"))});e?i.props.launchToast(t):i.props.launchToast(n)}})}else i.setState({postStatus:e}),"error"===e&&i.track("post_failed_error")}),_()(h()(h()(i)),"postAgain",function(){return i.setState(i.emptyState())}),_()(h()(h()(i)),"nextEnterPressed",function(e){13!==e.keyCode||i.isNextButtonDisabled()||i.handleNextClicked()}),_()(h()(h()(i)),"isNextButtonDisabled",function(){return void 0===i.state.inputUrl||0===i.state.inputUrl.length}),_()(h()(h()(i)),"isPostButtonDisabled",function(){return i.state.isPreviewLoading||void 0!==i.state.errorMessage}),_()(h()(h()(i)),"isPostSubmitted",function(){return"success"===i.state.postStatus}),i.state=i.emptyState(),i}return b()(t,e),c()(t,[{key:"render",value:function e(){var t=!this.isPostSubmitted(),i=this.state.initialPreviewDone||this.state.isPreviewLoading?null:N.createElement("div",{className:"public-content-uploader-link-uploader-LinkPostUploader__button--3EHQV"},N.createElement(M.a,{type:"primary",disabled:this.isNextButtonDisabled(),onClick:this.handleNextClicked,size:this.props.isMobile?"fullwidth":"default"},Object(E.localize)("link_uploader_nextbutton"))),n=!i&&this.state.linkPreviewState&&"uploading"!==this.state.postStatus?N.createElement(re,{userId:this.props.loggedInUserId,linkPreview:this.state.linkPreviewState,postFormData:this.state.postFormData,isDisabled:this.isPostButtonDisabled(),postSubmissionCallback:this.postSubmissionCallback,refetchQueries:this.props.refetchQueries}):null,a="uploading"===this.state.postStatus?N.createElement("div",{className:"public-content-uploader-link-uploader-LinkPostUploader__postButton--2t9Rp"},N.createElement("div",{className:"public-content-uploader-link-uploader-LinkPostUploader__loaderContainer--3jjxT"},N.createElement("div",{className:"public-content-uploader-link-uploader-LinkPostUploader__loaderCenter--1CcsZ"},N.createElement(w.LoadingBubbles,{color:"dark"})))):null,l=this.state.isPreviewLoading?N.createElement("div",{className:"public-content-uploader-link-uploader-LinkPostUploader__previewPlaceholder--gUQGJ"},N.createElement(w.LoadingBubbles,{size:"large",color:"light"})):null,o=this.state.errorMessage?N.createElement($,{maskOnClick:this.handleRefreshClicked,showMask:this.state.showRefreshOverlay},N.createElement("div",{className:"public-content-uploader-link-uploader-LinkPostUploader__previewPlaceholder--gUQGJ"},N.createElement("div",{className:"public-content-uploader-link-uploader-LinkPostUploader__errorMessage--3ZbDq"},this.state.errorMessage))):null,r=o||!this.state.linkPreviewState||this.state.shouldGeneratePreview?null:N.createElement($,{maskOnClick:this.handleRefreshClicked,showMask:this.state.showRefreshOverlay},N.createElement(D.LinkPreview,{linkPreviewState:this.state.linkPreviewState})),s=this.state.shouldGeneratePreview?N.createElement(Q,{url:this.state.inputUrl,handleSuccess:this.linkPreviewSuccess,handleError:this.linkPreviewError}):null,d=this.state.initialPreviewDone?N.createElement(q,{handleLocationSelectionChange:this.locationSelectionChanged,handleCommentChange:this.commentChanged,originalFormData:{comment:this.state.postFormData.comment,selectedLocations:this.state.postFormData.selectedLocations}}):null;return N.createElement(y.Modal,{name:this.props.modalName,header:this.isPostSubmitted()?null:N.createElement(J,null)},N.createElement("div",{className:C()(_()({hidden:!t},"public-content-uploader-link-uploader-LinkPostUploader__uploading--1ePjz","uploading"===this.state.postStatus))},N.createElement("div",{className:"public-content-uploader-link-uploader-LinkPostUploader__editorWrapper--2fOwg"},N.createElement(X,null),N.createElement(N.Fragment,null,N.createElement("span",{className:"public-content-uploader-link-uploader-LinkPostUploader__urlInputLabel--qzNIw"},Object(E.localize)("link_inputfield_label"))," ",Object(E.localize)("post_video_required_fields_text")),N.createElement(N.Fragment,null,N.createElement("input",{name:"url",type:"text",value:this.state.inputUrl,onChange:this.handleUrlChange,onKeyUp:this.nextEnterPressed,className:"ui_input_text ".concat(o?"public-content-uploader-link-uploader-LinkPostUploader__urlInputError--1x5a8":"public-content-uploader-link-uploader-LinkPostUploader__urlInput--3Gouz")})),i,s,l,r,o),d,n,a),N.createElement("div",{className:this.props.displaySuccessModal&&this.isPostSubmitted()?null:"hidden"},N.createElement(se,{postAgainCallback:this.postAgain})),N.createElement(F.MountListener,{onComponentDidMount:this.handleComponentOpened,onComponentWillUnmount:this.handleComponentClosed}))}}]),t}(N.Component);_()(de,"defaultProps",{displaySuccessModal:!0});var ce=Object(S.connect)(function(e,t){return o()({page:e.route.page,isMobile:"MOBILE"===e.meta.device.viewportCategory,loggedInUserId:e.auth.loggedInUserId},t)},{hideOverlay:function e(){return L.actions.overlays.showGlobalOverlay(null)}})(function e(t){var i=N.useContext(V.RouteContext).route;return N.createElement(z.Toaster,null,function(e){return N.createElement(de,a()({launchToast:e,route:i},t))})}),ue=i("@ta/common.logging"),me=i.n(ue),pe=i("./packages/social/feed/feedFragments/LocationFields.fragment.gql"),ke={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"EditLinkPost"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"locationIds"}},type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"postId"}},type:{kind:"NamedType",name:{kind:"Name",value:"Long"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"comment"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"locationId"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},defaultValue:{kind:"IntValue",value:"0"},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"socialReference"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateLinkPost"},arguments:[{kind:"Argument",name:{kind:"Name",value:"updateRequestWithTags"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"locationIds"},value:{kind:"Variable",name:{kind:"Name",value:"locationIds"}}},{kind:"ObjectField",name:{kind:"Name",value:"updateRequest"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"ObjectField",name:{kind:"Name",value:"comment"},value:{kind:"Variable",name:{kind:"Name",value:"comment"}}},{kind:"ObjectField",name:{kind:"Name",value:"postId"},value:{kind:"Variable",name:{kind:"Name",value:"postId"}}}]}}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"postId"},name:{kind:"Name",value:"id"},arguments:[],directives:[{kind:"Directive",name:{kind:"Name",value:"static"},arguments:[]}]},{kind:"Field",name:{kind:"Name",value:"publishedDate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"comment"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tags"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"locations"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LocationFields"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"orderedLocations"},arguments:[{kind:"Argument",name:{kind:"Name",value:"scopedLocation"},value:{kind:"Variable",name:{kind:"Name",value:"locationId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LocationFields"},directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"socialReferences"},arguments:[],directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"socialReference"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userReferences"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"userName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"userId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"length"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"offset"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:782}};ke.loc.source={body:"11c729569eb1"};var ve={};ke.definitions=ke.definitions.concat(function be(e){return e.filter(function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!ve[t]&&(ve[t]=!0,!0)})}(pe.a.definitions));var ge=ke,he={editorContainer:"public-content-uploader-link-uploader-EditLinkPostModal__editorContainer--jebv5",loaderContainer:"public-content-uploader-link-uploader-EditLinkPostModal__loaderContainer--fnBvY",fullWidth:"public-content-uploader-link-uploader-EditLinkPostModal__fullWidth--17eIu",loaderCenter:"public-content-uploader-link-uploader-EditLinkPostModal__loaderCenter--KGO3x",footer:"public-content-uploader-link-uploader-EditLinkPostModal__footer--3-VxI",uploadError:"public-content-uploader-link-uploader-EditLinkPostModal__uploadError--2KIjg",oopsMessage:"public-content-uploader-link-uploader-EditLinkPostModal__oopsMessage--34nDs"},fe=function e(t){return{type:"location_id",value:t.locationId,displayValue:t.name}},_e=function e(t,i){return t.size===i.size&&te()(t).every(function(e){return i.has(e)})},Ne=function(e){function t(e){var i,n,a;s()(this,t),a=m()(this,k()(t).call(this,e)),_()(h()(h()(a)),"apolloClient",void 0),_()(h()(h()(a)),"originalComment",void 0),_()(h()(h()(a)),"originalLocations",void 0),_()(h()(h()(a)),"commentChanged",function(e){a.setState(function(t){return{editFormData:o()({},t.editFormData,{comment:e})}})}),_()(h()(h()(a)),"locationSelectionChanged",function(e){a.setState(function(t){return{editFormData:o()({},t.editFormData,{selectedLocations:e})}})}),_()(h()(h()(a)),"valuesModifed",function(){if(a.state.editFormData.comment!==a.originalComment)return!0;var e=new Set(a.state.editFormData.selectedLocations.keys());return!_e(e,a.originalLocations)}),_()(h()(h()(a)),"validateComment",function(e){if(0===e.length)return Object(E.localize)("uploader_error_required_field")}),_()(h()(h()(a)),"requiredFieldsComplete",function(){var e=!1,t=a.validateComment(a.state.editFormData.comment);return t&&(e=!0),a.setState({hadCommentError:t}),!e}),_()(h()(h()(a)),"submitClicked",function(){if(a.valuesModifed()){if(a.requiredFieldsComplete()){a.setState({isSubmitting:!0});var e={mutation:ge,variables:{userId:a.props.userId,comment:a.state.editFormData.comment,postId:a.props.linkPost.postId,locationIds:te()(a.state.editFormData.selectedLocations.keys()),socialReference:Object(R.featureIsEnabled)("social_at_referencing_profile_links")}};a.apolloClient.mutate(e).then(function(){a.props.onSubmit&&a.props.onSubmit(),a.setState({isSubmitting:!1}),a.props.showGlobalOverlay()}).catch(function(e){me.a.error(e),a.setState({isSubmitting:!1,hadSubmitError:!0})})}}else a.props.showGlobalOverlay()}),_()(h()(h()(a)),"tryAgainClicked",function(){a.setState({hadSubmitError:!1})}),_()(h()(h()(a)),"render",function(){var e=N.createElement(Y.TitleBar,{displayType:"LEFT_ALIGN_GRAY"},Object(E.localize)("trips_edit_CTA")),t=o()({},a.props.linkPost.preview,{url:a.props.linkPost.preview.canonicalUrl,imgSource:a.props.linkPost.preview.media&&a.props.linkPost.preview.media[0]?a.props.linkPost.preview.media[0].photoSizes:void 0}),i=a.state.isSubmitting?N.createElement("div",{className:C()(he.loaderContainer,_()({},he.fullWidth,a.props.isMobile))},N.createElement("div",{className:he.loaderCenter},N.createElement(w.LoadingBubbles,{color:"dark"}))):N.createElement(M.a,{type:"primary",size:a.props.isMobile?"fullwidth":"default",onClick:a.submitClicked},Object(E.localize)("trips_save_CTA")),n=a.state.hadSubmitError?N.createElement("div",{className:he.uploadError},N.createElement("div",{className:he.oopsMessage},Object(E.localize)("ugc_edit_attempt_failure")),N.createElement(M.a,{type:"primary",size:"fullwidth",onClick:a.tryAgainClicked},Object(E.localize)("content_upload_fail_try_again"))):null;return N.createElement(y.Modal,{name:a.props.modalName,header:e},N.createElement("div",{className:he.editorContainer,style:{display:a.state.hadSubmitError?"none":"block"}},N.createElement(D.LinkPreview,{linkPreviewState:t}),N.createElement(q,{handleLocationSelectionChange:a.locationSelectionChanged,handleCommentChange:a.commentChanged,commentError:a.state.hadCommentError,originalFormData:{comment:a.state.editFormData.comment,selectedLocations:a.state.editFormData.selectedLocations}}),N.createElement("div",{className:he.footer},i),N.createElement(H.ApolloConsumer,null,function(e){return a.apolloClient=e,null})),n)}),a.originalComment=e.linkPost.comment||"",a.originalLocations=new Set(((null===(i=e.linkPost)||void 0===i?void 0:null===(n=i.tags)||void 0===n?void 0:n.locations)||[]).filter(Object).map(function(e){return e.locationId}));var l=new Map;return e.linkPost.tags.locations&&e.linkPost.tags.locations&&e.linkPost.tags.locations.forEach(function(e){l.set("".concat(e.locationId),fe(e))}),a.state={isSubmitting:!1,hadSubmitError:!1,hadCommentError:"",editFormData:{comment:a.originalComment,selectedLocations:l}},a}return b()(t,e),t}(N.Component),Se=Object(S.connect)(function(e,t){return o()({userId:e.auth.loggedInUserId,isMobile:"MOBILE"===e.meta.device.viewportCategory},t)},{showGlobalOverlay:L.actions.overlays.showGlobalOverlay})(Ne);i.d(t,"LinkPostUploader",function(){return ce}),i.d(t,"EditLinkPostModal",function(){return Se})},"./packages/social/feed/feedFragments/LocationFields.fragment.gql":function(e,t,i){"use strict";var n=i("./packages/social/feed/feedFragments/PhotoSizes.fragment.gql"),a={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"LocationFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"LocationInformation"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"locationId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"additionalNames"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"long"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"longOnlyParent"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"placeType"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isGeo"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"parentGeoId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"reviewSummary"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"count"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"rating"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"locationId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"thumbnail"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"photoSizes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoSizes"},directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"parent"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"locationId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"parentGeoId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"additionalNames"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"long"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"route"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"socialStatistics"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isSaved"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:473}};a.loc.source={body:"79b9e38d4f4e"};var l={};a.definitions=a.definitions.concat(function o(e){return e.filter(function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!l[t]&&(l[t]=!0,!0)})}(n.a.definitions)),t.a=a},"./packages/social/feed/feedFragments/PhotoSizes.fragment.gql":function(e,t,i){"use strict";var n={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"PhotoSizes"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"PhotoSize"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"width"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"height"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isHorizontal"},arguments:[],directives:[]}]}}],loc:{start:0,end:75}};n.loc.source={body:"d458b47a8b35"},t.a=n}}});
//# sourceMappingURL=public.content-uploader.613db5c1f3.js.map