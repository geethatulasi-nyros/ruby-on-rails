(window.$WP=window.$WP||[]).push({id:"@ta/social.follow",d:["vendor-babel","vendor-react-libs","vendor-apollo-libs","ta-platform","@ta/common.text","ta-common","@ta/overlays.toast","@ta/social.blocks","@ta/social.feed","@ta/social.login-gate","@ta/tracking.interactions","@ta/social.onboarding-state"],e:["./packages/social/follow/FollowButton.jsx"],x:{"./packages/social/follow/FollowButton.jsx":["default"]},m:{"./packages/social/follow/FollowButton.jsx":function(e,o,l){"use strict";l.r(o);var n=l("@babel/runtime/helpers/esm/extends"),t=l.n(n),a=l("@babel/runtime/helpers/esm/objectWithoutProperties"),i=l.n(a),r=l("@babel/runtime/helpers/esm/objectSpread"),s=l.n(r),c=l("@babel/runtime/helpers/esm/classCallCheck"),d=l.n(c),u=l("@babel/runtime/helpers/esm/createClass"),m=l.n(u),p=l("@babel/runtime/helpers/esm/possibleConstructorReturn"),b=l.n(p),f=l("@babel/runtime/helpers/esm/getPrototypeOf"),g=l.n(f),w=l("@babel/runtime/helpers/esm/inherits"),v=l.n(w),k=l("@babel/runtime/helpers/esm/assertThisInitialized"),F=l.n(k),y=l("@babel/runtime/helpers/esm/defineProperty"),O=l.n(y),N=l("react"),T=l("react-apollo"),_=l("react-redux"),j=l("@ta/common.classnames"),I=l.n(j),C=l("@ta/common.text"),h=l("@ta/common.features"),E=l("@ta/common.i18n"),S=l("@ta/styleguide.icon"),x=l("@ta/overlays.toast"),M=l("@ta/social.blocks"),P=l("@ta/styleguide.button"),V=l.n(P),A=l("@ta/social.feed"),D=l("@ta/social.login-gate"),B=l("@ta/tracking.interactions"),L=l("@ta/social.onboarding-state"),U={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddFollow"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"objectId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"objectType"}},type:{kind:"NamedType",name:{kind:"Name",value:"SocialObjectTypeInput"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"addFollow"},name:{kind:"Name",value:"addFollowV2"},arguments:[{kind:"Argument",name:{kind:"Name",value:"socialObject"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"objectType"},value:{kind:"Variable",name:{kind:"Name",value:"objectType"}}},{kind:"ObjectField",name:{kind:"Name",value:"objectId"},value:{kind:"Variable",name:{kind:"Name",value:"objectId"}}}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"statusType"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:188}};U.loc.source={body:"fb41290403f3"};var z=U,W={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteFollow"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"objectId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"objectType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SocialObjectTypeInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"deleteFollow"},name:{kind:"Name",value:"deleteFollowV2"},arguments:[{kind:"Argument",name:{kind:"Name",value:"socialObject"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"objectType"},value:{kind:"Variable",name:{kind:"Name",value:"objectType"}}},{kind:"ObjectField",name:{kind:"Name",value:"objectId"},value:{kind:"Variable",name:{kind:"Name",value:"objectId"}}}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"statusType"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:198}};W.loc.source={body:"0e334d35f5ea"};var R=W,G={icon:"social-follow-FollowButton__icon--pEoHb",text:"social-follow-FollowButton__text--3sO-x",text_section:"social-follow-FollowButton__text_section--1vN8d",icon_text:"social-follow-FollowButton__icon_text--1tiBM",active:"social-follow-FollowButton__active--3b_MD",followee_display_name:"social-follow-FollowButton__followee_display_name--QUE40",verified:"social-follow-FollowButton__verified--2_2lT"},q=function e(o){var l=o.children;return N.createElement(B.InteractionLogger,null,function(e){return N.createElement(B.FollowTabTypeContext.Consumer,null,function(o){return N.createElement(B.FollowPlacementContext.Consumer,null,function(n){return N.createElement(B.RecommendedFolloweesImpressionIdContext.Consumer,null,function(t){return l(function l(a,i,r){var s={followeeId:r};n&&Object.assign(s,n),o&&Object.assign(s,o),t&&Object.assign(s,t),e(a,i,s)})})})})})},H=function(e){function o(){var e,l;d()(this,o);for(var n=arguments.length,t=new Array(n),a=0;a<n;a++)t[a]=arguments[a];return l=b()(this,(e=g()(o)).call.apply(e,[this].concat(t))),O()(F()(F()(l)),"toggleFollow",function(){l.props.loginGate().then(function(){l.props.profile.isFollowing?l.props.unfollow(s()({},l.props)).then(function(e){var o,n;e.error||l.props.disableToast||("NO_PERMISSION"===(null==e?void 0:null===(o=e.data)||void 0===o?void 0:null===(n=o.deleteFollow)||void 0===n?void 0:n.statusType)?l.props.launchToast(l.blockedToast):l.props.onActionComplete&&l.props.onActionComplete("UNFOLLOW"))}):l.props.follow(s()({},l.props)).then(function(e){var o;e.error||(l.props.disableToast||("NO_PERMISSION"===(null==e?void 0:null===(o=e.data)||void 0===o?void 0:o.addFollow.statusType)?l.props.launchToast(l.blockedToast):(l.props.onActionComplete&&l.props.onActionComplete("FOLLOW"),l.props.launchToast(l.toast))),l.props.attemptOnboarding&&l.props.setFireOnboarding(!1,"FOLLOW_ACTION"))})})}),O()(F()(F()(l)),"toastDisplayNameClass",I()(G.followee_display_name,O()({},G.verified,l.props.profile.isVerified))),O()(F()(F()(l)),"toast",{iconName:"add-friend-fill",node:Object(E.unescaped)(Object(E.localize)("social_follow_toast_message",{sDisplayNameClass:l.toastDisplayNameClass,sDisplayName:Object(C.EscapeHtml)(l.props.profile.displayName)})),cta:N.createElement("div",{onClick:l.toggleFollow},Object(E.localize)("social_unfollow"))}),O()(F()(F()(l)),"blockedToast",{node:N.createElement(M.NoPermissionToast,null)}),O()(F()(F()(l)),"toggleAndClick",function(e){l.props.profile.isFollowing?l.props.onToggleFollow&&l.props.onToggleFollow("UNFOLLOW"):l.props.onToggleFollow&&l.props.onToggleFollow("FOLLOW"),l.toggleFollow(),l.props.onClick&&l.props.onClick(e)}),l}return v()(o,e),m()(o,[{key:"render",value:function e(){var o=this,l=this.props,n=l.displayType,a=l.profile,r=(l.loggedInUserId,l.follow,l.unfollow,l.launchToast,l.loginGate,l.disableToast,l.onToggleFollow,l.onActionComplete,l.attemptOnboarding,l.setFireOnboarding,i()(l,["displayType","profile","loggedInUserId","follow","unfollow","launchToast","loginGate","disableToast","onToggleFollow","onActionComplete","attemptOnboarding","setFireOnboarding"])),s=a.isFollowing?"unfollow":"follow";return"plain"===n?N.createElement(q,null,function(e){return N.createElement("span",{onClick:function l(n){e(n,s,a.userId),o.toggleAndClick(n)}},a.isFollowing?Object(E.localize)("social_unfollow"):Object(E.localize)("social_Follow"))}):"icon+text"===n?N.createElement(q,null,function(e){return N.createElement("span",{className:I()(G.icon_text,O()({},G.active,a.isFollowing)),onClick:function l(n){e(n,s,a.userId),o.toggleAndClick(n)}},N.createElement(S.Icon,{name:"add-friend-fill",className:G.icon}),N.createElement("span",{className:I()("ui_link",G.text)},a.isFollowing?Object(E.localize)("social_nowFollowing"):Object(E.localize)("social_Follow")))}):N.createElement(q,null,function(e){return N.createElement(V.a,t()({},r,{type:o.props.profile.isFollowing?"primary":"secondary",onClick:function l(n){e(n,s,a.userId),o.toggleAndClick(n)}}),N.createElement("span",{className:G.text_section},"button+icon"===n&&N.createElement(S.Icon,{className:G.icon,name:"add-friend-fill"}),N.createElement("span",{className:"button+icon"===n?G.text:null},o.props.profile.isFollowing?Object(E.localize)("social_nowFollowing"):Object(E.localize)("social_Follow"))))})}}]),o}(N.Component);O()(H,"defaultProps",{size:"fullwidth",displayType:"button",disableToast:!1,onToggleFollow:void 0,attemptOnboarding:!0});var K=Object(T.compose)(Object(_.connect)(function(e){return{loggedInUserId:e.auth.loggedInUserId}},{setFireOnboarding:L.ACTIONS.setShouldFire}),Object(T.graphql)(z,{props:function e(o){var l=o.mutate;return{follow:function e(o){var n=o.profile,t=o.loggedInUserId;return l({variables:{objectType:"MEMBER",objectId:n.userId,loggedInUserId:t},update:function e(o,l){var a,i=l.data;if("OK"===(null==i?void 0:null===(a=i.addFollow)||void 0===a?void 0:a.statusType)){var r=n.followerCount,s=void 0===r?0:r;o.writeFragment({id:"MemberProfile:".concat(n.userId),fragment:A.FollowerFragment,data:{id:n.userId,isFollowing:!0,followerCount:s+1,__typename:"MemberProfile"}});var c=o.readFragment({id:"MemberProfile:".concat(t),fragment:A.MemberFolloweeCountFragment});c&&o.writeFragment({id:"MemberProfile:".concat(t),fragment:A.MemberFolloweeCountFragment,data:{id:t,followeeCount:c.followeeCount+1,__typename:"MemberProfile"}})}}})}}}}),Object(T.graphql)(R,{props:function e(o){var l=o.mutate;return{unfollow:function e(o){var n=o.profile,t=o.loggedInUserId;return l({variables:{objectType:"MEMBER",objectId:n.userId,loggedInUserId:t},update:function e(o,l){var a,i=l.data;if("OK"===(null==i?void 0:null===(a=i.deleteFollow)||void 0===a?void 0:a.statusType)){var r=n.followerCount,s=void 0===r?1:r;o.writeFragment({id:"MemberProfile:".concat(n.userId),fragment:A.FollowerFragment,data:{id:n.userId,isFollowing:!1,followerCount:s-1,__typename:"MemberProfile"}});try{var c=o.readFragment({id:"MemberProfile:".concat(t),fragment:A.MemberFolloweeCountFragment});c&&c.followeeCount>0&&o.writeFragment({id:"MemberProfile:".concat(t),fragment:A.MemberFolloweeCountFragment,data:{id:t,followeeCount:c.followeeCount-1,__typename:"MemberProfile"}})}catch(e){}}}})}}}}))(function e(o){return N.createElement(N.Fragment,null,Object(h.featureIsEnabled)("social_follow_enabled")&&N.createElement(x.Toaster,null,function(e){return N.createElement(D.SocialLoginGate,{pid:40473},function(l){return N.createElement(H,t()({launchToast:e,loginGate:l},o))})}))});o.default=K}}});
//# sourceMappingURL=social.follow.56a86ced3a.js.map