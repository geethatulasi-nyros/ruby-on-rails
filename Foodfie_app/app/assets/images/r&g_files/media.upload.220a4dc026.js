(window.$WP=window.$WP||[]).push({id:"@ta/media.upload",d:["vendor-babel","vendor-react-libs","vendor-apollo-libs","ta-platform","@ta/overlays.modal","@ta/overlays.headers","ta-common","@ta/social.social-reference","@ta/input.text-area","@ta/common.typeahead","@ta/events.lifecycle","@ta/input.drop-zone","@ta/overlays.toast","@ta/media.batch-upload","@ta/tracking.interactions","@ta/overlays.custom-overlay"],e:["./packages/media/upload/upload.jsx"],x:{"./packages/media/upload/upload.jsx":["EditMediaModal","MediaUploaderModal","MediaUploadItem","previewSizeDesktop","validateMediaDescription","validateMediaLocation","getSingleLocation","LocationTagWarning"],"./packages/social/feed/feedFragments/LocationFields.fragment.gql":["a"],"./packages/social/feed/feedFragments/PhotoSizes.fragment.gql":["a"],"./packages/social/feed/feedFragments/SocialReferencesFields.fragment.gql":["a"]},m:{"./packages/media/upload/upload.jsx":function(e,t,i){"use strict";i.r(t);var a=i("@babel/runtime/helpers/esm/toConsumableArray"),n=i.n(a),o=i("@babel/runtime/helpers/esm/objectSpread"),r=i.n(o),l=i("@babel/runtime/helpers/esm/classCallCheck"),d=i.n(l),s=i("@babel/runtime/helpers/esm/possibleConstructorReturn"),c=i.n(s),u=i("@babel/runtime/helpers/esm/getPrototypeOf"),m=i.n(u),p=i("@babel/runtime/helpers/esm/inherits"),v=i.n(p),g=i("@babel/runtime/helpers/esm/assertThisInitialized"),f=i.n(g),k=i("@babel/runtime/helpers/esm/defineProperty"),h=i.n(k),_=i("react"),b=i("react-redux"),S=i("react-apollo"),y=i("@ta/common.features"),N=i("@ta/common.classnames"),E=i.n(N),M=i("@ta/common.i18n"),F=i("@ta/common.logging"),C=i.n(F),I=i("@ta/overlays.modal"),O=i("@ta/overlays.headers"),L=i("@ta/common.state"),U=i("@ta/styleguide.button"),D=i.n(U),w=i("@ta/styleguide.loading"),T=i("@ta/common.tracking"),j=i.n(T),z=i("@ta/media.image"),P=i("@babel/runtime/helpers/esm/createClass"),R=i.n(P),x=i("@ta/styleguide.icon"),A=i("@ta/social.social-reference"),B=i("@ta/input.text-area"),V=i("@ta/common.typeahead"),q=i("@ta/media.common"),W={itemWrapper:"media-upload-MediaUploadItem__itemWrapper--3N182",previewPanel:"media-upload-MediaUploadItem__previewPanel--26Gew",inputPanel:"media-upload-MediaUploadItem__inputPanel--bF5Zy",videoCount:"media-upload-MediaUploadItem__videoCount--3BAOg",previewContainer:"media-upload-MediaUploadItem__previewContainer--2Z0qa",videoPreview:"media-upload-MediaUploadItem__videoPreview--2oG20",imagePreview:"media-upload-MediaUploadItem__imagePreview--1PgRv",imagePreviewInner:"media-upload-MediaUploadItem__imagePreviewInner--1LXc7",trashIcon:"media-upload-MediaUploadItem__trashIcon--1b-Es",locationLabelAndElement:"media-upload-MediaUploadItem__locationLabelAndElement--2InAh",inputLabel:"media-upload-MediaUploadItem__inputLabel--2C3aa",inputSubLabel:"media-upload-MediaUploadItem__inputSubLabel--1KyAs",titleRequired:"media-upload-MediaUploadItem__titleRequired--2Un54",inputElement:"media-upload-MediaUploadItem__inputElement--2DBLt",locationSelectElement:"media-upload-MediaUploadItem__locationSelectElement--2cUo_",locationSelectError:"media-upload-MediaUploadItem__locationSelectError--2rnls",descriptionInput:"media-upload-MediaUploadItem__descriptionInput--3Dpx_",descriptionError:"media-upload-MediaUploadItem__descriptionError--31rLi",characterCountContainer:"media-upload-MediaUploadItem__characterCountContainer--2DiRQ",characterCount:"media-upload-MediaUploadItem__characterCount--eHJbI",error:"media-upload-MediaUploadItem__error--3agEs",uploadItem:"media-upload-MediaUploadItem__uploadItem--1U7DW",progressOuter:"media-upload-MediaUploadItem__progressOuter--2FK1H",progressInner:"media-upload-MediaUploadItem__progressInner--Picx8",suggestedTagsLabel:"media-upload-MediaUploadItem__suggestedTagsLabel--pBTxT",suggestedTagsContainer:"media-upload-MediaUploadItem__suggestedTagsContainer--26INK",suggestedTagItem:"media-upload-MediaUploadItem__suggestedTagItem--g5R_5",suggestedTagIcon:"media-upload-MediaUploadItem__suggestedTagIcon--2HIr-"},G={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ProximityLocations"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"fromPoint"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"GeoPointInput"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"radius"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Float"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"limit"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"proximityLocations"},arguments:[{kind:"Argument",name:{kind:"Name",value:"fromPoint"},value:{kind:"Variable",name:{kind:"Name",value:"fromPoint"}}},{kind:"Argument",name:{kind:"Name",value:"radius"},value:{kind:"Variable",name:{kind:"Name",value:"radius"}}},{kind:"Argument",name:{kind:"Name",value:"page"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"offset"},value:{kind:"IntValue",value:"0"}},{kind:"ObjectField",name:{kind:"Name",value:"limit"},value:{kind:"Variable",name:{kind:"Name",value:"limit"}}}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"locationId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"parentId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isGeo"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isClosed"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:251}};G.loc.source={body:"eb02b235a927"};var Z=G,H={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ParentLocations"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"locationIds"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"locations"},arguments:[{kind:"Argument",name:{kind:"Name",value:"locationIds"},value:{kind:"Variable",name:{kind:"Name",value:"locationIds"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"locationId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:118}};H.loc.source={body:"0c6a6f6c45c9"};var Y=H,X={description:function e(t){return t?Object(M.localize)("post_photo_add_description_v2_part_2"):Object(M.localize)("post_video_add_description_v2_part_2")},descriptionCharacterCount:function e(t){return 0===t?Object(M.localize)("post_video_500_max_characters"):Object(M.localize)("post_video_character_count",{nCharacterCount:t})},addLocation:function e(t){return t?Object(M.localize)("photo_uploader_add_a_location_tag"):Object(M.localize)("video_upload_add_tags")},addLocationSubtext:function e(t){return t?Object(M.localize)("post_photo_tag_location_subtext"):Object(M.localize)("post_video_tag_location_subtext")},mediaCount:function e(t,i,a){return t?Object(M.localize)("post_photo_video_count_text",{nCurrentphotoCount:i+1,nTotalphotoCount:a}):Object(M.localize)("post_video_video_count_text",{nCurrentVideoCount:i+1,nTotalVideoCount:a})}},K=500,Q=new q.Dimension(288,162),J=new q.Dimension(272,153),$=function e(t){return 1!==t.size?{type:"location_id"}:Array.from(t.values())[0]},ee=function e(t){if(0===t.description.length)return Object(M.localize)("uploader_error_required_field")},te=function e(t){if("photo"===t.mediaType&&0===t.selectedLocations.size)return Object(M.localize)("uploader_error_required_field")},ie=function e(t){return{locationId:t.locationId,name:t.name,parentId:t.parentId}},ae=function(e){function t(e){var i;d()(this,t),i=c()(this,m()(t).call(this,e)),h()(f()(f()(i)),"getDisplaySuggestions",function(){var e=i.props.itemState.selectedLocations,t=i.state,a=t.locationSuggestions,n=t.geoSuggestions;return 0===e.size&&a&&a.length>0&&n?a.concat(n):null}),h()(f()(f()(i)),"geoSuggestionsLoading",!1),h()(f()(f()(i)),"locationSuggestionsLoading",!1),h()(f()(f()(i)),"selectorNode",void 0),h()(f()(f()(i)),"handleDescriptionChange",function(e){i.props.descriptionChanged(i.props.file,e),1===e.length&&i.track("started_description")}),h()(f()(f()(i)),"handleDescriptionFocus",function(){i.setState({descriptionHasFocus:!0})}),h()(f()(f()(i)),"handleDescriptionBlur",function(){i.setState({descriptionHasFocus:!1}),i.props.descriptionBlurred(i.props.file)}),h()(f()(f()(i)),"singleLocationSelectionChanged",function(e){var t=new Map([[String(e.value),e]]);i.multiLocationSelectionChanged(t)}),h()(f()(f()(i)),"handleSingleLocationFocus",function(){i.setState({locationHasFocus:!0})}),h()(f()(f()(i)),"handleSingleLocationBlur",function(){i.setState({locationHasFocus:!1}),i.props.locationSelectionBlurred(i.props.file)}),h()(f()(f()(i)),"multiLocationSelectionChanged",function(e){i.props.locationSelectionChanged(i.props.file,e),i.track("location_selection_changed",e.size)}),h()(f()(f()(i)),"handleHasResultsChanged",function(e){e&&i.selectorNode.current&&!i.props.isMobile&&i.selectorNode.current.scrollIntoView()}),h()(f()(f()(i)),"handleRemoveFile",function(){i.props.handleRemoveFile(i.props.file)}),h()(f()(f()(i)),"handleSelectLocationSuggestion",function(e){var t=e.toString(),a=new Map([[t,{type:"location_id",value:t}]]);i.props.locationSelectionChanged(i.props.file,a)}),h()(f()(f()(i)),"track",function(e,t){i.props.track(e,i.xOfYString(),t)}),h()(f()(f()(i)),"xOfYString",function(){return"".concat(i.props.index+1," of ").concat(i.props.videoCount)}),h()(f()(f()(i)),"isRotated",function(){return i.state.rotationDegrees%180==90}),h()(f()(f()(i)),"render",function(){var e="photo"===i.props.itemState.mediaType,t=i.props.isMobile?J:Q,a=i.isRotated()?new q.Dimension(t.height,t.width):t,n=i.props.uploadProgress?i.props.uploadProgress:0,o=i.props.isUploading?_.createElement("div",{className:W.uploadItem},_.createElement("div",{className:W.progressOuter},_.createElement("div",{className:W.progressInner,style:{width:"".concat(n,"%")}}))):null,r=e?_.createElement("div",{className:W.imagePreview,style:{width:t.width,height:t.height}},_.createElement("div",{className:W.imagePreviewInner,style:{backgroundImage:"url(".concat(i.state.mediaUrl,")"),transform:"rotate(".concat(i.state.rotationDegrees,"deg)"),width:a.width,height:a.height}})):_.createElement("video",{controls:!0,controlsList:"nodownload nofullscreen",className:W.videoPreview,onPlaying:function e(){return i.track("preview_playing")},style:{width:t.width,height:t.height}},_.createElement("source",{src:i.state.mediaUrl,type:"video/mp4"})),l=e?_.createElement(V.MultiLocationSelector,{selectedLocations:i.props.itemState.selectedLocations,selectionChanged:i.multiLocationSelectionChanged,hasResultsChanged:i.handleHasResultsChanged,maxLocations:1,className:i.props.itemState.locationError&&!i.state.locationHasFocus?W.locationSelectError:"",onFocus:i.handleSingleLocationFocus,onBlur:i.handleSingleLocationBlur}):_.createElement(V.MultiLocationSelector,{selectedLocations:i.props.itemState.selectedLocations,selectionChanged:i.multiLocationSelectionChanged,hasResultsChanged:i.handleHasResultsChanged}),d=_.createElement("span",{className:W.titleRequired}," ",Object(M.localize)("post_video_required_fields_text")),s=i.getDisplaySuggestions(),c=Object(y.featureIsEnabled)("media_geo_suggestions_enabled");return _.createElement("div",{className:W.itemWrapper},_.createElement("div",{className:W.previewPanel},i.props.videoCount>1?_.createElement("div",{className:W.videoCount},X.mediaCount(e,i.props.index,i.props.videoCount)):null,_.createElement("div",{className:W.previewContainer},r,i.props.allowDelete&&_.createElement("div",{className:"ui_icon times ".concat(W.trashIcon),onClick:i.handleRemoveFile}),o)),_.createElement("div",{className:W.inputPanel},_.createElement("div",null,_.createElement("div",{className:W.inputLabel},Object(M.localize)("post_video_add_description_v2_part_1"),d),_.createElement("div",{className:W.inputSubLabel},X.description(e)),Object(y.featureIsEnabled)("social_at_reference_ugc_editor")?_.createElement(A.ReferenceSelectorController,{name:"description",value:i.props.itemState.description,onChange:function e(t,a){return i.handleDescriptionChange(a)},onFocus:i.handleDescriptionFocus,onBlur:i.handleDescriptionBlur,maxLength:K,className:E()(W.inputElement,W.descriptionInput,h()({},W.descriptionError,i.props.itemState.descriptionError&&!i.state.descriptionHasFocus)),shouldAutoScroll:i.props.isMobile}):_.createElement(B.TextArea,{name:"description",value:i.props.itemState.description,onChange:function e(t,a){return i.handleDescriptionChange(a)},onFocus:i.handleDescriptionFocus,onBlur:i.handleDescriptionBlur,maxLength:K,className:E()(W.inputElement,W.descriptionInput,h()({},W.descriptionError,i.props.itemState.descriptionError&&!i.state.descriptionHasFocus))}),_.createElement("div",{className:W.characterCountContainer},i.props.itemState.descriptionError&&!i.state.descriptionHasFocus&&_.createElement("div",{className:W.error},i.props.itemState.descriptionError),_.createElement("div",{className:W.characterCount},X.descriptionCharacterCount(i.props.itemState.description.length)))),_.createElement("div",{className:W.locationLabelAndElement,ref:i.selectorNode},_.createElement("div",{className:W.inputLabel},X.addLocation(e),e&&d),_.createElement("div",{className:W.inputSubLabel},X.addLocationSubtext(e)),_.createElement("div",{className:W.locationSelectElement},l,i.props.itemState.locationError&&!i.state.locationHasFocus&&_.createElement("div",{className:W.error},i.props.itemState.locationError))),s&&_.createElement("div",null,_.createElement("div",{className:W.suggestedTagsLabel},Object(M.localize)("suggested_tags")),_.createElement("div",{className:"ui_tag_group ".concat(W.suggestedTagsContainer)},s.map(function(e){return _.createElement("div",{className:"ui_tag_box ".concat(W.suggestedTagItem),key:e.locationId,onClick:function t(){return i.handleSelectLocationSuggestion(e.locationId)}},_.createElement(x.Icon,{name:"plus",className:W.suggestedTagIcon}),e.name)})))),function e(){return!i.state.exifGeoPoint||i.state.locationSuggestions||i.locationSuggestionsLoading?null:(i.locationSuggestionsLoading=!0,_.createElement(S.Query,{query:Z,variables:{fromPoint:i.state.exifGeoPoint,radius:1,limit:20}},function(e){var t=e.loading,a=e.data,n=e.error;if(!t){i.locationSuggestionsLoading=!1;var o=(!n&&a&&a.proximityLocations||[]).filter(function(e){return!e.isGeo&&!e.isClosed}).map(ie).slice(0,c?3:4),r=c?void 0:[];i.setState({locationSuggestions:o,geoSuggestions:r})}return null}))}(),function e(){return i.state.locationSuggestions&&i.state.locationSuggestions.length>0&&!i.state.geoSuggestions&&!i.geoSuggestionsLoading?(i.geoSuggestionsLoading=!0,_.createElement(S.Query,{query:Y,variables:{locationIds:[i.state.locationSuggestions[0].parentId]}},function(e){var t=e.loading,a=e.data,n=e.error;if(!t){i.geoSuggestionsLoading=!1;var o=(!n&&a&&a.locations||[]).map(ie).slice(0,1);i.setState({geoSuggestions:o})}return null})):null}())}),i.selectorNode=_.createRef();var a=e.mediaUrl?e.mediaUrl:"",n=e.file?URL.createObjectURL(e.file):a;return i.state={mediaUrl:n,rotationDegrees:0,descriptionHasFocus:!1,locationHasFocus:!1},"photo"===e.itemState.mediaType&&(e.file&&Object(q.photoOrientation)(e.file,function(t){i.setState({rotationDegrees:Object(q.orientationValueToDegrees)(t)}),Object(q.getImageDimensions)(n,function(t){var a=i.isRotated()?new q.Dimension(t.height,t.width):t;e.handleGetDimensions(e.file,a)})}),Object(y.featureIsEnabled)("media_location_suggestions_enabled")&&Object(q.getGeoPointFromExif)(n,function(e){return i.setState({exifGeoPoint:e})})),i}return v()(t,e),R()(t,[{key:"componentWillUnmount",value:function e(){URL.revokeObjectURL(this.state.mediaUrl)}}]),t}(_.Component);h()(ae,"defaultProps",{allowDelete:!0}),ae.defaultProps={allowDelete:!0};var ne=Object(b.connect)(function(e,t){return r()({isMobile:"MOBILE"===e.meta.device.viewportCategory},t)})(ae),oe=i("@babel/runtime/helpers/esm/extends"),re=i.n(oe),le=i("@babel/runtime/helpers/esm/slicedToArray"),de=i.n(le),se=i("@ta/common.routing"),ce=i("@ta/events.lifecycle"),ue=i("@ta/input.drop-zone"),me=i("@ta/overlays.toast"),pe=i("@ta/media.batch-upload"),ve=i.n(pe),ge=i("@ta/tracking.interactions"),fe=i("@ta/overlays.custom-overlay"),ke=i.n(fe),he=function(e){function t(e){var i;return d()(this,t),i=c()(this,m()(t).call(this,e)),h()(f()(f()(i)),"setOverlayPosition",function(){if(!i.containerRef.current||!i.contentRef.current)throw new Error("Refs are not set. Should not be able to get here.");var e=i.containerRef.current,t=i.contentRef.current;i.setState({top:"".concat(e.getBoundingClientRect().top,"px"),left:"".concat(e.getBoundingClientRect().left+e.getBoundingClientRect().width-t.getBoundingClientRect().width,"px")})}),h()(f()(f()(i)),"containerRef",_.createRef()),h()(f()(f()(i)),"contentRef",_.createRef()),i.state={top:"0px",left:"0px"},i}return v()(t,e),R()(t,[{key:"componentDidMount",value:function e(){this.setOverlayPosition()}},{key:"render",value:function e(){var t={ref:this.containerRef},i={ref:this.contentRef};return _.createElement("div",t,_.createElement(ke.a,{blockScroll:!1,fixed:!0,top:this.state.top,left:this.state.left,right:"auto",bottom:"auto"},_.createElement("div",re()({className:"media-upload-LocationTagWarning__warningMessage--3b-8L"},i),_.createElement("div",{className:"media-upload-LocationTagWarning__warningTitle--TEZBG"},Object(M.localize)("post_video_didnt_tag_location")),_.createElement("div",{className:"media-upload-LocationTagWarning__warningDescription--2zGeK"},Object(M.localize)("post_video_tag_location_push_2")),_.createElement("div",{className:"media-upload-LocationTagWarning__buttonWrap--fim52"},_.createElement("div",{className:"media-upload-LocationTagWarning__button--3aA6D"},_.createElement(D.a,{type:"secondary",size:"fullwidth",onClick:this.props.onCancel},Object(M.localize)("uploader_error_add_tag"))),_.createElement("div",{className:E()("media-upload-LocationTagWarning__button--3aA6D","media-upload-LocationTagWarning__postButton--3yFt-")},_.createElement(D.a,{type:"primary",size:"fullwidth",onClick:this.props.onPost},Object(M.localize)("uploader_button_post")))))))}}]),t}(_.Component),_e={uploaderWrapper:"media-upload-MediaUploaderModal__uploaderWrapper--3q5o0",uploading:"media-upload-MediaUploaderModal__uploading--327aJ",autoWidth:"media-upload-MediaUploaderModal__autoWidth--xrnCS",paddingForReference:"media-upload-MediaUploaderModal__paddingForReference--2uSa2",guidelinesWrapper:"media-upload-MediaUploaderModal__guidelinesWrapper--13RKS",guidelinesTips:"media-upload-MediaUploaderModal__guidelinesTips--1gZ4N",guidelinesNumVideos:"media-upload-MediaUploaderModal__guidelinesNumVideos--2sYbG",guidelinesLinkUploader:"media-upload-MediaUploaderModal__guidelinesLinkUploader--2awgt",itemDivider:"media-upload-MediaUploaderModal__itemDivider--iP_6K",dropZone:"media-upload-MediaUploaderModal__dropZone--3dNh6",dropZoneBig:"media-upload-MediaUploaderModal__dropZoneBig--2392z",dropZoneSmall:"media-upload-MediaUploaderModal__dropZoneSmall--2c5r7",dropZoneSmallWrapper:"media-upload-MediaUploaderModal__dropZoneSmallWrapper--11vbu",dropZoneItem:"media-upload-MediaUploaderModal__dropZoneItem--12Irv",dragDropText:"media-upload-MediaUploaderModal__dragDropText--1e1_X",uploadAnother:"media-upload-MediaUploaderModal__uploadAnother--KPAL5",errorDisplay:"media-upload-MediaUploaderModal__errorDisplay--2gQBz",postButtonContainer:"media-upload-MediaUploaderModal__postButtonContainer--FIYIn",releaseItem:"media-upload-MediaUploaderModal__releaseItem--juOQQ",releaseContainer:"media-upload-MediaUploaderModal__releaseContainer--2VEdf",loaderContainer:"media-upload-MediaUploaderModal__loaderContainer--3p6YZ",fullWidth:"media-upload-MediaUploaderModal__fullWidth--2gMF9",loaderCenter:"media-upload-MediaUploaderModal__loaderCenter--HurHn",postButton:"media-upload-MediaUploaderModal__postButton--2B1Jc",uploadError:"media-upload-MediaUploaderModal__uploadError--ydVXZ",oopsMessage:"media-upload-MediaUploaderModal__oopsMessage--1NI-W",guidelinesMoreInfo:"media-upload-MediaUploaderModal__guidelinesMoreInfo--5j3ln"},be={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"InitiateMediaUpload"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"request"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"InitiateMediaUploadRequestInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"initiateMediaUpload"},arguments:[{kind:"Argument",name:{kind:"Name",value:"request"},value:{kind:"Variable",name:{kind:"Name",value:"request"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mediaId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"uploadUrl"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:150}};be.loc.source={body:"e54f1774dda4"};var Se=be,ye={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"CompleteMediaUploadForClient"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"request"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CompleteMediaUploadForClientRequestInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"completeMediaUploadForClient"},arguments:[{kind:"Argument",name:{kind:"Name",value:"request"},value:{kind:"Variable",name:{kind:"Name",value:"request"}}}],directives:[]}]}}],loc:{start:0,end:145}};ye.loc.source={body:"63483dfc8c25"};var Ne=ye,Ee={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"Moderate"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"texts"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"checks"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"objectType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ContentObjectTypeInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"moderate"},arguments:[{kind:"Argument",name:{kind:"Name",value:"texts"},value:{kind:"Variable",name:{kind:"Name",value:"texts"}}},{kind:"Argument",name:{kind:"Name",value:"checks"},value:{kind:"Variable",name:{kind:"Name",value:"checks"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"check"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"present"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"moderateLinksForSubmission"},arguments:[{kind:"Argument",name:{kind:"Name",value:"texts"},value:{kind:"Variable",name:{kind:"Name",value:"texts"}}},{kind:"Argument",name:{kind:"Name",value:"objectType"},value:{kind:"Variable",name:{kind:"Name",value:"objectType"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"categorization"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:271}};Ee.loc.source={body:"14549148cf77"};var Me=Ee,Fe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UploadMediaBatch"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"request"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MediaBatchUploadRequestInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"uploadMediaBatch"},arguments:[{kind:"Argument",name:{kind:"Name",value:"request"},value:{kind:"Variable",name:{kind:"Name",value:"request"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"uploadUrls"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:130}};Fe.loc.source={body:"0afdbfe9b82e"};var Ce=Fe,Ie={fileTypeError:function e(t){return t?Object(M.localize)("post_photo_unsupported_file"):Object(M.localize)("post_video_file_type_error")},fileSizeError:function e(t){return t?Object(M.localize)("file_size_too_big_photo_oops_message",{0:ue.maxImageUploadSizeInMB}):Object(M.localize)("post_video_size_error")},guidelinesLink:function e(t){return"".concat(Object(M.localize)("mobile_help_center_url"),t?"/articles/200615067":"/articles/115011046367")},dropZoneButton:function e(t){return t?Object(M.localize)("post_photo_upload_photos_button"):Object(M.localize)("post_video_upload_videos_button")},uploadAnother:function e(t,i){return i?t?'<span class="'.concat(_e.uploadAnother,'">').concat(Object(M.localize)("add_more_photos_mw_uploader"),"</span>"):'<span class="'.concat(_e.uploadAnother,'">').concat(Object(M.localize)("add_more_videos_mw_uploader"),"</span>"):t?Object(M.localize)("post_photo_upload_another_video",{sColorClass1:_e.uploadAnother}):Object(M.localize)("post_video_upload_another_video",{sColorClass1:_e.uploadAnother})},submitButton:function e(t,i){var a=1===i?Object(M.localize)("ugc_uploader_photo_v2"):Object(M.localize)("ugc_uploader_photo_v3"),n=1===i?Object(M.localize)("post_video_button"):Object(M.localize)("post_videos_button");return t?a:n},uploadFailed:function e(t){return t?Object(M.localize)("post_photo_upload_failed"):Object(M.localize)("video_upload_fail")},title:function e(t){return t?Object(M.localize)("post_photos_form_header"):Object(M.localize)("post_a_video_modal_header")},fieldRequired:function e(){return Object(M.localize)("uploader_error_required_field")},maxAllowedFiles:function e(t,i){return t?Object(M.localize)("post_photo_tips_guidelines"):Object(M.localize)("video_upload_max_number",{nVideos:i})},acceptedFormats:function e(t,i){return t?Object(M.localize)("post_photo_accepted_formats"):Object(M.localize)("video_upload_video_formats_accepted",{sFileExtentions:i.join(" ")})},maxFileSize:function e(t){return t?Object(M.localize)("file_size_limit_photo",{0:ue.maxImageUploadSizeInMB}):null},guidelinesMoreInfo:function e(t){return t?Object(M.unescaped)(Object(M.localize)("post_photo_more_info_2")):Object(M.unescaped)(Object(M.localize)("video_upload_more_info_guidelines_link"))},postSubmissionToast:function e(t){return t?Object(M.localize)("success_repost_photo"):Object(M.localize)("success_repost_video")},viewPost:function e(){return Object(M.localize)("view_post")}},Oe=function e(t){return t.some(function(e){var t=e.check,i=e.present;return"PROFANITY"===t&&i})},Le=function e(t){return t.some(function(e){return"NOT_OK"===e.categorization})},Ue=function e(t,i,a,n,o){t.query({query:Me,variables:{texts:i,checks:["PROFANITY"],objectType:"PHOTO"},fetchPolicy:"network-only"}).then(function(e){var t=e.data,i=null==t?void 0:t.moderate,r=i.some(function(e){return Oe(e)}),l=null==t?void 0:t.moderateLinksForSubmission,d=l.some(Le);r&&n(i),d&&o(l),r||d||a()}).catch(function(){C.a.error("Failed to moderate links")})},De=function(e){function t(e){var i;if(d()(this,t),i=c()(this,m()(t).call(this,e)),h()(f()(f()(i)),"fileInputRef",void 0),h()(f()(f()(i)),"allowedFileTypes",void 0),h()(f()(f()(i)),"maxAllowedFiles",void 0),h()(f()(f()(i)),"maxFileSizeInBytes",void 0),h()(f()(f()(i)),"apolloClient",void 0),h()(f()(f()(i)),"emptyState",function(){var e=new Map;if(i.props.locationId){var t={type:"location_id",value:"".concat(i.props.locationId)};e.set("".concat(i.props.locationId),t)}return{errorMessage:void 0,itemStates:new Map,itemUploadProgresses:new Map,displayLocationWarning:!1,submitIndex:-1,isDragOver:!1,batchDescription:"",batchDescriptionError:"",batchSelectedLocation:e,batchSelectedLocationError:"",uploadError:""}}),h()(f()(f()(i)),"track",function(e,t,a){var n={module:"photo"===i.props.mediaType?"photo_uploader":"video_uploader",action:e,context:t,value:a};Object.keys(n).forEach(function(e){return void 0===n[e]&&delete n[e]}),j()(n)}),h()(f()(f()(i)),"handleComponentOpened",function(){i.track("opened"),i.props.isMobile&&i.fileInputRef&&i.fileInputRef.click()}),h()(f()(f()(i)),"handleComponentClosed",function(){(i.isUploading()||i.isFinishedUploading())&&i.setState(i.emptyState()),i.isEditing()&&i.track("close_during_editing"),i.isUploading()&&i.track("close_during_uploading")}),h()(f()(f()(i)),"fileSelectionChanged",function(e){var t=e.target.files;Array.from(t).forEach(function(e){return Object(ue.processFile)(e,i.addFile,i.allowedFileTypes,i.maxFileSizeInBytes,i.fileRejected,"file_picker")}),i.fileInputRef.value=""}),h()(f()(f()(i)),"addFile",function(e,t){i.setState(function(a){var n=a.itemStates,o=a.itemUploadProgresses;if(n.size>=i.maxAllowedFiles)return a;if(Array.from(n.keys()).some(function(t){return e.name===t.name&&e.size===t.size}))return a;var l=new Map(n),d=new Map;if(i.props.locationId){var s={type:"location_id",value:"".concat(i.props.locationId)};d.set("".concat(i.props.locationId),s)}l.set(e,{mediaType:Object(q.mediaType)(e.name),description:"",selectedLocations:d,uploadSuccess:!1});var c=new Map(o);return c.set(e,0),i.track("file_selected",t,l.size),r()({},a,{itemStates:l,itemUploadProgresses:c})})}),h()(f()(f()(i)),"fileRejected",function(e,t){var a;i.track("invalid_file",t);var n="photo"===i.props.mediaType;a="wrong_file_type"===t?Ie.fileTypeError(n):"file_too_large"===t?Ie.fileSizeError(n):t,i.setState(function(e){return r()({},e,{errorMessage:a})}),setTimeout(function(){i.setState({errorMessage:void 0})},3e3)}),h()(f()(f()(i)),"handleRemoveFile",function(e){if(e){var t=i.state,a=t.itemStates,n=t.itemUploadProgresses,o=new Map(a);o.delete(e);var r=new Map(n);r.delete(e),i.setState({itemStates:o,itemUploadProgresses:r})}}),h()(f()(f()(i)),"handleDescriptionChanged",function(e,t){if(e){var a=new Map(i.state.itemStates),n=a.get(e);if(n){var o=r()({},n);Object.assign(o,{description:t});var l=ee(o);Object.assign(o,{descriptionError:l}),a.set(e,o),i.setState({itemStates:a})}}}),h()(f()(f()(i)),"handleDescriptionBlurred",function(e){if(e){var t=new Map(i.state.itemStates),a=t.get(e);if(a){var n=ee(a),o=r()({},a,{descriptionError:n});t.set(e,o),i.setState({itemStates:t})}}}),h()(f()(f()(i)),"handleLocationSelectionChanged",function(e,t){if(e){var a=new Map(i.state.itemStates),n=a.get(e);if(n){var o=r()({},n);Object.assign(o,{selectedLocations:t});var l=te(o);Object.assign(o,{locationError:l}),a.set(e,o),i.setState({itemStates:a})}i.setState({displayLocationWarning:!1})}}),h()(f()(f()(i)),"handleLocationSelectionBlurred",function(e){if(e){var t=new Map(i.state.itemStates),a=t.get(e);if(a){var n=te(a),o=r()({},a,{locationError:n});t.set(e,o),i.setState({itemStates:t})}}}),h()(f()(f()(i)),"handleGetDimensions",function(e,t){if(e){var a=new Map(i.state.itemStates),n=a.get(e);if(n){var o=r()({},n,{dimensions:t});a.set(e,o),i.setState({itemStates:a})}}}),h()(f()(f()(i)),"missingLocations",function(){return Array.from(i.state.itemStates.values()).some(function(e){return 0===e.selectedLocations.size})}),h()(f()(f()(i)),"handleSubmitClicked",function(){if(i.requiredFieldsComplete()){var e=Array.from(i.state.itemStates.values()).map(function(e){return e.description});Ue(i.apolloClient,e,i.submit,i.handleDescriptionProfanityError,i.handleDescriptionLinksError)}}),h()(f()(f()(i)),"submit",function(){i.track("submit_clicked"),!i.missingLocations()||i.state.displayLocationWarning?(i.setState({submitIndex:-1,displayLocationWarning:!1}),"photo"===i.props.mediaType&&Object(y.featureIsEnabled)("web_batch_media_photo_uploader")?i.submitBatch():i.submitNextMedia()):i.setState({displayLocationWarning:!0})}),h()(f()(f()(i)),"convertDataURIToFile",function(e){for(var t=atob(e.split(",")[1]),i=new ArrayBuffer(t.length),a=new Uint8Array(i),n=0;n<t.length;n++)a[n]=t.charCodeAt(n);return new File([i],"")}),h()(f()(f()(i)),"cropPhoto",function(e){return new Promise(function(t,i){if(e.cropParams&&e.originalUrl){var a=new Image;a.crossOrigin="Anonymous",a.onload=function(){var i=e.cropParams,n=i.x,o=i.y,r=i.cropWidth,l=i.cropHeight;t(Object(q.cropImageToJpegUrl)(a,"image/jpeg",n,o,r,l))},a.onerror=function(e){return i(e)},a.src=e.originalUrl}else i(new Error("Can't crop image, missing originalUrl or cropParams"))})}),h()(f()(f()(i)),"submitBatch",function(){var e=n()(i.state.batchSelectedLocation.keys())[0],t=Array.from(i.state.itemStates).map(function(e){var t=de()(e,2),i=t[0],a=t[1];return{caption:a.description,mediaType:a.mediaType.toUpperCase(),mimeType:i.type,fileName:i.name,fileSize:i.size,locationIds:Array.from(a.selectedLocations.keys()),width:a.dimensions&&a.dimensions.width,height:a.dimensions&&a.dimensions.height}});i.apolloClient.mutate({mutation:Ce,variables:{request:{caption:i.state.batchDescription,locationIds:[Number(e)],mediaForUpload:t}}}).then(function(e){var t,a,n=null==e?void 0:null===(t=e.data)||void 0===t?void 0:null===(a=t.uploadMediaBatch)||void 0===a?void 0:a.uploadUrls;n?function e(t){return new Promise(function(e,i){t.reduce(function(e,t){return e.then(t)},Promise.resolve()).then(e).catch(i)})}(Array.from(i.state.itemStates).map(function(e,t){var a=de()(e,2),o=(a[0],a[1]);return function(){return function e(t,a,o){return new Promise(function(e,t){i.setState(function(e){return r()({},e,{submitIndex:e.submitIndex+1})},function(){i.cropPhoto(a).then(function(a){var r=i.convertDataURIToFile(a);i.submitFileToS3(r,o,0,n[o]).then(e).catch(t)}).catch(t)})})}(0,o,t)}})).then(function(){i.props.showGlobalOverlay(),i.launchPostSubmissionToast(),i.setState(i.emptyState()),i.props.onSubmit&&i.props.onSubmit()}).catch(function(e){i.setState(function(e){return r()({},e,{uploadError:"Could not upload files"})}),C.a.error("Could not upload files. Error: ".concat(e)),i.track("uploaded_error_exists")}):C.a.error("Could not get upload URLs from UploadMediaBatch. Missing response.data.uploadMediaBatch.uploadUrls.")}).catch(function(e){C.a.error("Could not get upload URLs from UploadMediaBatch. Error ".concat(e))})}),h()(f()(f()(i)),"handleDescriptionProfanityError",function(e){var t=Object(M.localize)("media_upload_description_profanity_error");return i.handleDescriptionChecks(e,Oe,t)}),h()(f()(f()(i)),"handleDescriptionLinksError",function(e){var t=Object(M.localize)("linkify_url_error");return i.handleDescriptionChecks(e,Le,t)}),h()(f()(f()(i)),"handleDescriptionChecks",function(e,t,a){var n=new Map(i.state.itemStates);Array.from(i.state.itemStates.entries()).forEach(function(i,o){if(t(e[o])){var l=i[0],d=i[1],s=r()({},d,{descriptionError:a});n.set(l,s)}}),i.setState({itemStates:n})}),h()(f()(f()(i)),"handleCancel",function(){i.setState({displayLocationWarning:!1})}),h()(f()(f()(i)),"launchPostSubmissionToast",function(){if(i.props.launchToast){var e="photo"===i.props.mediaType,t="Profile"===i.props.route.page,a={node:Ie.postSubmissionToast(e)},n=r()({},a,{cta:_.createElement(se.Link,{to:{page:"Profile"},href:"/Profile"},Ie.viewPost())});t?i.props.launchToast(a):i.props.launchToast(n)}}),h()(f()(f()(i)),"submitNextMedia",function(){var e=i.state.submitIndex;if(e+=1,i.setState({submitIndex:e}),e>=i.state.itemStates.size)i.hadUploadError()?i.track("uploaded_error_exists"):(i.track("uploaded_all"),i.props.showGlobalOverlay(),i.launchPostSubmissionToast(),i.setState(i.emptyState()),i.props.onSubmit&&i.props.onSubmit());else{var t=Array.from(i.state.itemStates.keys())[e];i.submitMedia(t,e)}}),h()(f()(f()(i)),"videoFormDataLegacy",function(e,t){var a=new FormData;return a.append("the_file",e,e.name),a.append("description",t.description),a.append("locationIds",JSON.stringify(Array.from(t.selectedLocations.keys()))),a.append("photorelease","true"),a.append("securityToken",i.props.csrfToken),a.append("useHttpErrorResponse","true"),a}),h()(f()(f()(i)),"photoFormData",function(e,t){var a=new FormData;a.append("the_file",e,e.name),a.append("caption",t.description);var n=$(t.selectedLocations).value;if(!n)throw new Error("locationId should exist");return a.append("singleLocationId",n),a.append("flowaction","SERIAL"),a.append("reviewComplete","true"),a.append("photorelease","true"),a.append("securityToken",i.props.csrfToken),a.append("useHttpErrorResponse","true"),i.props.pid&&a.append("pid",i.props.pid.toString()),i.props.pidAttr&&a.append("pidAttr",i.props.pidAttr),a}),h()(f()(f()(i)),"submitMedia",function(e,t){var a=i.state.itemStates.get(e);if(!a)throw new Error("itemState should not be null");"photo"===a.mediaType?i.submitPhoto(e,a,t):i.submitVideo(e,a,t)}),h()(f()(f()(i)),"submitPhoto",function(e,t,a){if(Object(y.featureIsEnabled)("media_photo_upload_use_s3"))i.submitUsingS3Method(e,t,a);else{var n=i.photoFormData(e,t);i.submitUsingTa(e,t,a,"/PhotoUpload",n)}}),h()(f()(f()(i)),"submitVideo",function(e,t,a){if(Object(y.featureIsEnabled)("media_video_upload_use_s3"))i.submitUsingS3Method(e,t,a);else{var n=i.videoFormDataLegacy(e,t);i.submitUsingTa(e,t,a,"/PostVideo",n)}}),h()(f()(f()(i)),"submitUsingTa",function(e,t,a,n,o){var r=i.state,l=r.itemStates,d=r.itemUploadProgresses,s=t,c=new XMLHttpRequest;c.open("POST",n,!0),c.onload=function(){d.set(e,100),200===c.status?(i.track("upload_success","".concat(a+1," of ").concat(i.state.itemStates.size)),s.uploadSuccess=!0):i.trackSubmitErrorXhr(a,c),i.setState({itemStates:l,itemUploadProgresses:d}),i.submitNextMedia()},c.upload.addEventListener("progress",function(t){var a=t.loaded/t.total*100,n=Math.floor(.95*a);d.set(e,n),i.setState({itemUploadProgresses:d})},!1),c.send(o)}),h()(f()(f()(i)),"trackSubmitErrorXhr",function(e,t){var a;try{a=t.responseText}catch(e){a=t.responseType}i.trackSubmitError(e,t.status,t.statusText,a)}),h()(f()(f()(i)),"trackSubmitError",function(e,t,a,n){i.track("upload_fail","".concat(e+1," of ").concat(i.state.itemStates.size)),(t||0===t)&&i.track("upload_fail_status_code",t.toString()),a&&i.track("upload_fail_status",a),n&&i.track("upload_fail_response",n)}),h()(f()(f()(i)),"submitUsingS3Method",function(e,t,a){i.apolloClient.mutate({mutation:Se,variables:{request:{mediaType:t.mediaType.toUpperCase(),mimeType:e.type,fileName:e.name,fileSize:e.size,description:t.description,locationIds:Array.from(t.selectedLocations.keys()),pid:i.props.pid,pidAttr:i.props.pidAttr,width:t.dimensions&&t.dimensions.width,height:t.dimensions&&t.dimensions.height}}}).then(function(t){var n=t.data.initiateMediaUpload;i.submitFileToS3(e,a,n.mediaId,n.uploadUrl).then(function(){return i.completeMediaUpload(e,a,n.mediaId)}).then(i.submitNextMedia).catch(i.submitNextMedia)}).catch(function(e){i.trackSubmitError(a,void 0,void 0,"initateUpload ".concat(e.toString())),i.submitNextMedia()})}),h()(f()(f()(i)),"submitFileToS3",function(e,t,a,n){return new Promise(function(a,o){var l=new XMLHttpRequest;l.open("PUT",n,!0),l.onload=function(){200===l.status?i.setState(function(t){var i=new Map(t.itemUploadProgresses);return i.set(e,100),r()({},t,{itemUploadProgresses:i})},function(){return a()}):(i.trackSubmitErrorXhr(t,l),o(new Error("Upload of file ".concat(e.name," failed."))))},l.onerror=function(){i.trackSubmitError(t,void 0,void 0,"s3 onerror ".concat(l.readyState," ").concat(l.status.toString())),o(new Error("Upload of file ".concat(e.name," failed.")))},l.onabort=function(){i.trackSubmitError(t,void 0,void 0,"s3 onabort ".concat(l.readyState," ").concat(l.status.toString())),o(new Error("Upload of file ".concat(e.name," aborted.")))},l.upload.addEventListener("progress",function(t){i.setState(function(i){var a=new Map(i.itemUploadProgresses),n=t.loaded/t.total*100,o=Math.floor(n);return a.set(e,o),r()({},i,{itemUploadProgresses:a})},function(){return a()})},!1),l.send(e)})}),h()(f()(f()(i)),"completeMediaUpload",function(e,t,a){return new Promise(function(n,o){i.apolloClient.mutate({mutation:Ne,variables:{request:{mediaId:a}}}).then(function(){var a=i.state.itemStates.get(e);i.track("upload_success","".concat(t+1," of ").concat(i.state.itemStates.size)),a&&(a.uploadSuccess=!0,i.setState(function(e){return r()({},e,{itemStates:e.itemStates})},n)),n()}).catch(function(e){i.trackSubmitError(t,void 0,void 0,"completeUpload ".concat(e.toString())),o(new Error("Could not complete media upload. Error: ".concat(e)))})})}),h()(f()(f()(i)),"tryAgainClicked",function(){var e=i.state.itemStates,t=new Map;e.forEach(function(e,i){e.uploadSuccess||t.set(i,0)}),i.setState({itemUploadProgresses:t,submitIndex:-1,uploadError:""})}),h()(f()(f()(i)),"handleDragOver",function(e){e.preventDefault(),i.setState({isDragOver:!0})}),h()(f()(f()(i)),"handleDragLeave",function(e){e.preventDefault(),i.setState({isDragOver:!1})}),h()(f()(f()(i)),"handleDrop",function(e){e.preventDefault(),Object(ue.processFilesFromDrop)(e,i.addFile,i.allowedFileTypes,i.maxFileSizeInBytes,i.fileRejected),i.setState({isDragOver:!1})}),h()(f()(f()(i)),"requiredFieldsComplete",function(){var e=i.state,t=e.itemStates,a=e.batchDescription,n=e.batchSelectedLocation,o=new Map,l="",d="",s=!1;return t.forEach(function(e,t){var i=ee(e),a=te(e);(i||a)&&(s=!0);var n=r()({},e,{descriptionError:i,locationError:a});o.set(t,n)}),"photo"===i.props.mediaType&&Object(y.featureIsEnabled)("web_batch_media_photo_uploader")&&(0===a.length&&(l=Object(M.localize)("uploader_error_required_field"),s=!0),0===n.size&&(d=Object(M.localize)("uploader_error_required_field"),s=!0)),i.setState({itemStates:o,batchSelectedLocationError:d,batchDescriptionError:l}),!s}),h()(f()(f()(i)),"isEditing",function(){return i.state.submitIndex<0}),h()(f()(f()(i)),"isFinishedUploading",function(){return i.state.submitIndex>=i.state.itemStates.size}),h()(f()(f()(i)),"isUploading",function(){return!i.isFinishedUploading()&&i.state.submitIndex>=0}),h()(f()(f()(i)),"hadUploadError",function(){return!!i.isFinishedUploading()&&Array.from(i.state.itemStates.values()).some(function(e){return!e.uploadSuccess})}),h()(f()(f()(i)),"handleAddFileFromBatchMediaModal",function(e,t,a){i.setState(function(i){var n=i.itemStates,o=i.itemUploadProgresses,l=i.batchSelectedLocation;if(Array.from(n.keys()).some(function(t){return e.name===t.name&&e.size===t.size}))return i;var d=new Map(n);d.set(e,{mediaType:Object(q.mediaType)(e.name),description:"",selectedLocations:l||new Map,uploadSuccess:!1,originalUrl:t,cropParams:a});var s=new Map(o);return s.set(e,0),r()({},i,{itemStates:d,itemUploadProgresses:s})})}),h()(f()(f()(i)),"handleItemStatesChangedFromBatchMediaModal",function(e){i.setState(function(t){return r()({},t,{itemStates:e})})}),h()(f()(f()(i)),"handleBatchDescriptionChanged",function(e){i.setState(function(t){var i=t.itemStates,a=new Map(i);n()(a.keys()).forEach(function(t){a.set(t,r()({},a.get(t),{description:e}))});var o="";return 0===t.batchDescription.length&&(o=Object(M.localize)("uploader_error_required_field")),r()({},t,{itemStates:a,batchDescription:e,batchDescriptionError:o})})}),h()(f()(f()(i)),"handleBatchSelectedLocationChanged",function(e){i.setState(function(t){var a=t.itemStates,o=new Map(a);n()(o.keys()).forEach(function(t){o.set(t,r()({},o.get(t),{selectedLocations:e}))});var l="";return 0===i.state.batchSelectedLocation.size&&(l=Object(M.localize)("uploader_error_required_field")),r()({},t,{itemStates:o,batchSelectedLocation:e,batchSelectedLocationError:l})})}),h()(f()(f()(i)),"validateBatchSelectedLocation",function(){i.setState(function(e){var t="";return 0===e.batchSelectedLocation.size&&(t=Object(M.localize)("uploader_error_required_field")),r()({},e,{batchSelectedLocationError:t})})}),h()(f()(f()(i)),"validateBatchDescription",function(){i.setState(function(e){var t="";return 0===e.batchDescription.length&&(t=Object(M.localize)("uploader_error_required_field")),r()({},e,{batchDescriptionError:t})})}),h()(f()(f()(i)),"render",function(){var e="photo"===i.props.mediaType,t=_.createElement(O.TitleBar,{iconName:e?"camera-fill":"video-fill",displayType:"LEFT_ALIGN_GRAY"},Ie.title(e));if(e&&Object(y.featureIsEnabled)("web_batch_media_photo_uploader"))return _.createElement(ge.InteractionLogger,null,function(e){return _.createElement(_.Fragment,null,_.createElement(S.ApolloConsumer,null,function(e){return i.apolloClient=e,null}),_.createElement(I.Modal,{name:i.props.modalName,header:i.isFinishedUploading()?null:t,onDragOver:i.handleDragOver,onDragLeave:i.handleDragLeave,onDrop:i.handleDrop},_.createElement(ve.a,{batchDescription:i.state.batchDescription,batchDescriptionError:i.state.batchDescriptionError,batchDescriptionBlurred:i.validateBatchDescription,batchLocationError:i.state.batchSelectedLocationError,batchLocationSelectionBlurred:i.validateBatchSelectedLocation,batchSelectedLocation:i.state.batchSelectedLocation,filesSelectionError:i.state.errorMessage||"",isFinishedUploading:i.isFinishedUploading(),isMobile:i.props.isMobile,isRtl:i.props.isRtl,isUploading:i.isUploading(),itemStates:i.state.itemStates,itemUploadProgresses:i.state.itemUploadProgresses,onAddFile:i.handleAddFileFromBatchMediaModal,onBatchDescriptionChanged:i.handleBatchDescriptionChanged,onBatchLocationChanged:i.handleBatchSelectedLocationChanged,onClickPostPhotoButton:i.handleSubmitClicked,onClickRetryUpload:i.tryAgainClicked,onFileRejected:i.fileRejected,onItemStatesChanged:i.handleItemStatesChangedFromBatchMediaModal,onRemoveFile:i.handleRemoveFile,trackAction:i.track,uploadError:i.state.uploadError,logClick:e})))});var a,n=i.state.itemStates.size>0,o=n?null:_.createElement("div",{className:_e.guidelinesWrapper},_.createElement("div",{className:_e.guidelinesTips},Object(M.localize)("flash_uploader_tips_and_guidelines_10d8")),_.createElement("div",{className:_e.guidelinesNumVideos},Ie.maxAllowedFiles(e,i.maxAllowedFiles)),_.createElement("div",null,Ie.acceptedFormats(e,i.allowedFileTypes)),_.createElement("div",null,Ie.maxFileSize(e)),Object(y.featureIsEnabled)("social_link_posting_enabled")&&"video"===i.props.mediaType?_.createElement("div",null,_.createElement("span",{className:_e.guidelinesLinkUploader,onClick:function e(){i.track("post_a_link_click"),i.props.linkUploaderModalName&&i.props.showGlobalOverlay(i.props.linkUploaderModalName),i.props.showLinkUploaderOfGNavVideoModalLink&&i.props.linkUploaderModalNameOfGNavVideoModalLink&&(i.props.showLinkUploaderOfGNavVideoModalLink(!0),i.props.showGlobalOverlay(i.props.linkUploaderModalNameOfGNavVideoModalLink))}},Object(M.unescaped)(Object(M.localize)("video_upload_go_to_link_posting")))):null,_.createElement("div",{className:_e.guidelinesMoreInfo},_.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:Ie.guidelinesLink(e),onClick:function e(){return i.track("guidelines_click")}},Ie.guidelinesMoreInfo(e)))),r=Array.from(i.state.itemStates.entries()).map(function(e,t){var a=de()(e,2),n=a[0],o=a[1];return _.createElement(_.Fragment,{key:"fragment_".concat(n.name,"_").concat(n.size)},t>0?_.createElement("div",{className:_e.itemDivider}):null,_.createElement(ne,{file:n,index:t,videoCount:i.state.itemStates.size,itemState:o,descriptionChanged:i.handleDescriptionChanged,descriptionBlurred:i.handleDescriptionBlurred,handleRemoveFile:i.handleRemoveFile,locationSelectionChanged:i.handleLocationSelectionChanged,locationSelectionBlurred:i.handleLocationSelectionBlurred,handleGetDimensions:i.handleGetDimensions,track:i.track,isMobile:i.props.isMobile,isUploading:i.isUploading(),uploadProgress:i.state.itemUploadProgresses.get(n)}))}),l=i.state.errorMessage,d=n?null:_.createElement("div",{className:"".concat(_e.dropZone," ").concat(_e.dropZoneBig)},_.createElement("div",{className:_e.dropZoneItem},_.createElement(D.a,{type:"primary"},Ie.dropZoneButton(e))),i.props.isMobile?null:_.createElement(_.Fragment,null,_.createElement("div",{className:_e.dropZoneItem},Object(M.localize)("post_video_or_just_text")),_.createElement("div",{className:"".concat(_e.dropZoneItem," ").concat(_e.dragDropText)},Object(M.localize)("post_videodrag_and_drop_from_desktop")))),s=n?_.createElement("div",{className:"".concat(_e.dropZone," ").concat(_e.dropZoneSmall)},Object(M.unescaped)(Ie.uploadAnother(e,i.props.isMobile))):null,c={display:i.state.itemStates.size>=i.maxAllowedFiles?"none":"block"},u=l?null:_.createElement("div",{className:"".concat(n?_e.dropZoneSmallWrapper:""),style:c},_.createElement(ue.DropZone,{allowedFileTypes:i.allowedFileTypes,allowMultipleSelection:i.maxAllowedFiles>1,addFile:i.addFile,maxSizeInBytes:i.maxFileSizeInBytes,fileRejected:i.fileRejected,isDragOverOutsideComponent:i.state.isDragOver},d,s)),m=l?_.createElement("div",{className:_e.errorDisplay},l):null,p=n?_.createElement("div",{className:E()(_e.postButtonContainer,h()({},_e.paddingForReference,Object(y.featureIsEnabled)("social_at_reference_ugc_editor")))},_.createElement("div",{className:_e.postButton},i.isUploading()||i.isFinishedUploading()?_.createElement("div",{className:E()(_e.loaderContainer,h()({},_e.fullWidth,i.props.isMobile))},_.createElement("div",{className:_e.loaderCenter},_.createElement(w.LoadingBubbles,{color:"dark"}))):_.createElement(D.a,{type:"primary",size:i.props.isMobile?"fullwidth":"default",onClick:i.handleSubmitClicked},Ie.submitButton(e,i.state.itemStates.size)))):null;a=e?i.state.itemStates.size>1?Object(M.localize)("new_photos_terms_of_use",{link:"/pages/terms.html"}):Object(M.localize)("new_photo_terms_of_use",{link:"/pages/terms.html"}):i.state.itemStates.size>1?Object(M.localize)("new_videos_terms_of_use",{link:"/pages/terms.html"}):Object(M.localize)("new_video_terms_of_use",{link:"/pages/terms.html"});var v=i.hadUploadError(),g=n&&!v?_.createElement("div",{className:_e.releaseContainer},_.createElement("span",{className:_e.releaseItem},Object(M.unescaped)(a))):null,f=v?_.createElement("div",{className:_e.uploadError},_.createElement("div",{className:_e.oopsMessage},Ie.uploadFailed(e)),_.createElement(D.a,{type:"primary",size:"fullwidth",onClick:i.tryAgainClicked},Object(M.localize)("content_upload_fail_try_again"))):null,k=[_e.uploaderWrapper];return i.isUploading()&&k.push(_e.uploading),i.isFinishedUploading()&&k.push(_e.autoWidth),_.createElement(I.Modal,{name:i.props.modalName,header:i.isFinishedUploading()?null:t,onDragOver:i.handleDragOver,onDragLeave:i.handleDragLeave,onDrop:i.handleDrop},_.createElement(_.Fragment,null,_.createElement("div",{className:E()(k),style:{display:i.isFinishedUploading()?"none":"block"}},_.createElement("div",{style:{display:i.isFinishedUploading()?"none":"block",overflowY:"auto",overflowX:"hidden",paddingLeft:"2px",paddingRight:"2px"}},u||m,o,r,i.state.displayLocationWarning&&_.createElement(he,{onCancel:i.handleCancel,onPost:i.handleSubmitClicked}),p),g,f),_.createElement("input",{style:{display:"none"},type:"file",name:"media",accept:i.allowedFileTypes.join(","),multiple:!0,onChange:i.fileSelectionChanged,ref:function e(t){i.fileInputRef=t}}),_.createElement(ce.MountListener,{onComponentDidMount:i.handleComponentOpened,onComponentWillUnmount:i.handleComponentClosed})),_.createElement(S.ApolloConsumer,null,function(e){return i.apolloClient=e,null}))}),i.state=i.emptyState(),"video"===i.props.mediaType)i.allowedFileTypes=q.supportedVideoTypes,i.maxAllowedFiles=5;else{if("photo"!==i.props.mediaType)throw new Error("unknown mediaType ".concat(i.props.mediaType));i.allowedFileTypes=q.supportedImageTypes,i.maxAllowedFiles=10}return i.maxFileSizeInBytes="photo"===i.props.mediaType?ue.maxImageUploadSizeInBytes:ue.maxVideoUploadSizeInBytes,i}return v()(t,e),t}(_.Component),we=Object(b.connect)(function(e,t){return r()({isMobile:"MOBILE"===e.meta.device.viewportCategory,csrfToken:e.auth.csrfToken,pidAttr:e.meta.device.userAgentCategory,isRtl:e.i18n.isRtl},t)},{showGlobalOverlay:L.actions.overlays.showGlobalOverlay})(function e(t){var i=_.useContext(se.RouteContext).route;return _.createElement(me.Toaster,null,function(e){return _.createElement(De,re()({launchToast:e,route:i},t))})}),Te=i("./packages/social/feed/feedFragments/LocationFields.fragment.gql"),je=i("./packages/social/feed/feedFragments/SocialReferencesFields.fragment.gql"),ze={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"EditPhoto"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PhotoUpdateRequestInput"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"socialReference"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updatePhoto"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"userId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"caption"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"location"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LocationFields"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"socialReferences"},arguments:[],directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"socialReference"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"SocialReferencesFields"},directives:[]}]}}]}}]}}],loc:{start:0,end:432}};ze.loc.source={body:"968be41004b0"};var Pe={};function Re(e){return e.filter(function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!Pe[t]&&(Pe[t]=!0,!0)})}ze.definitions=ze.definitions.concat(Re(Te.a.definitions)),ze.definitions=ze.definitions.concat(Re(je.a.definitions));var xe=ze,Ae={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"EditVideo"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"VideoUpdateRequestInput"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"locationId"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},defaultValue:{kind:"IntValue",value:"0"},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"socialReference"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateVideo"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"caption"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"orderedLocations"},arguments:[{kind:"Argument",name:{kind:"Name",value:"scopedLocation"},value:{kind:"Variable",name:{kind:"Name",value:"locationId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LocationFields"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"socialReferences"},arguments:[],directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"socialReference"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userReferences"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"userName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"userId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"length"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"offset"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:489}};Ae.loc.source={body:"237057477ed0"};var Be={};Ae.definitions=Ae.definitions.concat(function Ve(e){return e.filter(function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!Be[t]&&(Be[t]=!0,!0)})}(Te.a.definitions));var qe=Ae,We={contentWrapper:"media-upload-EditMediaModal__contentWrapper--1gM1J",footer:"media-upload-EditMediaModal__footer--rogRj",loaderContainer:"media-upload-EditMediaModal__loaderContainer--t1h9t",fullWidth:"media-upload-EditMediaModal__fullWidth--1h5Sb",loaderCenter:"media-upload-EditMediaModal__loaderCenter--3Lntk",uploadError:"media-upload-EditMediaModal__uploadError--2O8Of",oopsMessage:"media-upload-EditMediaModal__oopsMessage--lINrz"},Ge=function e(t){return{type:"location_id",value:t.locationId,displayValue:t.name}},Ze=function(e){function t(e){var i;d()(this,t),i=c()(this,m()(t).call(this,e)),h()(f()(f()(i)),"apolloClient",void 0),h()(f()(f()(i)),"originalDescription",void 0),h()(f()(f()(i)),"originalLocations",void 0),h()(f()(f()(i)),"descriptionChanged",function(e,t){var a=r()({},i.state.itemState,{description:t}),n=ee(a);Object.assign(a,{descriptionError:n}),i.setState({itemState:a})}),h()(f()(f()(i)),"descriptionBlurred",function(){var e=ee(i.state.itemState),t=r()({},i.state.itemState,{descriptionError:e});i.setState({itemState:t})}),h()(f()(f()(i)),"locationSelectionChanged",function(e,t){var a=r()({},i.state.itemState,{selectedLocations:t}),n=te(a);Object.assign(a,{locationError:n}),i.setState({itemState:a})}),h()(f()(f()(i)),"locationSelectionBlurred",function(){var e=te(i.state.itemState),t=r()({},i.state.itemState,{locationError:e});i.setState({itemState:t})}),h()(f()(f()(i)),"requiredFieldsComplete",function(){var e=!1,t=ee(i.state.itemState),a=te(i.state.itemState);(t||a)&&(e=!0);var n=r()({},i.state.itemState,{descriptionError:t,locationError:a});return i.setState({itemState:n}),!e}),h()(f()(f()(i)),"isSetsEqual",function(e,t){return e.size===t.size&&n()(e).every(function(e){return t.has(e)})}),h()(f()(f()(i)),"valuesModifed",function(){if(i.state.itemState.description!==i.originalDescription)return!0;var e=new Set(i.state.itemState.selectedLocations.keys());return!i.isSetsEqual(e,i.originalLocations)}),h()(f()(f()(i)),"submitClicked",function(){if(i.valuesModifed()){if(i.requiredFieldsComplete()){var e=[i.state.itemState.description];Ue(i.apolloClient,e,i.submit,i.handleDescriptionProfanityError,i.handleDescriptionLinkError)}}else i.props.showGlobalOverlay()}),h()(f()(f()(i)),"submit",function(){i.setState({isSubmitting:!0});var e=i.isPhoto()?{mutation:xe,variables:{input:{photoId:i.props.mediaObject.id,description:i.state.itemState.description,locationId:$(i.state.itemState.selectedLocations).value},socialReference:Object(y.featureIsEnabled)("social_at_referencing_profile_links")}}:{mutation:qe,variables:{input:{videoId:i.props.mediaObject.id,description:i.state.itemState.description,locationIds:Array.from(i.state.itemState.selectedLocations.keys())},socialReference:Object(y.featureIsEnabled)("social_at_referencing_profile_links")}};i.apolloClient.mutate(e).then(function(){i.props.onSubmit&&i.props.onSubmit(),i.setState({isSubmitting:!1}),i.props.showGlobalOverlay()}).catch(function(e){C.a.error(e),i.track("submitError",e,i.props.mediaObject.id),i.setState({isSubmitting:!1,hadSubmitError:!0})})}),h()(f()(f()(i)),"handleDescriptionProfanityError",function(){var e=Object(M.localize)("media_upload_description_profanity_error"),t=r()({},i.state.itemState,{descriptionError:e});i.setState({itemState:t})}),h()(f()(f()(i)),"handleDescriptionLinkError",function(){var e=Object(M.localize)("linkify_url_error"),t=r()({},i.state.itemState,{descriptionError:e});i.setState({itemState:t})}),h()(f()(f()(i)),"tryAgainClicked",function(){i.setState({hadSubmitError:!1})}),h()(f()(f()(i)),"track",function(e,t,a){var n={module:i.isPhoto()?"photo_edit":"video_edit",action:e,context:t,value:a};Object.keys(n).forEach(function(e){return void 0===n[e]&&delete n[e]}),j()(n)}),h()(f()(f()(i)),"pickSourceMp4",function(e){if(!e)return"";var t=e.find(function(e){return e.url&&e.url.toLowerCase().endsWith(".mp4")});return t?t.url:""}),h()(f()(f()(i)),"isPhoto",function(){return"Photo"===i.props.mediaObject.__typename}),h()(f()(f()(i)),"render",function(){var e;if(i.isPhoto()){if(i.props.mediaObject.photoSizes){var t=i.props.mediaObject.photoSizes.map(function(e){return e});e=Object(z.pickSourceForSize)(Q.width,Q.height,t).url}}else i.props.mediaObject.sources&&(e=i.pickSourceMp4(i.props.mediaObject.sources));var a=_.createElement(O.TitleBar,{displayType:"LEFT_ALIGN_GRAY"},Object(M.localize)("trips_edit_CTA")),n=i.state.isSubmitting?_.createElement("div",{className:E()(We.loaderContainer,h()({},We.fullWidth,i.props.isMobile))},_.createElement("div",{className:We.loaderCenter},_.createElement(w.LoadingBubbles,{color:"dark"}))):_.createElement(D.a,{type:"primary",size:i.props.isMobile?"fullwidth":"default",onClick:i.submitClicked},Object(M.localize)("trips_save_CTA")),o=i.state.hadSubmitError?_.createElement("div",{className:We.uploadError},_.createElement("div",{className:We.oopsMessage},Object(M.localize)("ugc_edit_attempt_failure")),_.createElement(D.a,{type:"primary",size:"fullwidth",onClick:i.tryAgainClicked},Object(M.localize)("content_upload_fail_try_again"))):null;return _.createElement(I.Modal,{name:i.props.modalName,header:a},_.createElement("div",{className:We.contentWrapper,style:{display:i.state.hadSubmitError?"none":"block"}},_.createElement(ne,{mediaUrl:e,index:0,videoCount:1,itemState:i.state.itemState,allowDelete:!1,descriptionChanged:i.descriptionChanged,descriptionBlurred:i.descriptionBlurred,handleRemoveFile:function e(){},locationSelectionChanged:i.locationSelectionChanged,locationSelectionBlurred:i.locationSelectionBlurred,track:function e(){},isMobile:i.props.isMobile,isUploading:!1,uploadProgress:0}),_.createElement("div",{className:We.footer},n),_.createElement(S.ApolloConsumer,null,function(e){return i.apolloClient=e,null})),o)});var a=new Map;if(e.mediaObject&&e.mediaObject.location){var o=e.mediaObject.location;a.set(o.locationId.toString(),Ge(o))}return e.mediaObject&&e.mediaObject.locations&&e.mediaObject.locations.forEach(function(e){a.set(e.locationId.toString(),Ge(e))}),i.originalDescription=e.mediaObject&&e.mediaObject.caption,i.originalDescription=i.originalDescription||"",i.originalLocations=new Set(a.keys()),i.state={itemState:{mediaType:i.isPhoto()?"photo":"video",description:i.originalDescription,selectedLocations:a,uploadSuccess:!1},isSubmitting:!1,hadSubmitError:!1},i}return v()(t,e),t}(_.Component),He=Object(b.connect)(function(e,t){return r()({isMobile:"MOBILE"===e.meta.device.viewportCategory},t)},{showGlobalOverlay:L.actions.overlays.showGlobalOverlay})(Ze);i.d(t,"EditMediaModal",function(){return He}),i.d(t,"MediaUploaderModal",function(){return we}),i.d(t,"MediaUploadItem",function(){return ne}),i.d(t,"previewSizeDesktop",function(){return Q}),i.d(t,"validateMediaDescription",function(){return ee}),i.d(t,"validateMediaLocation",function(){return te}),i.d(t,"getSingleLocation",function(){return $}),i.d(t,"LocationTagWarning",function(){return he})},"./packages/social/feed/feedFragments/LocationFields.fragment.gql":function(e,t,i){"use strict";var a=i("./packages/social/feed/feedFragments/PhotoSizes.fragment.gql"),n={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"LocationFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"LocationInformation"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"locationId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"additionalNames"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"long"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"longOnlyParent"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"placeType"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isGeo"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"parentGeoId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"reviewSummary"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"count"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"rating"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"locationId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"thumbnail"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"photoSizes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoSizes"},directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"parent"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"locationId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"parentGeoId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"additionalNames"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"long"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"route"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"socialStatistics"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isSaved"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:473}};n.loc.source={body:"79b9e38d4f4e"};var o={};n.definitions=n.definitions.concat(function r(e){return e.filter(function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!o[t]&&(o[t]=!0,!0)})}(a.a.definitions)),t.a=n},"./packages/social/feed/feedFragments/PhotoSizes.fragment.gql":function(e,t,i){"use strict";var a={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"PhotoSizes"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"PhotoSize"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"width"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"height"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isHorizontal"},arguments:[],directives:[]}]}}],loc:{start:0,end:75}};a.loc.source={body:"d458b47a8b35"},t.a=a},"./packages/social/feed/feedFragments/SocialReferencesFields.fragment.gql":function(e,t,i){"use strict";var a={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"SocialReferencesFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"SocialReferences"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"linkReferences"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"categorization"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"length"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"offset"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",alias:{kind:"Name",value:"encodedQualifiedUrl"},name:{kind:"Name",value:"qualifiedUrl"},arguments:[],directives:[{kind:"Directive",name:{kind:"Name",value:"encode"},arguments:[]}]}]}},{kind:"Field",name:{kind:"Name",value:"userReferences"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"length"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"offset"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"userId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"userName"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:329}};a.loc.source={body:"661e89768235"},t.a=a}}});
//# sourceMappingURL=media.upload.220a4dc026.js.map