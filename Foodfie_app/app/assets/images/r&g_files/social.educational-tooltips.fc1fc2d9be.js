(window.$WP=window.$WP||[]).push({id:"@ta/social.educational-tooltips",d:["vendor-babel","vendor-react-libs","vendor-apollo-libs","ta-platform","@ta/common.localstorage","@ta/overlays.managers","@ta/common.sessionstorage","ta-common","react-transition-group","@ta/social.login-gate","@ta/social.feed","@ta/social.feed-filter","@ta/overlays.pieces"],e:["./packages/social/educational-tooltips/index.jsx"],x:{"./packages/social/educational-tooltips/index.jsx":["ScrollFeedTooltip","OnboardingCompleteReload","HomeFeedScrollPrompt","ScopedHomeLoggedOutUsersLoginBar","CheckNewFeed","getState","ACTIONS"]},m:{"./packages/social/educational-tooltips/index.jsx":function(e,o,t){"use strict";t.r(o);var n=t("@babel/runtime/helpers/esm/classCallCheck"),i=t.n(n),a=t("@babel/runtime/helpers/esm/createClass"),l=t.n(a),r=t("@babel/runtime/helpers/esm/possibleConstructorReturn"),s=t.n(r),c=t("@babel/runtime/helpers/esm/getPrototypeOf"),d=t.n(c),u=t("@babel/runtime/helpers/esm/inherits"),p=t.n(u),m=t("@babel/runtime/helpers/esm/assertThisInitialized"),h=t.n(m),k=t("@babel/runtime/helpers/esm/defineProperty"),v=t.n(k),f=t("react"),g=t("react-redux"),S=t("react-apollo"),b=t("@ta/common.i18n"),_=t("@ta/events.window-scroll"),y=t.n(_),N=t("@ta/common.classnames"),I=t.n(N),w=t("@ta/common.localstorage"),T=t.n(w),O=t("@ta/common.tracking"),F=t.n(O),C=t("@ta/common.features"),V=t("@babel/runtime/helpers/esm/objectSpread"),E=t.n(V),x=new(t("@ta/common.state").PrivateStateAccessor)("social-scroll-tooltip",{onboardingClosed:!1,forceShowScrollTooltip:!1,forceShowLoginBar:!1}),j=function e(o){return x.getFrom(o)},P={onboardingDone:function e(){return x.action({type:"DONE_ONBOARDING"})},showScrollTooltip:function e(){return x.action({type:"SHOW_TOOLTIP"})},showLoginBar:function e(){return x.action({type:"SHOW_LOGIN_BAR"})}};x.setReducer(function(e,o){switch(o.type){case"DONE_ONBOARDING":return E()({},e,{onboardingClosed:!0});case"SHOW_TOOLTIP":return E()({},e,{forceShowScrollTooltip:!0});case"SHOW_LOGIN_BAR":return E()({},e,{forceShowLoginBar:!0});default:return e}});var R={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"LocationName"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"locationIds"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"locations"},arguments:[{kind:"Argument",name:{kind:"Name",value:"locationIds"},value:{kind:"Variable",name:{kind:"Name",value:"locationIds"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:100}};R.loc.source={body:"98f9aeb38ed9"};var B=R,L=1,D="social_tooltip",A="social_onboarding_done_reload",G=function e(){var o="no-fid";return window.location.search.substr(1).split("&").forEach(function(e){var t=e.split("=");"fid"===t[0]&&(o=decodeURIComponent(t[1]))}),o},U=function(e){function o(){var e,t;i()(this,o);for(var n=arguments.length,a=new Array(n),l=0;l<n;l++)a[l]=arguments[l];return t=s()(this,(e=d()(o)).call.apply(e,[this].concat(a))),v()(h()(h()(t)),"state",{hasScrolled:!1,isHalfSecondAfterMount:!1}),v()(h()(h()(t)),"onScroll",function(){if(t.shouldShow()&&!t.state.hasScrolled){t.setState({hasScrolled:!0});var e=G();F()({module:D,action:"discover_your_feed_scrolled",context:e,value:t.props.locationId}),T.a.remove(A)}}),v()(h()(h()(t)),"shouldShow",function(){if(Object(C.featureIsEnabled)("social_scoped_home_scrolling_tooltip"))return!1;var e=T.a.get("maxTASocialScroll"),o=!t.state.hasScrolled&&t.state.isHalfSecondAfterMount&&(!e||e<3);if(Object(C.featureIsEnabled)("ml_more_visible_scroll_tooltip"))return o;if(o){var n=G();F()({module:D,action:"discover_your_feed_control_ghost_impression",context:n,value:t.props.locationId})}return(t.props.hasClosedOnboarding||t.foundOnPageReload())&&t.props.locationId===L&&null!==t.props.loggedInUserId&&!t.state.hasScrolled&&t.state.isHalfSecondAfterMount}),v()(h()(h()(t)),"foundOnPageReload",function(){return!!T.a.get(A)}),t}return p()(o,e),l()(o,[{key:"componentDidMount",value:function e(){var o=this;setTimeout(function(){o.setState({isHalfSecondAfterMount:!0})},500)}},{key:"render",value:function e(){var o=this,t=f.createElement("div",{className:"social-educational-tooltips-ScrollFeedTooltip__toolTip--1Tvoz",onClick:function e(){var t=G();F()({module:D,action:"discover_your_feed_click",context:t,value:o.props.locationId});var n=window.pageYOffset;window.scrollTo({top:o.props.elementToScrollTo.current.getBoundingClientRect().top+n-54,behavior:"smooth"})}},f.createElement(O.Track,{visible:{module:D,action:"discover_your_feed_shown",context:"",value:this.props.locationId}},f.createElement("div",{className:"social-educational-tooltips-ScrollFeedTooltip__toolTipText--3xx78"},this.props.locationId===L?Object(b.localize)("tooltips_scroll_travel_feed_1"):f.createElement(S.Query,{query:B,variables:{locationIds:[this.props.locationId]}},function(e){var o=e.loading,t=e.data;return o?null:Object(b.localize)("tooltips_geo_updated_1",{Geo:t.locations[0].name})})),f.createElement("div",{className:I()("ui_icon","single-chevron-down","social-educational-tooltips-ScrollFeedTooltip__arrow--6gtry","social-educational-tooltips-ScrollFeedTooltip__bounce--seRaj")})));return f.createElement(f.Fragment,null,f.createElement(y.a,{callback:this.onScroll,throttle:600}),this.shouldShow()&&t)}}]),o}(f.Component),H=Object(g.connect)(function(e){return{locationId:e.page.geoId,loggedInUserId:e.auth.loggedInUserId,hasClosedOnboarding:j(e).onboardingClosed}})(U),M=t("@ta/overlays.managers"),z=t("@ta/common.sessionstorage"),W=t.n(z),q=t("@ta/styleguide.icon"),J=function e(o){var t=o.onClick,n=o.isGhost;return f.createElement("div",{className:I()("social-educational-tooltips-ImprovedScrollFeedToolTip__container--2oz1A",t?"social-educational-tooltips-ImprovedScrollFeedToolTip__clickable--21gHw":"",n?"social-educational-tooltips-ImprovedScrollFeedToolTip__ghost--1PjhC":""),onClick:t},f.createElement(q.Icon,{name:"arrow-down",className:"social-educational-tooltips-ImprovedScrollFeedToolTip__downArrow--w8Kl5"}),Object(b.localize)("scroll_tooltip_variant_1"))};J.defaultProps={onClick:function e(){},isGhost:!1};var K=J,Y=54,Q="maxTASocialScroll",$=150,X=function(e){function o(){var e,t;i()(this,o);for(var n=arguments.length,a=new Array(n),l=0;l<n;l++)a[l]=arguments[l];return t=s()(this,(e=d()(o)).call.apply(e,[this].concat(a))),v()(h()(h()(t)),"state",{isDelayedAfterMount:!1,clickedTooltip:!1,hasScrolled:!1,shouldForceShowViaSessionStorage:!1}),v()(h()(h()(t)),"onClick",function(){t.props.elementToScrollTo&&window.scrollTo({top:t.props.elementToScrollTo.current.getBoundingClientRect().top+window.pageYOffset-Y,behavior:"smooth"}),t.setState({clickedTooltip:!0})}),v()(h()(h()(t)),"onScroll",function(){t.state.hasScrolled||t.setState({hasScrolled:!0})}),v()(h()(h()(t)),"isGhost",function(){return!t.props.shouldForceShowViaRedux&&!t.state.shouldForceShowViaSessionStorage&&!Object(C.featureIsEnabled)("social_scoped_home_scrolling_tooltip")}),v()(h()(h()(t)),"hasNotScrolled",function(){return!t.state.hasScrolled&&window.pageYOffset<$}),v()(h()(h()(t)),"shouldShow",function(e){var o=T.a.get(Q);return!e&&t.state.isDelayedAfterMount&&t.hasNotScrolled()&&!t.state.clickedTooltip&&(!o||o<3||t.props.shouldForceShowViaRedux||t.state.shouldForceShowViaSessionStorage)}),v()(h()(h()(t)),"timeoutId",void 0),t}return p()(o,e),l()(o,[{key:"componentDidMount",value:function e(){var o=this;this.timeoutId=setTimeout(function(){o.setState({isDelayedAfterMount:!0})},500),W.a.has("show_scoped_home_scroll_prompt")&&(this.setState({shouldForceShowViaSessionStorage:!0}),W.a.remove("show_scoped_home_scroll_prompt"))}},{key:"componentWillUnmount",value:function e(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}},{key:"render",value:function e(){var o=this;return f.createElement(M.Opener,{name:"onboarding-interstitial"},function(e,t){return o.shouldShow(t)?f.createElement(O.Track,{mount:o.isGhost()?{module:"social_tooltip | discover_your_feed_ghost",action:"impression",context:o.props.feedImpressionId?o.props.feedImpressionId:"",parentUid:o.props.puid}:{module:"social_tooltip | discover_your_feed",action:"impression",context:o.props.feedImpressionId?o.props.feedImpressionId:"",parentUid:o.props.puid},click:{module:"social_tooltip | discover_your_feed",action:"click",context:o.props.feedImpressionId?o.props.feedImpressionId:"",parentUid:o.props.puid}},f.createElement(K,{onClick:o.onClick,isGhost:o.isGhost()}),f.createElement(y.a,{callback:o.onScroll,throttle:600})):null})}}]),o}(f.Component);v()(X,"defaultProps",{elementToScrollTo:void 0});var Z=Object(g.connect)(function(e){return{puid:e.tracking.uid,shouldForceShowViaRedux:j(e).forceShowScrollTooltip}})(X),ee=t("@ta/common.routing"),oe=t("react-transition-group"),te=t("@ta/social.login-gate"),ne=t("@ta/styleguide.button"),ie=t.n(ne),ae=function e(o){var t=o.shouldShow,n=o.trackingOnLoginClick,i=o.trackingOnJoinClick,a=o.trackingOnShow,l=o.isGhost,r=o.productId;return f.createElement(oe.CSSTransition,{timeout:500,classNames:{enter:"social-educational-tooltips-LoginBar__slideInEnter--TgokM",enterActive:"social-educational-tooltips-LoginBar__slideInEnterActive--2Kxix"},in:t,unmountOnExit:!0},f.createElement("div",{className:"".concat("social-educational-tooltips-LoginBar__container--3yd2r"," ").concat(l?"social-educational-tooltips-LoginBar__ghost--3ORLB":"")},f.createElement(O.Track,{mount:E()({once:!0},a)},f.createElement("span",{className:"social-educational-tooltips-LoginBar__leftText--3gOCI"},Object(b.localize)("social_bar_prompt"))),f.createElement("div",{className:"social-educational-tooltips-LoginBar__rightSide--6yHke"},f.createElement(te.SocialLoginGate,{flowOrigin:"login",pid:r},function(e){return f.createElement("div",{className:"social-educational-tooltips-LoginBar__loginButton--3t91a"},f.createElement(O.Track,{click:E()({once:!1},n)},f.createElement(ie.a,{onClick:function o(){e()},type:"none",size:"large"},f.createElement("span",null,Object(b.localize)("social_bar_log_in")))))}),f.createElement(te.SocialLoginGate,{flowOrigin:"join",pid:r},function(e){return f.createElement(O.Track,{click:E()({once:!1},i)},f.createElement(ie.a,{onClick:function o(){e()},type:"secondary",size:"large"},f.createElement("span",null,Object(b.localize)("social_bar_join"))))}))))};ae.defaultProps={trackingOnLoginClick:void 0,trackingOnJoinClick:void 0,trackingOnShow:void 0,isGhost:!1,productId:void 0};var le=ae,re=300,se=function(e){function o(){var e,t;i()(this,o);for(var n=arguments.length,a=new Array(n),l=0;l<n;l++)a[l]=arguments[l];return t=s()(this,(e=d()(o)).call.apply(e,[this].concat(a))),v()(h()(h()(t)),"state",{hasScrolledPastSecondSection:!1,shouldForceShowViaSessionStorage:!1}),v()(h()(h()(t)),"onScroll",function(){!t.state.hasScrolledPastSecondSection&&t.props.topOfFeed.current.getBoundingClientRect().top+re<0&&t.setState({hasScrolledPastSecondSection:!0})}),v()(h()(h()(t)),"getProductId",function(){return t.props.shouldForceShowViaRedux||t.state.shouldForceShowViaSessionStorage?40510:-1}),v()(h()(h()(t)),"isScopedHome",function(e){return"latitude"in e||"longitude"in e||"geo"in e}),v()(h()(h()(t)),"isGhost",function(){return!t.props.shouldForceShowViaRedux&&!t.state.shouldForceShowViaSessionStorage&&!Object(C.featureIsEnabled)("social_scoped_home_login_bar")}),v()(h()(h()(t)),"shouldBeOnPage",function(e){return!t.props.isUserLoggedIn&&"DESKTOP"===t.props.viewportCategory&&(t.isScopedHome(e)||t.props.shouldForceShowViaRedux||t.state.shouldForceShowViaSessionStorage)}),v()(h()(h()(t)),"shouldBeVisible",function(e){return t.shouldBeOnPage(e)&&t.state.hasScrolledPastSecondSection}),t}return p()(o,e),l()(o,[{key:"componentDidMount",value:function e(){W.a.has("show_scoped_home_login_bar")&&(this.setState({shouldForceShowViaSessionStorage:!0}),W.a.remove("show_scoped_home_login_bar"))}},{key:"render",value:function e(){var o=this;return f.createElement(ee.RouteConsumer,null,function(e){var t=e.route;return o.shouldBeOnPage(t)&&f.createElement(f.Fragment,null,f.createElement(y.a,{callback:o.onScroll,throttle:600}),f.createElement(le,{shouldShow:o.shouldBeVisible(t),trackingOnLoginClick:{module:"social_tooltip | login_bar_login",action:"click",context:o.props.feedImpressionId?o.props.feedImpressionId:"",parentUid:o.props.puid},trackingOnJoinClick:{module:"social_tooltip | login_bar_join",action:"click",context:o.props.feedImpressionId?o.props.feedImpressionId:"",parentUid:o.props.puid},trackingOnShow:o.isGhost()?{module:"social_tooltip | login_bar_ghost",action:"impression",context:o.props.feedImpressionId?o.props.feedImpressionId:"",parentUid:o.props.puid}:{module:"social_tooltip | login_bar",action:"impression",context:o.props.feedImpressionId?o.props.feedImpressionId:"",parentUid:o.props.puid},isGhost:o.isGhost(),productId:o.getProductId()}))})}}]),o}(f.Component),ce=Object(g.connect)(function(e){return{isUserLoggedIn:!!e.auth.loggedInUserId,puid:e.tracking.uid,viewportCategory:e.meta.device.viewportCategory,shouldForceShowViaRedux:j(e).forceShowLoginBar}})(se),de=t("@ta/social.feed"),ue=t("@ta/social.feed-filter"),pe=t("@ta/overlays.pieces"),me={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"CheckNewFeed"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"locationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"placement"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PlacementEnumInput"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"puid"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"sessionType"}},type:{kind:"NamedType",name:{kind:"Name",value:"SessionTypeEnumInput"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"allowedTypes"}},type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"FeedSectionItemTypeInput"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"latitude"}},type:{kind:"NamedType",name:{kind:"Name",value:"Float"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"longitude"}},type:{kind:"NamedType",name:{kind:"Name",value:"Float"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"restoreFromFeedId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"ipGeo"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"socialFeedHasNewContent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"feedRequest"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"placement"},value:{kind:"Variable",name:{kind:"Name",value:"placement"}}},{kind:"ObjectField",name:{kind:"Name",value:"puid"},value:{kind:"Variable",name:{kind:"Name",value:"puid"}}},{kind:"ObjectField",name:{kind:"Name",value:"sessionType"},value:{kind:"Variable",name:{kind:"Name",value:"sessionType"}}},{kind:"ObjectField",name:{kind:"Name",value:"context"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"location"},value:{kind:"Variable",name:{kind:"Name",value:"locationId"}}}]}},{kind:"ObjectField",name:{kind:"Name",value:"limit"},value:{kind:"IntValue",value:"20"}},{kind:"ObjectField",name:{kind:"Name",value:"allowedTypes"},value:{kind:"Variable",name:{kind:"Name",value:"allowedTypes"}}},{kind:"ObjectField",name:{kind:"Name",value:"latitude"},value:{kind:"Variable",name:{kind:"Name",value:"latitude"}}},{kind:"ObjectField",name:{kind:"Name",value:"longitude"},value:{kind:"Variable",name:{kind:"Name",value:"longitude"}}},{kind:"ObjectField",name:{kind:"Name",value:"restoreFromUid"},value:{kind:"Variable",name:{kind:"Name",value:"restoreFromFeedId"}}},{kind:"ObjectField",name:{kind:"Name",value:"ipGeo"},value:{kind:"Variable",name:{kind:"Name",value:"ipGeo"}}}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"hasNewContent"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"impressionId"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:641}};me.loc.source={body:"1638e67f45a3"};var he=me,ke=function(e){function o(){var e,t;i()(this,o);for(var n=arguments.length,a=new Array(n),l=0;l<n;l++)a[l]=arguments[l];return t=s()(this,(e=d()(o)).call.apply(e,[this].concat(a))),v()(h()(h()(t)),"state",{checkNewFeed:!1,promptStyle:{top:0,left:0}}),v()(h()(h()(t)),"promptRef",f.createRef()),t}return p()(o,e),l()(o,[{key:"componentDidUpdate",value:function e(o){o.loggedInUserId||!this.props.loggedInUserId||this.state.checkNewFeed||this.setState({checkNewFeed:!0,promptStyle:this.calcPromptPosition()})}},{key:"calcPromptPosition",value:function e(){var o=this.props.topOfFeed.current.getBoundingClientRect(),t=o.top,n=o.right-o.left;return{top:t>50?t+50:120,left:o.left+n/2}}},{key:"refreshFeed",value:function e(){var o=this;this.setState({checkNewFeed:!1},function(){o.props.reloadFeedCallback(),o.props.topOfFeed.current.getBoundingClientRect().top<0&&window.scrollTo({top:o.props.topOfFeed.current.getBoundingClientRect().top,behavior:"smooth"})})}},{key:"updatePromptPosition",value:function e(){if(this.state.checkNewFeed){var o=this.calcPromptPosition();o.left===this.state.promptStyle.left&&o.top===this.state.promptStyle.top||this.setState({promptStyle:this.calcPromptPosition()})}}},{key:"render",value:function e(){var o=this,t=Object(ue.getAllowedTypes)(this.props.allowedTypes);return this.state.checkNewFeed?f.createElement(S.Query,{query:he,variables:{placement:this.props.placement,locationId:"".concat(this.props.locationId),sessionType:Object(de.sessionType)(this.props.viewportCategory),puid:this.props.puid,allowedTypes:t,latitude:this.props.latitude||null,longitude:this.props.longitude||null,restoreFromFeedId:this.props.feedIdToRestore,ipGeo:"".concat(this.props.ipGeo)}},function(e){var t=e.loading,n=e.data;if(!t&&n&&n.socialFeedHasNewContent&&n.socialFeedHasNewContent.hasNewContent){var i={position:"fixed",top:"".concat(o.state.promptStyle.top,"px"),left:"".concat(o.state.promptStyle.left,"px"),transform:"translateX(-50%)"};return f.createElement(f.Fragment,null,f.createElement(pe.Overlay,{overlayType:"background",position:i},f.createElement("a",{ref:o.promptRef,className:"social-educational-tooltips-CheckNewFeed__text_container--1MiI4",onClick:function e(){o.refreshFeed()}},f.createElement(q.Icon,{name:"arrow-up",className:"social-educational-tooltips-CheckNewFeed__icon--3usVd"}),f.createElement("span",{className:"social-educational-tooltips-CheckNewFeed__text--1M1Pi"},Object(b.localize)("social_feed_prompt_refresh")))),f.createElement(y.a,{callback:function e(){o.updatePromptPosition()},throttle:50}))}return null}):null}}]),o}(f.Component),ve=Object(g.connect)(function(e){return{viewportCategory:e.meta.device.viewportCategory,loggedInUserId:e.auth.loggedInUserId}})(ke);t.d(o,"ScrollFeedTooltip",function(){return H}),t.d(o,"OnboardingCompleteReload",function(){return A}),t.d(o,"HomeFeedScrollPrompt",function(){return Z}),t.d(o,"ScopedHomeLoggedOutUsersLoginBar",function(){return ce}),t.d(o,"CheckNewFeed",function(){return ve}),t.d(o,"getState",function(){return j}),t.d(o,"ACTIONS",function(){return P})}}});
//# sourceMappingURL=social.educational-tooltips.fc1fc2d9be.js.map