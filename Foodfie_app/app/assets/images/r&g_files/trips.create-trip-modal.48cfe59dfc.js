(window.$WP=window.$WP||[]).push({id:"@ta/trips.create-trip-modal",d:["vendor-react-libs","@ta/trips.trip-types","vendor-babel","vendor-apollo-libs","ta-platform","@ta/overlays.modal","@ta/overlays.managers","@ta/overlays.headers","@ta/input.text-input","ta-common","@ta/social.login-gate","@ta/trips.graphql","@ta/trips.tracking","@ta/trips.privacy-control","@ta/trips.trip-errors","@ta/trips.trip-util"],e:["./packages/trips/create-trip-modal/index.jsx"],x:{"./packages/trips/create-trip-modal/index.jsx":["CreateTripModal","CreateTripWithAddItemModal","CreateTripWithMoveItemModal"]},m:{"./packages/trips/create-trip-modal/index.jsx":function(e,t,r){"use strict";r.r(t);var a=r("react"),i=(r("@ta/trips.trip-types"),r("@babel/runtime/helpers/esm/objectSpread")),n=r.n(i),o=r("@babel/runtime/helpers/esm/classCallCheck"),l=r.n(o),s=r("@babel/runtime/helpers/esm/createClass"),c=r.n(s),p=r("@babel/runtime/helpers/esm/possibleConstructorReturn"),m=r.n(p),u=r("@babel/runtime/helpers/esm/getPrototypeOf"),d=r.n(u),v=r("@babel/runtime/helpers/esm/inherits"),_=r.n(v),f=r("@babel/runtime/helpers/esm/assertThisInitialized"),h=r.n(f),T=r("@babel/runtime/helpers/esm/defineProperty"),C=r.n(T),b=r("react-redux"),g=r("react-apollo"),y=r("@ta/common.features"),E=r("@ta/overlays.modal"),I=r("@ta/overlays.managers"),M=r("@ta/overlays.headers"),N=r("@ta/common.i18n"),P=r("@ta/input.text-input"),O=r("@ta/styleguide.button"),S=r.n(O),j=r("@ta/styleguide.loading"),k=r("@ta/social.login-gate"),B=r("@ta/common.tracking"),L=r("@ta/trips.graphql"),w=r("@ta/trips.tracking"),x=r("@ta/trips.privacy-control"),A=r.n(x),D=r("@ta/trips.trip-errors"),z=function(e){function t(e){var r;return l()(this,t),r=m()(this,d()(t).call(this,e)),C()(h()(h()(r)),"onInputChange",function(e){var t=e.currentTarget;r.setState({form:Object.assign({},r.state.form,C()({},t.name,t.value)),error:null})}),C()(h()(h()(r)),"onPrivacyChange",function(e){r.setState({form:Object.assign({},r.state.form,{tripPrivacy:e}),error:null})}),C()(h()(h()(r)),"onCreateClick",function(e){r.isCreateDisabled()&&e.preventDefault()}),C()(h()(h()(r)),"getInitialStates",function(){return{form:{tripName:"",tripPrivacy:r.props.isPublicTrip?"PUBLIC":"PRIVATE"},error:null,impressionElement:"createTripModal"}}),C()(h()(h()(r)),"isCreateDisabled",function(){var e=r.state,t=e.error,a=e.form,i=a.tripName,n=a.tripPrivacy;return!!t||0===i.trim().length||!n}),r.state=r.getInitialStates(),r}return _()(t,e),c()(t,[{key:"onSubmit",value:function e(t,r,a){if(t.preventDefault(),this.validate()){var i=this.state.form,n=i.tripPrivacy,o={variables:{title:i.tripName,description:null,photoId:null,status:n}};"PUBLIC"!==n?a(o):r().then(function(){return a(o)})}}},{key:"onTripCreated",value:function e(t){this.setState(this.getInitialStates());var r=this.props.onTripCreated(t);r&&this.setState({error:r})}},{key:"validate",value:function e(){return!(this.state.form.tripName.trim().length>50&&(this.setState({error:Object(N.localize)("stat_modal_name_exceeds_50")}),1))}},{key:"render",value:function e(){var t=this,r=a.createElement("div",{className:"ui_label_group"},a.createElement("label",{className:"trips-create-trip-modal-CreateTripModalBase__label--1Pu4m",htmlFor:"tripName"},Object(N.localize)("stat_modal_trip_name"),a.createElement(P.TextInput,{name:"tripName",className:this.state.error?"trips-create-trip-modal-CreateTripModalBase__tripname_error--VzXmt":"trips-create-trip-modal-CreateTripModalBase__tripname--1N2ZB",focusOnMount:!0,onChange:this.onInputChange,value:this.state.form.tripName,maxLength:50})),a.createElement("div",{className:"trips-create-trip-modal-CreateTripModalBase__messages--1DXPW"},a.createElement("div",{className:"trips-create-trip-modal-CreateTripModalBase__error_message--2BmfH"},this.state.error),a.createElement("div",{className:"".concat("trips-create-trip-modal-CreateTripModalBase__length_hint--3JESK"," ").concat(this.state.form.tripName.length>=50?"trips-create-trip-modal-CreateTripModalBase__max_length_reached--2nkEr":"")},Object(N.localize)("trips_trip_name_character_count",{nCharacterCount:this.state.form.tripName.length})))),i=a.createElement(S.a,{type:"primary",disabled:this.isCreateDisabled(),onClick:this.onCreateClick},Object(N.localize)("stat_modal_create"));return a.createElement(B.Impression,{source:"trips",attributes:Object(w.getTripsImpression)({element:this.state.impressionElement})},a.createElement("div",{className:"ui_content ".concat("trips-create-trip-modal-CreateTripModalBase__content--2TEq1")},a.createElement(g.Mutation,{mutation:L.CreateTrip,onCompleted:function e(r){var a=r.createTrip.errors;if(a&&a.length){var i=a[0],n=Object(D.getLocalizedTripsErrorMessage)("CREATE_TRIP",i);"ILLEGAL_DUPLICATE"===i.type?t.setState({impressionElement:"duplicateTripError",error:n}):"FAILED_PROFANITY"===i.type?t.setState({error:n}):t.setState({impressionElement:"error",error:n})}else t.onTripCreated(r.createTrip.trip)},onError:function e(){t.setState({impressionElement:"error",error:Object(N.localize)("create_trip_general_error_v2")})}},function(e,n){var o=n.loading;return t.props.loading||o?a.createElement("div",{className:"trips-create-trip-modal-CreateTripModalBase__loading_container--2WTUp"},a.createElement(j.LoadingSpinner,null)):a.createElement(k.SocialLoginGate,null,function(n){return a.createElement("form",{onSubmit:function r(a){return t.onSubmit(a,n,e)},className:"trips-create-trip-modal-CreateTripModalBase__form--15Lh4"},r,!Object(y.featureIsEnabled)("saves_heart_with_wc_flow")&&a.createElement("div",{className:"ui_label_group ".concat("trips-create-trip-modal-CreateTripModalBase__privacy--bmOIa")},a.createElement("label",{className:"trips-create-trip-modal-CreateTripModalBase__label--1Pu4m"},Object(N.localize)("trip_privacy_setting_header"),a.createElement("div",{className:"trips-create-trip-modal-CreateTripModalBase__privacy_component--1J_IL"},a.createElement(A.a,{className:"trips-create-trip-modal-CreateTripModalBase__privacy_component--1J_IL",name:"tripPrivacy",onSelect:t.onPrivacyChange,checkedValue:t.state.form.tripPrivacy})))),a.createElement("div",{className:"trips-create-trip-modal-CreateTripModalBase__button_footer--2cowQ"},i))})})))}}]),t}(a.PureComponent);C()(z,"defaultProps",{isPublicTrip:!1});var R=function(e){function t(e){var r;return l()(this,t),(r=m()(this,d()(t).call(this,e))).state={contentKey:r.getNewKey()},r}return _()(t,e),c()(t,[{key:"componentDidMount",value:function e(){this.props.isCurrentlyOpen&&this.props.isMobile&&window.scrollTo(0,0)}},{key:"onTripCreated",value:function e(t,r){return this.props.onTripCreated(t)||(r(),null)}},{key:"getNewKey",value:function e(){return"".concat(this.props.modalName).concat((new Date).getTime())}},{key:"render",value:function e(){var t=this;return a.createElement(E.Modal,{name:this.props.modalName,header:a.createElement(M.TitleBar,{iconName:"suitcase",displayType:"LEFT_ALIGN_GRAY"},Object(N.localize)("stat_modal_create_a_trip_v2")),onClose:function e(){t.setState({contentKey:t.getNewKey()}),t.props.onClose&&t.props.onClose()}},a.createElement(I.Closer,null,function(e){return a.createElement(z,{key:t.state.contentKey,onTripCreated:function r(a){return t.onTripCreated(a,e)},loading:t.props.loading,isPublicTrip:t.props.isPublicTrip})}))}}]),t}(a.PureComponent),W=Object(b.connect)(function(e,t){return n()({isMobile:"MOBILE"===e.meta.device.viewportCategory},t)})(R),K=function e(t){var r=t.onTripCreated,i=t.modalName,n=t.onClose,o=t.isCurrentlyOpen,l=t.isPublicTrip;return a.createElement(W,{onTripCreated:function e(t){return r(t),null},modalName:i,onClose:n,isCurrentlyOpen:o,isPublicTrip:l})};K.defaultProps={onClose:function e(){},isPublicTrip:!1};var q=K,F=r("@ta/common.logging"),G=r.n(F),U=r("@ta/trips.trip-util"),J=function e(t){var r=t.object,i=t.onAddedToCreatedTrip,n=t.onError;return a.createElement(g.Mutation,{mutation:L.AddItemToTrip,update:function e(r){return Object(U.updateSocialStatisticsOnSave)(r,t.object)}},function(e,t){var o=t.loading;return a.createElement(w.TripInteraction,{source:"trips",pageAsContext:!0},function(t){return a.createElement(z,{onTripCreated:function a(o){t({modalSuccess:{element:"createTrip",privacy:o.status||void 0}}),e({variables:{tripId:o.id,referenceId:"".concat(r.id),referenceType:r.type,allowDuplicates:!1,socialReference:Object(y.featureIsEnabled)("social_at_referencing_profile_links")}}).then(function(e){var t,r,a,l,s=null==e?void 0:null===(t=e.data)||void 0===t?void 0:null===(r=t.addItemToTrip)||void 0===r?void 0:null===(a=r.errors)||void 0===a?void 0:null===(l=a[0])||void 0===l?void 0:l.error;return s?n&&n({query:"ADD_ITEM_TO_TRIP",tripsError:s}):i(o),null}).catch(function(e){return G.a.error(e),Object(N.localize)("create_trip_general_error_v2")})},loading:o})})})};J.defaultProps={onError:void 0};var V=J,X=function e(t){var r=t.item,i=t.onMovedToCreatedTrip;return a.createElement(g.Mutation,{mutation:L.MoveTripItem},function(e,t){var n=t.loading;return a.createElement(w.TripInteraction,{source:"trips",pageAsContext:!0},function(t){return a.createElement(z,{onTripCreated:function a(n){t({modalSuccess:{element:"createTrip",privacy:n.status||void 0}}),e({variables:{toTripId:n.id,itemId:r.id}}).then(function(){return i(n),null}).catch(function(e){return G.a.error(e),Object(N.localize)("trips_move_error")})},loading:n})})})};r.d(t,"CreateTripModal",function(){return q}),r.d(t,"CreateTripWithAddItemModal",function(){return V}),r.d(t,"CreateTripWithMoveItemModal",function(){return X})}}});
//# sourceMappingURL=trips.create-trip-modal.48cfe59dfc.js.map