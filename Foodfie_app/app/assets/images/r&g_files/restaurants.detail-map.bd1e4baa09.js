(window.$WP=window.$WP||[]).push({id:"@ta/restaurants.detail-map",d:["vendor-babel","vendor-react-libs","ta-platform","@ta/maps.overlay","@ta/maps.fetch","@ta/public.maps","@ta/maps.also-show-control","@ta/maps.controls","@ta/maps.alsoshowresults","@ta/maps.find-location-button","@ta/maps.popups","@ta/maps.markers","ta-common"],e:["./packages/restaurants/detail-map/RestaurantMapOpener.jsx"],x:{"./packages/restaurants/detail-map/RestaurantMapOpener.jsx":["default"]},m:{"./packages/restaurants/detail-map/RestaurantMapOpener.jsx":function(e,t,a){"use strict";a.r(t);var o=a("@babel/runtime/helpers/esm/classCallCheck"),n=a.n(o),s=a("@babel/runtime/helpers/esm/createClass"),r=a.n(s),i=a("@babel/runtime/helpers/esm/possibleConstructorReturn"),l=a.n(i),c=a("@babel/runtime/helpers/esm/getPrototypeOf"),h=a.n(c),u=a("@babel/runtime/helpers/esm/inherits"),d=a.n(u),p=a("@babel/runtime/helpers/esm/assertThisInitialized"),m=a.n(p),v=a("@babel/runtime/helpers/esm/defineProperty"),w=a.n(v),S=a("react"),M=a("react-redux"),f=a("@ta/common.radio"),k=a.n(f),g=a("@ta/maps.overlay"),E=a.n(g),C=a("@babel/runtime/helpers/esm/objectSpread"),R=a.n(C),b=a("@ta/public.maps"),_=a("@ta/maps.also-show-control"),L=a("@ta/maps.controls"),y=a("@ta/maps.alsoshowresults"),O=a("@ta/maps.find-location-button"),A=a.n(O),I=a("@ta/maps.popups"),H=a("@ta/maps.markers"),P=a("@ta/styleguide.icon"),B=function e(t){return S.createElement("div",{className:"restaurants-detail-map-header-MapHeader__container--IFxEU"},S.createElement("span",{className:"restaurants-detail-map-header-MapHeader__pin--2OHxf"},S.createElement(P.Icon,{name:"map-pin-fill"})),S.createElement("span",{className:"restaurants-detail-map-header-MapHeader__name---bh_r"},t.locationName),S.createElement("span",{className:"restaurants-detail-map-header-MapHeader__close--1u7-J",onClick:t.onClose},S.createElement(P.Icon,{name:"times"})))},x=function(e){function t(e){var a,o;return n()(this,t),o=l()(this,h()(t).call(this,e)),w()(m()(m()(o)),"onMapLoaded",function(e){o.setState({mapInterface:e.map,lastSearchBBox:e.map.getBounds()})}),w()(m()(m()(o)),"onLocationHoverStart",function(e){"DESKTOP"===o.props.viewportCategory&&o.setState(function(){return{hoveredMarker:e}})}),w()(m()(m()(o)),"onLocationHoverEnd",function(e){o.setState(function(t){return t.hoveredMarker&&t.hoveredMarker.id===e.id?{hoveredMarker:null}:null})}),w()(m()(m()(o)),"onPinSelected",function(e){if(e){var t=o.props.detailLocation===e?"primary_pin":"selected_marker";o.state.visitedLocations[e.id]=!0,o.setState({selectedMarker:e,hoveredMarker:null,carouselState:t})}else o.setState({selectedMarker:null,hoveredMarker:null,carouselState:"hidden"})}),w()(m()(m()(o)),"onMapClick",function(){o.setState({selectedMarker:null,hoveredMarker:null,carouselState:"hidden"})}),w()(m()(m()(o)),"onRedoSearch",function(){var e=o.state.mapInterface;if(e){var t=e.getBounds();o.setState({lastSearchBBox:t})}}),w()(m()(m()(o)),"toggleAlsoShowOption",function(e,t){var a=Object.assign({},o.state.selectedAlsoShowOptions,w()({},e.value,t));o.setState({selectedAlsoShowOptions:a}),t&&o.onRedoSearch()}),w()(m()(m()(o)),"clearAlsoShowOptions",function(){var e=o.state.carouselState;"selected_marker"===e&&(e="hidden"),o.setState({selectedAlsoShowOptions:{},carouselState:e})}),o.state={mapInterface:null,hoveredMarker:null,selectedMarker:"MOBILE"===e.viewportCategory?e.detailLocation:null,carouselState:"MOBILE"===e.viewportCategory?"selected_marker":"hidden",hasFitResults:!1,selectedAlsoShowOptions:(a={},w()(a,y.AlsoShowValues.hotels,!1),w()(a,y.AlsoShowValues.restaurants,!0),w()(a,y.AlsoShowValues.thingsToDo,!1),a),visitedLocations:{},lastSearchBBox:null},o}return d()(t,e),r()(t,[{key:"componentDidUpdate",value:function e(){this.state.hasFitResults||this.state.mapInterface&&this.setState({hasFitResults:!0})}},{key:"render",value:function e(){var t=this.props,a=t.detailLocation,o=t.onClose,n=this.state,s=n.selectedMarker,r=n.hoveredMarker,i=n.selectedAlsoShowOptions,l=n.visitedLocations,c=n.hasFitResults,h=r?r.id:0,u=s?s.id:0,d="DESKTOP"===this.props.viewportCategory,p="MOBILE"===this.props.viewportCategory,m=Object(y.buildAlsoShowItems)([y.AlsoShowValues.hotels,y.AlsoShowValues.restaurants,y.AlsoShowValues.thingsToDo]),v=Object.keys(i).filter(function(e){return i[e]}).length>0,M=null;"hidden"!==this.state.carouselState&&s&&(M=[s]);var f=p&&M&&M.length;return S.createElement("div",{className:"restaurants-detail-map-RRMapview__container--3Qrv7"},S.createElement(B,{locationName:a.name,onClose:o}),S.createElement(b.MapComponent,{className:"restaurants-detail-map-RRMapview__mapContainer--3DfCn",initialCenter:new b.LatLng(a.geoPoint.latitude,a.geoPoint.longitude),initialZoom:15,onLoad:this.onMapLoaded,onClick:this.onMapClick},S.createElement(y.AlsoShowResultsController,{blacklist:w()({},a.id,!0),showSelectedMarker:p,selectedMarker:u,hoveredMarker:h,boundingBox:this.state.lastSearchBBox,isVisited:l,showRestaurants:i[y.AlsoShowValues.restaurants],showAttractions:i[y.AlsoShowValues.thingsToDo],showHotels:i[y.AlsoShowValues.hotels],onMarkerMouseEnter:this.onLocationHoverStart,onMarkerMouseLeave:this.onLocationHoverEnd,onMarkerClick:this.onPinSelected}),S.createElement("div",{className:"".concat("restaurants-detail-map-RRMapview__findLocationButton--zppCs"," ").concat(f?"restaurants-detail-map-RRMapview__carouselShown--2umxJ":"")},S.createElement(A.a,null)),S.createElement(H.AnchorMarkers,{locations:[a],hoveredMarker:h,selectedMarker:u,visited:{},showSelectedMarker:p,onMouseEnter:this.onLocationHoverStart,onMouseLeave:this.onLocationHoverEnd,onClick:this.onPinSelected}),S.createElement("div",{className:"restaurants-detail-map-RRMapview__headerShadow--3WVOF"}),d&&!!r&&r!==s&&S.createElement(I.LocationHoverPopup,{location:r}),!p&&s&&S.createElement(I.LocationPopup,{location:s,autoPan:!0}),f&&S.createElement(L.CardCarousel,{locations:M||[],selectedMarker:u,onSwipe:function e(){}}),S.createElement("div",{className:"restaurants-detail-map-RRMapview__zoomControl--1QjAi"},S.createElement(L.ZoomControl,null)),v&&c&&S.createElement("div",{className:"restaurants-detail-map-RRMapview__redoSearchContainer--3cZaK"},p?S.createElement(L.RoundedRedoSearchButton,{onRedoSearch:this.onRedoSearch}):S.createElement(L.RedoSearchButton,{onRedoSearch:this.onRedoSearch})),S.createElement("div",{className:"".concat("restaurants-detail-map-RRMapview__alsoShowContainer--2kED4"," ").concat(f?"restaurants-detail-map-RRMapview__carouselShown--2umxJ":"")},S.createElement(_.AlsoShowControl,{options:m,selectedValues:this.state.selectedAlsoShowOptions,onValueChange:this.toggleAlsoShowOption,onClearOptions:this.clearAlsoShowOptions,mobile:p}))))}}]),t}(S.PureComponent),V=Object(M.connect)(function(e,t){return R()({},t,{viewportCategory:e.meta.device.viewportCategory})})(x),N=a("@ta/maps.fetch"),j=a.n(N),D=function(e){function t(){return n()(this,t),l()(this,h()(t).apply(this,arguments))}return d()(t,e),r()(t,[{key:"render",value:function e(){var t=this,a="/data/1.0/mapsEnrichment/restaurant/".concat(this.props.locationId);return S.createElement(j.a,{url:a},function(e){var a=e.loading,o=e.data,n=e.error;return S.createElement(S.Fragment,null,t.props.children({loading:a,location:o,error:n}))})}}]),t}(S.PureComponent),F=function(e){function t(){return n()(this,t),l()(this,h()(t).apply(this,arguments))}return d()(t,e),r()(t,[{key:"render",value:function e(){var t=this;return S.createElement(S.Fragment,null,S.createElement(D,{locationId:this.props.locationId},function(e){var a=e.location;return a?S.createElement("div",{style:{width:"100%",height:"100%"}},S.createElement(V,{detailLocation:a,onClose:t.props.onClose})):null}))}}]),t}(S.PureComponent),T=function e(){return window&&window.location&&"#MAPVIEW"===window.location.hash},W=function e(){var t=window.location.toString();if(t.indexOf("#")>0){var a=t.substring(0,t.indexOf("#"));window.history.replaceState(null,document.title,a)}},z=function(e){function t(){var e,a;n()(this,t);for(var o=arguments.length,s=new Array(o),r=0;r<o;r++)s[r]=arguments[r];return a=l()(this,(e=h()(t)).call.apply(e,[this].concat(s))),w()(m()(m()(a)),"state",{showMap:!1}),w()(m()(m()(a)),"hasPushedHash",!1),w()(m()(m()(a)),"mapRadio",new k.a("restaurant-detail-map")),w()(m()(m()(a)),"openMap",function(){history.pushState(null,document.title,"#MAPVIEW"),a.hasPushedHash=!0,a.checkHash()}),w()(m()(m()(a)),"checkHash",function(){var e=T();a.setState({showMap:e})}),w()(m()(m()(a)),"closeMap",function(){a.hasPushedHash?(window.history.back(),a.checkHash()):(W(),a.checkHash())}),a}return d()(t,e),r()(t,[{key:"componentDidMount",value:function e(){this.mapRadio.on("open-trigger-clicked",this.openMap),this.mapRadio.on("close-trigger-clicked",this.closeMap),this.setState({showMap:T()}),window.addEventListener("popstate",this.checkHash),window.addEventListener("hashchange",this.checkHash,!1)}},{key:"componentWillUnmount",value:function e(){window.removeEventListener("popstate",this.checkHash),window.removeEventListener("hashchange",this.checkHash),this.mapRadio.off("open-trigger-clicked",this.openMap)}},{key:"render",value:function e(){return S.createElement(S.Fragment,null,this.state.showMap&&S.createElement(E.a,{onClose:this.closeMap},S.createElement(F,{onClose:this.closeMap,locationId:this.props.locationId,geoId:this.props.geoId})))}}]),t}(S.PureComponent);t.default=Object(M.connect)(function(e){return{locationId:e.page.detailId,geoId:e.page.geoId}})(z)}}});
//# sourceMappingURL=restaurants.detail-map.bd1e4baa09.js.map